window.Box=window.Box||{},Box.Timing=Box.Timing||{execution:[],scripts:{},events:{}},Box.Timing.scripts.application_postload=(new Date).getTime(),Box.Timing.execution.push({name:"js/preview/crocodoc/crocodoc.viewer-0.11.0.js",time:(new Date).getTime()}),function(e){"use strict";e.Crocodoc=function(e){return"object"!=typeof exports?e(jQuery):void(module.exports=e)}(function(t){function n(){e.loadSVG=function(t){var n=new e.DOMParser,a=n.parseFromString(t,"image/svg+xml"),i=document.importNode(a.documentElement,!0);i.setAttribute("width","100%"),i.setAttribute("height","100%"),document.body?document.body.appendChild(i):document.documentElement.appendChild(i)}}var a="crocodoc-",i="data-svg-version",r=a+"viewer",o=a+"doc",s=a+"viewport",l=a+"viewer-logo",c=a+"draggable",u=a+"dragging",d=a+"text-selected",f=a+"text-disabled",p=a+"links-disabled",h=a+"mobile",m=a+"ielt9",g=a+"supports-svg",v=a+"window-as-viewport",_=a+"layout-",y=a+"current-page",b=a+"preceding-page",w=a+"page",C=w+"-inner",x=w+"-content",T=w+"-svg",S=w+"-text",E=w+"-link",R=w+"-links",k=w+"-autoscale",A=w+"-loading",N=w+"-error",D=w+"-visible",k=w+"-autoscale",P=w+"-prev",M=w+"-next",O=w+"-before",$=w+"-after",I=w+"-before-buffer",H=w+"-after-buffer",L=[M,$,P,O,I,H].join(" "),B='<div tabindex="-1" class="'+s+'"><div class="'+o+'"></div></div><div class="'+l+'"></div>',j='<div class="'+w+" "+A+'" style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}"><div class="'+C+'"><div class="'+x+'"><div class="'+T+'"></div><div class="'+k+'"><div class="'+S+'"></div><div class="'+R+'"></div></div></div></div></div>',V=1024,q="fitwidth",z="fitheight",U="auto",F="in",W="out",Z="previous",G="next",K="vertical",X="vertical-single-column",Q="horizontal",Y="presentation",J="presentation-two-page",ee="text",te="converting",ne="not loaded",ae="loading",ie="loaded",re="error",oe="padding-",se=oe+"top",le=oe+"right",ce=oe+"left",ue=oe+"bottom",de=.95,fe=.99,pe=100,he=32,me=8,ge=1e3,ve="image/svg+xml",_e="<style>html,body{width:100%;height:100%;margin:0;overflow:hidden;}</style>",ye='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+n+")()]]></script></svg>",be=1,we=2,Ce=3,xe=4,Te=5,Se=6,Ee=7,Re=8;if("undefined"==typeof t)throw new Error("jQuery is required");var ke=function(){function e(n,a,i){var r;for(i=i||n,r=0;r<a.length;++r){if(n===a[r])throw new Error("Circular dependency detected: "+i+"->"+a[r]);t[a[r]]&&e(n,t[a[r]].mixins,i+"->"+a[r])}}var t={},n={};return{ZOOM_FIT_WIDTH:q,ZOOM_FIT_HEIGHT:z,ZOOM_AUTO:U,ZOOM_IN:F,ZOOM_OUT:W,SCROLL_PREVIOUS:Z,SCROLL_NEXT:G,LAYOUT_VERTICAL:K,LAYOUT_VERTICAL_SINGLE_COLUMN:X,LAYOUT_HORIZONTAL:Q,LAYOUT_PRESENTATION:Y,LAYOUT_PRESENTATION_TWO_PAGE:J,LAYOUT_TEXT:ee,ASSET_REQUEST_RETRIES:1,viewerTemplate:B,pageTemplate:j,components:t,utilities:n,createViewer:function(e,t){return new ke.Viewer(e,t)},getViewer:function(e){return ke.Viewer.get(e)},addComponent:function(n,a,i){a instanceof Function&&(i=a,a=[]),e(n,a),t[n]={mixins:a,creator:i}},createComponent:function(e,n){var a=t[e];if(a){for(var i=[],r=0;r<a.mixins.length;++r)i.push(this.createComponent(a.mixins[r],n));return i.unshift(n),a.creator.apply(a.creator,i)}return null},addPlugin:function(e,t){this.addComponent("plugin-"+e,t)},addDataProvider:function(e,t){this.addComponent("data-provider-"+e,t)},addUtility:function(e,t){n[e]={creator:t,instance:null}},getUtility:function(e){var t=n[e];return t?(t.instance||(t.instance=t.creator(this)),t.instance):null}}}();return function(){ke.Scope=function(e){function n(e,t){var n,a,i,s;for(n=0,a=o.length;a>n;++n)i=o[n],i&&(s=i.messages||[],-1!==r.inArray(e,s)&&r.isFn(i.onmessage)&&i.onmessage.call(i,e,t))}function a(){for(var e;s.length;)e=s.shift(),n(e.name,e.data);s=null}function i(e){r.isFn(e.destroy)&&!e._destroyed&&(e.destroy(),e._destroyed=!0)}var r=ke.getUtility("common"),o=[],s=[],l={},c=!1;e.dataProviders=e.dataProviders||{},this.createComponent=function(e){var t=ke.createComponent(e,this);return t&&(t.componentName=e,o.push(t)),t},this.destroyComponent=function(e){var t,n;for(t=0,n=o.length;n>t;++t)if(e===o[t]){i(e),o.splice(t,1);break}},this.destroy=function(){var e,t,n,a=o.slice();for(e=0,t=a.length;t>e;++e)n=a[e],i(n);o=[],l={}},this.broadcast=function(e,t){c?n(e,t):s.push({name:e,data:t})},this.getUtility=function(e){return ke.getUtility(e)},this.getConfig=function(){return e},this.ready=function(){c||(c=!0,a())},this.get=function(n,a){var i=e.dataProviders[n]||n,r=this.getDataProvider(i);return r?r.get(n,a):t.Deferred().reject("data-provider not found").promise()},this.getDataProvider=function(e){var t;return l[e]?t=l[e]:(t=this.createComponent("data-provider-"+e),l[e]=t),t}}}(),function(){function e(e,t){var n=!1;return{type:e,data:t,preventDefault:function(){n=!0},isDefaultPrevented:function(){return n}}}ke.EventTarget=function(){this._handlers={}},ke.EventTarget.prototype={constructor:ke.EventTarget,on:function(e,t){"undefined"==typeof this._handlers[e]&&(this._handlers[e]=[]),this._handlers[e].push(t)},fire:function(t,n){var a,i,r,o=e(t,n);if(a=this._handlers[o.type],a instanceof Array)for(a=a.concat(),i=0,r=a.length;r>i;i++)a[i]&&a[i].call(this,o);if(a=this._handlers.all,a instanceof Array)for(a=a.concat(),i=0,r=a.length;r>i;i++)a[i]&&a[i].call(this,o);return o},off:function(e,t){var n,a,i=this._handlers[e];if(i instanceof Array){if(!t)return void(i.length=0);for(n=0,a=i.length;a>n;n++)if(i[n]===t||i[n].handler===t){i.splice(n,1);break}}},one:function(e,t){var n=this,a=function(i){n.off(e,a),t.call(n,i)};a.handler=t,this.on(e,a)}}}(),function(){var e=0,n={};ke.Viewer=function(a,i){function r(){d.init()}ke.EventTarget.call(this);var o,s=ke.getUtility("common"),l=t(a),c=s.extend(!0,{},ke.Viewer.defaults,i),u=new ke.Scope(c),d=u.createComponent("viewer-base");if(0===l.length)throw new Error("Invalid container element");this.id=c.id=++e,c.api=this,c.$el=l,n[this.id]=this,this.destroy=function(){delete n[c.id],u.broadcast("destroy"),u.destroy()},this.load=function(){d.loadAssets()},this.setLayout=function(e){o=null,o=d.setLayout(e)},this.zoom=function(e){var t=parseFloat(e);o&&(t&&(e=t/(c.pageScale||1)),o.setZoom(e))},this.scrollTo=function(e){o&&s.isFn(o.scrollTo)&&o.scrollTo(e)},this.scrollBy=function(e,t){o&&o.scrollBy(e,t)},this.focus=function(){o&&o.focus()},this.enableTextSelection=function(){l.toggleClass(f,!1),c.enableTextSelection||(c.enableTextSelection=!0,u.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){l.toggleClass(f,!0),c.enableTextSelection&&(c.enableTextSelection=!1,u.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){c.enableLinks||(l.removeClass(p),c.enableLinks=!0)},this.disableLinks=function(){c.enableLinks&&(l.addClass(p),c.enableLinks=!1)},this.updateLayout=function(){o&&o.update()},r()},ke.Viewer.prototype=new ke.EventTarget,ke.Viewer.prototype.constructor=ke.Viewer,ke.Viewer.get=function(e){return n[e]},ke.Viewer.defaults={url:null,layout:K,zoom:U,page:1,enableTextSelection:!0,enableLinks:!0,enableDragging:!1,queryParams:null,plugins:{},useWindowAsViewport:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},dataProviders:{metadata:"metadata",stylesheet:"stylesheet","page-svg":"page-svg","page-text":"page-text","page-img":"page-img"},pageStart:null,pageEnd:null,autoloadFirstPage:!0,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),ke.addDataProvider("metadata",function(e){function t(e){return a.parseJSON(e)}var n=e.getUtility("ajax"),a=e.getUtility("common"),i=e.getConfig();return{get:function(){var e=this.getURL(),a=n.fetch(e,ke.ASSET_REQUEST_RETRIES);return a.then(t).promise({abort:a.abort})},getURL:function(){var e=i.template.json;return i.url+e+i.queryString}}}),ke.addDataProvider("page-img",function(e){var n=e.getUtility("common"),a=e.getConfig();return{get:function(e,n){function a(){r.setAttribute("src",l)}function i(){r&&r.removeAttribute("src")}var r=this.getImage(),o=ke.ASSET_REQUEST_RETRIES,s=!1,l=this.getURL(n),c=t.Deferred();return r.onload=function(){s=!0,c.resolve(r)},r.onerror=function(){o>0?(o--,i(),a()):(r=null,s=!1,c.reject({error:"image failed to load",resource:l}))},a(),c.promise({abort:function(){s||(i(),c.reject())}})},getURL:function(e){var t=n.template(a.template.img,{page:e});return a.url+t+a.queryString},getImage:function(){return new Image}}}),ke.addDataProvider("page-svg",function(e){function t(e,t){var n="<style>"+t+"</style>";return o.firefox&&!s.isSubpxSupported()&&(n+="<style>text { text-rendering: geometricPrecision; }</style>"),e=e.replace(d,n)}function n(n){if(!c){var r,o=l.queryString.replace("&","&#38;");return r=i.countInStr(n,'xlink:href="data:image'),r>a&&(n=n.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/gi,"")),n=n.replace(/href="([^"#:]*)"/g,function(e,t){return'href="'+l.url+t+o+'"'}),e.get("stylesheet").then(function(e){return t(n,e)})}}var a=1e3,i=e.getUtility("common"),r=e.getUtility("ajax"),o=e.getUtility("browser"),s=e.getUtility("subpx"),l=e.getConfig(),c=!1,u={},d=/<xhtml:link[^>]*>(\s*<\/xhtml:link>)?/i;return{get:function(e,t){var a,i=this.getURL(t);return u[t]?u[t]:(a=r.fetch(i,ke.ASSET_REQUEST_RETRIES),u[t]=a.then(n).promise({abort:function(){a.abort(),u&&delete u[t]}}),u[t])},getURL:function(e){var t=i.template(l.template.svg,{page:e});return l.url+t+l.queryString},destroy:function(){c=!0,i=r=s=o=l=u=null}}}),ke.addDataProvider("page-text",function(e){function t(e){if(!o){var t=a.countInStr(e,"<div");return t>n?"":e=e.replace(/<link rel="stylesheet".*/,"")}}var n=256,a=e.getUtility("common"),i=e.getUtility("ajax"),r=e.getConfig(),o=!1,s={};return{get:function(e,n){var a,r=this.getURL(n);return s[n]?s[n]:(a=i.fetch(r,ke.ASSET_REQUEST_RETRIES),s[n]=a.then(t).promise({abort:function(){a.abort(),s&&delete s[n]}}),s[n])},getURL:function(e){var t=a.template(r.template.html,{page:e});return r.url+t+r.queryString},destroy:function(){o=!0,a=i=r=s=null}}}),ke.addDataProvider("stylesheet",function(e){function t(e){return i.ie&&(e=e.replace(/font-family:[\s\"\']*([\w-]+)\b/g,"$0-"+r.id)),e}var n,a=e.getUtility("ajax"),i=e.getUtility("browser"),r=e.getConfig();return{get:function(){if(n)return n;var e=a.fetch(this.getURL(),ke.ASSET_REQUEST_RETRIES);return n=e.then(t).promise({abort:function(){e.abort(),n=null}})},getURL:function(){var e=r.template.css;return r.url+e+r.queryString},destroy:function(){a=i=r=null,n=null}}}),ke.addUtility("ajax",function(e){function n(e){var t,n,a;try{t=e.status,n=e.statusText,a=e.responseText}catch(i){t=0,n="",a=null}return{status:t,statusText:n,responseText:a,rawRequest:e}}function a(e){return"file:"===d.parse(e).protocol}function i(e){return e>=200&&300>e||304===e}function r(e){return e=c.extend(!0,{},e||{}),e.method=e.method||"GET",e.headers=e.headers||[],e.data=e.data||"",e.withCredentials=!!e.withCredentials,"string"!=typeof e.data&&(e.data=t.param(e.data),"GET"!==e.method&&(e.data=e.data,e.headers.push(["Content-Type","application/x-www-form-urlencoded"]))),e}function o(e,t){var n;for(n=0;n<t.length;++n)e.setRequestHeader(t[n][0],t[n][1])}function s(e,t,n,r,s,l,c){var d=u.getXHR();return d.open(t,e,!0),d.onreadystatechange=function(){var t;if(4===d.readyState){d.onreadystatechange=function(){};try{t=d.status}catch(n){return void c(d)}0===t&&a(e)&&(t=200),i(t)?l(d):c(d)}},o(d,r),d.withCredentials=s,d.send(n),d}function l(e,t,n,a,i){var r=u.getXDR();try{r.open(t,e),r.onload=function(){a(r)},r.onerror=function(){i(r)},r.ontimeout=function(){i(r)},r.onprogress=function(){},r.send(n)}catch(o){return i({status:0,statusText:o.message})}return r}var c=e.getUtility("common"),u=e.getUtility("support"),d=e.getUtility("url");return{request:function(e,t){function a(e){return c.isFn(o.success)&&o.success.call(n(e)),e}function i(e){return c.isFn(o.fail)&&o.fail.call(n(e)),e}var o=r(t),f=o.method,p=o.data,h=o.headers,m=o.withCredentials;return"GET"===f&&p&&(e=d.appendQueryParams(e,p),p=""),u.isXHRSupported()?d.isCrossDomain(e)&&!u.isCORSSupported()?l(e,f,p,a,i):s(e,f,p,h,m,a,i):o.fail({status:0,statusText:"AJAX not supported"})},fetch:function(e,n){function a(e){n>0?(n--,r=i()):l.reject(e)}function i(){return s.request(e,{success:function(){var t,n;if(!o){if(n=this.rawRequest,202===this.status&&c.isFn(n.getResponseHeader)&&(t=parseInt(n.getResponseHeader("retry-after")),t>0))return void setTimeout(i,1e3*t);this.responseText?l.resolve(this.responseText):a({error:"empty response",status:this.status,resource:e})}},fail:function(){o||a({error:this.statusText,status:this.status,resource:e})}})}var r,o=!1,s=this,l=t.Deferred();return r=i(),l.promise({abort:function(){o=!0,r.abort()}})}}}),ke.addUtility("browser",function(){var e,t=navigator.userAgent,n={},a=/ip(hone|od|ad)/i.test(t),i=/android/i.test(t),r=/blackberry/i.test(t),o=/webos/i.test(t),s=/silk|kindle/i.test(t),l=/MSIE|Trident/i.test(t);return l&&(n.ie=!0,e=/MSIE/i.test(t)?/MSIE\s+(\d+\.\d+)/i.exec(t):/Trident.*rv[ :](\d+\.\d+)/.exec(t),n.version=e&&parseFloat(e[1]),n.ielt9=n.version<9,n.ielt10=n.version<10,n.ielt11=n.version<11),a&&(n.ios=!0,e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n.version=e&&parseFloat(e[1]+"."+e[2])),n.mobile=/mobile/i.test(t)||a||i||r||o||s,n.firefox=/firefox/i.test(t),/safari/i.test(t)&&(n.chrome=/chrome/i.test(t),n.safari=!n.chrome),n.safari&&(e=navigator.appVersion.match(/Version\/(\d+(\.\d+)?)/),n.version=e&&parseFloat(e[1])),n}),ke.addUtility("common",function(){var n=1.33333,a={};return a.extend=t.extend,a.each=t.each,a.map=t.map,a.param=t.param,a.parseJSON=t.parseJSON,a.stringifyJSON="undefined"!=typeof e.JSON?e.JSON.stringify:function(){throw new Error("JSON.stringify not supported")},t.extend(a,{bisectLeft:function(e,t,n){for(var a,i,r=0,o=e.length;o>r;)i=Math.floor((r+o)/2),a=n?e[i][n]:e[i],t>a?r=i+1:o=i;return r},bisectRight:function(e,t,n){for(var a,i,r=0,o=e.length;o>r;)i=Math.floor((r+o)/2),a=n?e[i][n]:e[i],a>t?o=i:r=i+1;return r},clamp:function(e,t,n){return t>e?t:e>n?n:e},sign:function(e){var t=parseInt(e,10);return t?0>t?-1:1:t},isFn:function(e){return"function"==typeof e},inArray:function(e,n){return a.isFn(n.indexOf)?n.indexOf(e):t.inArray(e,n)},constrainRange:function(e,t,n){var i=t-e;return 0>i?{min:-1,max:-1}:(e=a.clamp(e,0,n),t=a.clamp(e+i,0,n),i>t-e&&(e=a.clamp(t-i,0,n)),{min:e,max:t})},now:function(){return(new Date).getTime()},throttle:function(e,t){function n(){l=a.now(),o=null,s=t.apply(i,r)}var i,r,o,s,l=0;return function(){var c=a.now(),u=e-(c-l);return i=this,r=arguments,0>=u?(clearTimeout(o),o=null,l=c,s=t.apply(i,r)):o||(o=setTimeout(n,u)),s}},debounce:function(e,t){function n(){var c=a.now()-s;e>c?o=setTimeout(n,e-c):(o=null,l=t.apply(i,r),i=r=null)}var i,r,o,s,l;return function(){return i=this,r=arguments,s=a.now(),o||(o=setTimeout(n,e)),l}},insertCSS:function(e){var t=document.createElement("style"),n=document.createTextNode(e);try{t.setAttribute("type","text/css"),t.appendChild(n)}catch(a){}return document.getElementsByTagName("head")[0].appendChild(t),t},appendCSSRule:function(e,t,n){var a;return e.insertRule?e.insertRule(t+"{"+n+"}",e.cssRules.length):(a=e.addRule(t,n,e.rules.length),0>a&&(a=e.rules.length-1),a)},deleteCSSRule:function(e,t){e.deleteRule?e.deleteRule(t):e.removeRule(t)},getSelectedNode:function(){var t,n,a;return e.getSelection?(n=e.getSelection(),n.rangeCount&&(a=n.getRangeAt(0),a.collapsed||(t=n.anchorNode.parentNode))):document.selection&&(t=document.selection.createRange().parentElement()),t},getComputedStyle:function(t){return"getComputedStyle"in e?e.getComputedStyle(t):t.currentStyle},calculatePtSize:function(){var e,t,i=1e4,r=document.createElement("div");return r.style.display="block",r.style.position="absolute",r.style.width=i+"pt",document.body.appendChild(r),e=a.getComputedStyle(r),t=e&&e.width?parseFloat(e.width)/i:n,document.body.removeChild(r),t},countInStr:function(e,t){for(var n,a=0;n=e.indexOf(t,n)+1;)a++;return a},template:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e=e.replace(new RegExp("\\{\\{"+n+"\\}\\}","g"),t[n]));return e}})}),ke.addUtility("subpx",function(n){function a(){if(!t.support.leadingWhitespace)return!1;var n=t(o.template(r,{size:12.5})).appendTo(document.documentElement).get(0),a=t(n).css("font-size"),i=t(n).width();t(n).remove(),n=t(o.template(r,{size:12.6})).appendTo(document.documentElement).get(0);var s=t(n).css("font-size"),l=t(n).width();if(t(n).remove(),!("ontouchstart"in e)){if(a===s)return!1;if(i===l)return!1}return!0}var i="crocodoc-subpx-fix",r='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+new Array(100).join("A")+"</span>",o=n.getUtility("common"),s=a();return{fix:function(e){if(!s&&void 0!==document.body.style.zoom){var n=t("<div>").addClass(i);t(e).wrap(n)}return e},isSubpxSupported:function(){return s}}}),ke.addUtility("support",function(){function t(e){var t,i,r,o=document.createElement("div");if(e in o.style)return e;if(t=e.charAt(0).toUpperCase()+e.substr(1),e in o.style)return e;for(i=0;i<a.length;++i)if(r=a[i]+t,r in o.style)return 0===r.indexOf("ms")&&(r="-"+r),n(r);return!1}function n(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}var a=["Moz","Webkit","O","ms"],i=null,r=null;return{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:t("transform"),csstransition:t("transition"),csszoom:t("zoom"),isXHRSupported:function(){return null===i&&(i=!!this.getXHR()),i},isCORSSupported:function(){return null===r&&(r=this.isXHRSupported()&&"withCredentials"in this.getXHR()),r},isXDRSupported:function(){return"undefined"!=typeof e.XDomainRequest},getXHR:function(){if(e.XMLHttpRequest)return new e.XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}},getXDR:function(){return this.isXDRSupported()?new e.XDomainRequest:null}}}),ke.addUtility("url",function(t){var n,a=t.getUtility("browser");return{getCurrentURL:function(){return e.location.href},makeAbsolute:function(e){return this.parse(e).href},isCrossDomain:function(e){var t=this.parse(e);return n||(n=this.parse(this.getCurrentURL())),t.hostname?t.protocol!==n.protocol||t.hostname!==n.hostname||t.port!==n.port:!1},appendQueryParams:function(e,t){return e.indexOf("?")>-1?e+"&"+t:e+"?"+t},parse:function(e){var t,n=document.createElement("a");return n.href=e,a.ie&&e!==n.href&&(e=n.href,n.href=e),t=n.pathname,/^\//.test(t)||(t="/"+t),{href:n.href,protocol:n.protocol,host:n.host,hostname:n.hostname,port:n.port,pathname:t,hash:n.hash,search:n.search}}}}),ke.addComponent("controller-paged",function(e){function n(){var e=c.metadata;c.numPages=e.numpages,c.pageStart?c.pageStart<0&&(c.pageStart=e.numpages+c.pageStart):c.pageStart=1,c.pageStart=p.clamp(c.pageStart,1,e.numpages),c.pageEnd?c.pageEnd<0&&(c.pageEnd=e.numpages+c.pageEnd):c.pageEnd=e.numpages,c.pageEnd=p.clamp(c.pageEnd,c.pageStart,e.numpages),c.numPages=c.pageEnd-c.pageStart+1}function a(){var e,n,a,i,r,o,s,l,u=p.calculatePtSize(),d=c.metadata.dimensions,f="";for(c.pageScale=V/(d.width*u),a=c.zoomLevels[c.zoomLevels.length-1],i=3/c.pageScale;i>a;)a+=a/2,c.zoomLevels.push(a);for(d.exceptions=d.exceptions||{},e=c.pageStart-1;e<c.pageEnd;e++)n=e+1,n in d.exceptions?(r=d.exceptions[n].width,o=d.exceptions[n].height):(r=d.width,o=d.height),s=r*u,l=o*u,s*=c.pageScale,l*=c.pageScale,f+=p.template(ke.pageTemplate,{w:s,h:l});c.$pages=t(f).appendTo(c.$doc)}function i(e){return c.conversionIsComplete||0===e&&c.autoloadFirstPage?ne:te}function r(){var t,n,a=[],r=c.pageStart-1,s=c.pageEnd,l=o();for(t=r;s>t;t++)n=e.createComponent("page"),n.init(c.$pages.eq(t-r),{index:t,status:i(t),enableLinks:c.enableLinks,links:l[t],pageScale:c.pageScale,useSVG:c.useSVG}),a.push(n);c.pages=a}function o(){var e,t,n,a,i=c.pageStart,r=c.pageEnd,o=c.metadata.links||[],s=[];for(e=0,t=c.metadata.numpages;t>e;++e)s[e]=[];for(e=0,t=o.length;t>e;++e)if(n=o[e],!(n.pagenum<i||n.pagenum>r)){if(n.destination){if(a=n.destination.pagenum,i>a||a>r)continue;n.destination.pagenum=a-(i-1)}s[n.pagenum-1].push(n)}return s}function s(){l()}function l(){var e=p.getSelectedNode(),n=t(e).closest("."+w);u.find("."+d).removeClass(d),e&&u.has(e)&&n.addClass(d)}var c,u,f,p=e.getUtility("common");return{init:function(){c=e.getConfig(),u=c.$el,t(document).on("mouseup",s),n(),a(),r(),f=e.createComponent("lazy-loader"),f.init(c.pages)},destroy:function(){t(document).off("mouseup",s)}}}),ke.addComponent("controller-text",function(e){var n;return{init:function(){var a=e.getConfig();a.$textContainer=t(),n=e.get("page-text",1).then(function(e){var n=a.$doc.parent();a.$doc=t(e),n.html(a.$doc)})},destroy:function(){n.abort()}}}),ke.addComponent("dragger",function(n){function a(e){o.scrollTop(s.top-(e.clientY-l.y)),o.scrollLeft(s.left-(e.clientX-l.x)),e.preventDefault()}function i(e){n.broadcast("dragend"),c.off("mousemove",a),c.off("mouseup",i),e.preventDefault()}function r(e){n.broadcast("dragstart"),s={top:o.scrollTop(),left:o.scrollLeft()},l={x:e.clientX,y:e.clientY},c.on("mousemove",a),c.on("mouseup",i),e.preventDefault()}var o,s,l,c=t(e);return{init:function(e){o=t(e),o.on("mousedown",r)},destroy:function(){o.off("mousedown",r),o.off("mousemove",a),c.off("mouseup",i)}}}),ke.addComponent("layout-base",function(t){var n=t.getUtility("common");return{messages:["resize","scroll","scrollend"],onmessage:function(e,t){switch(e){case"resize":this.handleResize(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t)}},init:function(){var e=t.getConfig();this.config=e,this.$el=e.$el,this.$doc=e.$doc,this.$viewport=e.$viewport,this.$pages=e.$pages,this.numPages=e.numPages,this.layoutClass=_+e.layout,this.$el.addClass(this.layoutClass),this.initState()},initState:function(){var t=this.$viewport[0],n=t;t===e&&(n=document.documentElement),this.state={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,viewportDimensions:{clientWidth:n.clientWidth,clientHeight:n.clientHeight,offsetWidth:n.offsetWidth,offsetHeight:n.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},initialWidth:0,initialHeight:0,totalWidth:0,totalHeight:0},this.zoomLevels=[]},destroy:function(){this.$doc.removeAttr("style"),this.$el.removeClass(this.layoutClass)},setZoom:function(){},calculateNextZoomLevel:function(e){var t,n=!1,a=this.state.zoomState.zoom,i=this.zoomLevels;if(e===ke.ZOOM_IN){for(t=0;t<i.length;++t)if(i[t]>a){n=i[t];break}}else if(e===ke.ZOOM_OUT)for(t=i.length-1;t>=0;--t)if(i[t]<a){n=i[t];break}return n},isDraggable:function(){var e=this.state;return e.viewportDimensions.clientHeight<e.totalHeight||e.viewportDimensions.clientWidth<e.totalWidth},scrollBy:function(e,t){e=parseInt(e,10)||0,t=parseInt(t,10)||0,this.scrollToOffset(e+this.state.scrollLeft,t+this.state.scrollTop)},scrollToOffset:function(e,t){this.$viewport.scrollLeft(e),this.$viewport.scrollTop(t)},handleScroll:function(e){this.state.scrollTop=e.scrollTop,this.state.scrollLeft=e.scrollLeft},handleResize:function(){},handleScrollEnd:function(){},update:function(){},focus:function(){this.$viewport.focus()},extend:function(e){return n.extend({},this,e)}}}),ke.addComponent("layout-"+Q,["layout-paged"],function(e,t){var n=e.getUtility("common"),a=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(q),n=this.calculateZoomValue(z);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(t,n):a.mobile?n:Math.min(1,n)},calculateCurrentPage:function(){var e,t,a=this.state,i=a.pages;return e=n.bisectRight(i,a.scrollLeft,"x0")-1,t=n.bisectRight(i,a.scrollLeft+i[e].width/2,"x0")-1,1+t},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState,n=t.zoom,a=e.sumWidths,i=Math.floor(e.tallestPage.totalActualHeight*n),r=Math.max(a,e.viewportDimensions.clientWidth),o=Math.max(i,e.viewportDimensions.clientHeight);this.$doc.css({height:o,lineHeight:o+"px",width:r})}})}),ke.addComponent("layout-paged",["layout-base"],function(e,t){function n(e,t){var n,a,o,s,l=e.state,c="."+e.config.namespace+" ."+k,u=e.config.stylesheet,d=l.pages,f=t*e.config.pageScale,p=100/f;for(s=r.csstransform?r.csstransform+":scale("+f+");width:"+p+"%;height:"+p+"%;":r.csszoom?"zoom:"+f:"",l.previousStyleIndex&&i.deleteCSSRule(u,l.previousStyleIndex),l.previousStyleIndex=i.appendCSSRule(u,c,s),n=0,a=d.length;a>n;++n)o=d[n],e.$pages.eq(n).css({width:o.actualWidth*t,height:o.actualHeight*t,paddingTop:o.paddingTop*t,paddingRight:o.paddingRight*t,paddingBottom:o.paddingBottom*t,paddingLeft:o.paddingLeft*t})}function a(e,t){if(!t||0===t.length)return 1/0;var n=i.map(t,function(t){return e[t].y1});return Math.max.apply(Math,n)}var i=e.getUtility("common"),r=e.getUtility("support");return t.extend({init:function(){t.init.call(this),this.updatePageStates(),this.updateZoomLevels()},initState:function(){t.initState.call(this),i.extend(this.state,{pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],currentPage:null,visiblePages:[],fullyVisiblePages:[]})},destroy:function(){t.destroy.call(this),this.$pages.css("padding","")},update:function(){this.updatePageStates(!0),this.setZoom()},setZoom:function(t){var n,a,r=this.state,o=this.parseZoomValue(t),s=r.zoomState,l=s.zoom;n=this.calculateZoomMode(t,o),o=i.clamp(o,r.minZoom,r.maxZoom),e.broadcast("beforezoom",i.extend({page:r.currentPage,visiblePages:i.extend([],r.visiblePages),fullyVisiblePages:i.extend([],r.fullyVisiblePages)},s)),s.prevZoom=l,s.zoom=o,s.zoomMode=n,this.applyZoom(o),s.canZoomIn=this.calculateNextZoomLevel(ke.ZOOM_IN)!==!1,s.canZoomOut=this.calculateNextZoomLevel(ke.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),a=t===ke.ZOOM_AUTO||t===ke.ZOOM_FIT_WIDTH||t===ke.ZOOM_FIT_HEIGHT,this.updateScrollPosition(a),this.updatePageStates(),this.updateVisiblePages(!0),e.broadcast("zoom",i.extend({page:r.currentPage,visiblePages:i.extend([],r.visiblePages),fullyVisiblePages:i.extend([],r.fullyVisiblePages),isDraggable:this.isDraggable()},s))},parseZoomValue:function(e){var t=parseFloat(e),n=this.state,a=n.zoomState,i=a.zoom,r=i;if(t)r=t;else switch(e){case ke.ZOOM_FIT_WIDTH:case ke.ZOOM_FIT_HEIGHT:case ke.ZOOM_AUTO:r=this.calculateZoomValue(e);break;case ke.ZOOM_IN:case ke.ZOOM_OUT:r=this.calculateNextZoomLevel(e)||i;break;default:r=i?a.zoomMode?this.calculateZoomValue(a.zoomMode):i:this.calculateZoomValue(this.config.zoom||ke.ZOOM_AUTO)}return r},calculateZoomMode:function(e,t){switch(t){case this.calculateZoomValue(ke.ZOOM_AUTO):return"string"!=typeof e||e!==ke.ZOOM_FIT_WIDTH&&e!==ke.ZOOM_FIT_HEIGHT?ke.ZOOM_AUTO:e;case this.calculateZoomValue(ke.ZOOM_FIT_WIDTH):return ke.ZOOM_FIT_WIDTH;case this.calculateZoomValue(ke.ZOOM_FIT_HEIGHT):return ke.ZOOM_FIT_HEIGHT;default:return null}},updateZoomLevels:function(){function e(e){var t=n/e;return e===n?!1:de>t?!0:i.inArray(e,l)>-1&&fe>t?!0:!1}var t,n,a=this.config.zoomLevels.slice()||[1],r=this.calculateZoomValue(ke.ZOOM_AUTO),o=this.calculateZoomValue(ke.ZOOM_FIT_WIDTH),s=this.calculateZoomValue(ke.ZOOM_FIT_HEIGHT),l=[o,s];for(this.state.minZoom=this.config.minZoom||a[0],this.state.maxZoom=this.config.maxZoom||a[a.length-1],r!==o&&r!==s&&l.push(r),a=a.concat(l),a.sort(function(e,t){return e-t}),this.zoomLevels=[],n=0,t=0;t<a.length;++t)e(a[t])&&(n=a[t],this.zoomLevels.push(n))},calculateZoomValue:function(e){var t=this.state,n=parseFloat(e);return n?n:e===ke.ZOOM_FIT_WIDTH?t.viewportDimensions.clientWidth/t.widestPage.totalActualWidth:e===ke.ZOOM_FIT_HEIGHT?t.viewportDimensions.clientHeight/t.tallestPage.totalActualHeight:e===ke.ZOOM_AUTO?this.calculateZoomAutoValue():t.zoomState.zoom},applyZoom:function(e){n(this,e)},scrollTo:function(e){var t=this.state,n=parseInt(e,10);if("string"==typeof e){if(e===ke.SCROLL_PREVIOUS&&t.currentPage>1)n=this.calculatePreviousPage();else if(e===ke.SCROLL_NEXT&&t.currentPage<this.numPages)n=this.calculateNextPage();else if(!n)return}else if(!n&&0!==n)return;n=i.clamp(n,1,this.numPages),this.scrollToPage(n)},scrollToPage:function(e){var t=this.calculateScrollPositionForPage(e);this.scrollToOffset(t.left,t.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(e){var t=i.clamp(e-1,0,this.numPages-1),n=this.state.pages[t];return{top:n.y0,left:n.x0}},calculateVisibleRange:function(){var e=this.state,t=e.pages,n=e.viewportDimensions.clientHeight,a=e.viewportDimensions.clientWidth;if(0===a||0===n)return{min:-1,max:-1};var r=e.scrollTop,o=r+n,s=e.scrollLeft,l=s+a,c=i.bisectLeft(t,r,"y1"),u=i.bisectRight(t,o,"y0")-1,d=i.bisectLeft(t,s,"x1"),f=i.bisectRight(t,l,"x0")-1,p=Math.max(d,c),h=Math.min(f,u);return i.constrainRange(p,h,this.numPages-1)},calculateFullyVisibleRange:function(){var e=this.state,t=e.pages,n=e.viewportDimensions.clientHeight,a=e.viewportDimensions.clientWidth;if(0===a||0===n)return{min:-1,max:-1};var r=e.scrollTop,o=r+n,s=e.scrollLeft,l=s+a,c=i.bisectLeft(t,r,"y0"),u=i.bisectRight(t,o,"y1")-1,d=i.bisectLeft(t,s,"x0"),f=i.bisectRight(t,l,"x1")-1,p=Math.max(d,c),h=Math.min(f,u);return i.constrainRange(p,h,this.numPages-1)},setCurrentPage:function(t){var n=this.state;n.currentPage!==t?(n.currentPage=t,this.updateVisiblePages(),e.broadcast("pagefocus",{page:n.currentPage,numPages:this.numPages,visiblePages:i.extend([],n.visiblePages),fullyVisiblePages:i.extend([],n.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(e){var t,n,a,i=this.state,r=this.calculateVisibleRange(),o=this.calculateFullyVisibleRange();for(i.visiblePages.length=0,i.fullyVisiblePages.length=0,t=0,n=this.$pages.length;n>t;++t)a=this.$pages.eq(t),t<r.min||t>r.max?e&&a.hasClass(D)&&a.removeClass(D):(e&&!a.hasClass(D)&&a.addClass(D),i.visiblePages.push(t+1)),t>=o.min&&t<=o.max&&i.fullyVisiblePages.push(t+1)},updatePageStates:function(e){var t,n,i,r,o,s=this.state,l=s.pages,c=s.rows,u=this.$viewport.scrollTop(),d=this.$viewport.scrollLeft(),f=0,p=0,h=0,m=0;for(c.length=s.sumWidths=s.sumHeights=s.totalWidth=s.totalHeight=0,s.widestPage.totalActualWidth=s.tallestPage.totalActualHeight=0,t=0,n=this.$pages.length;n>t;++t)o=this.$pages.eq(t),r=o[0],i=l[t],(!i||e)&&(o.css("padding",""),i={index:t,paddingLeft:parseFloat(o.css(ce)),paddingRight:parseFloat(o.css(le)),paddingTop:parseFloat(o.css(se)),paddingBottom:parseFloat(o.css(ue))}),i.actualWidth||(i.actualWidth=parseFloat(r.getAttribute("data-width"))),i.actualHeight||(i.actualHeight=parseFloat(r.getAttribute("data-height"))),i.totalActualWidth=i.actualWidth+i.paddingLeft+i.paddingRight,i.totalActualHeight=i.actualHeight+i.paddingTop+i.paddingBottom,i.width=r.offsetWidth,i.height=r.offsetHeight,i.x0=r.offsetLeft,i.y0=r.offsetTop,i.x1=i.width+i.x0,i.y1=i.height+i.y0,p&&a(l,c[f])<=i.y0+2&&f++,p=i.y1,c[f]||(c[f]=[]),i.totalActualWidth>s.widestPage.totalActualWidth&&(s.widestPage=i),i.totalActualHeight>s.tallestPage.totalActualHeight&&(s.tallestPage=i),s.sumWidths+=i.width,s.sumHeights+=i.height,i.rowIndex=f,l[t]=i,c[f].push(t),l[h].x0+l[h].width<i.x0+i.width&&(h=t),l[m].y0+l[m].height<i.y0+i.height&&(m=t);s.totalWidth=l[h].x0+l[h].width,s.totalHeight=l[m].y0+l[m].height,s.scrollTop=u,s.scrollLeft=d,this.setCurrentPage(this.calculateCurrentPage())},updateCurrentPage:function(){var e=this.calculateCurrentPage();this.setCurrentPage(e)},handleResize:function(e){var t=this.state.zoomState.zoomMode;this.state.viewportDimensions=e,this.updateZoomLevels(),this.setZoom(t)},handleScrollEnd:function(e){this.$doc.find("."+y).removeClass(y),this.$pages.eq(this.state.currentPage-1).addClass(y),this.updateVisiblePages(!0),this.handleScroll(e)},updateScrollPosition:function(e){var t,n,a=this.state,i=a.zoomState,r=i.zoom/i.prevZoom;t=a.scrollLeft*r,n=a.scrollTop*r,e!==!0&&(n+=a.viewportDimensions.offsetHeight*(r-1)/2,
t+=a.viewportDimensions.offsetWidth*(r-1)/2),this.scrollToOffset(t,n)},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}})}),ke.addComponent("layout-"+J,["layout-"+Y],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){this.twoPageMode=!0,t.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(e){var n=t.calculateZoomValue.call(this,e);return e===q&&(n/=2),n},scrollToPage:function(e){t.scrollToPage.call(this,e-(e+1)%2)},calculateVisibleRange:function(){var e=this.state.currentPage-1,t=e+1;return n.constrainRange(e,t,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),ke.addComponent("layout-"+Y,["layout-paged"],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){t.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(L)},calculateZoomAutoValue:function(){var e=this.calculateZoomValue(q),t=this.calculateZoomValue(z);return Math.min(e,t)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var e=this.state.currentPage-1;return n.constrainRange(e,e,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(e){var a,i,r=n.clamp(e-1,0,this.numPages);t.setCurrentPage.call(this,e),this.$doc.find("."+b).removeClass(b),a=this.$doc.find("."+y),i=this.$pages.eq(r),a[0]!==i[0]&&(a.addClass(b).removeClass(y),i.addClass(y)),this.updateVisiblePages(!0),this.updatePageClasses(r)},scrollToPage:function(e){this.setCurrentPage(e)},updateLayout:function(){var e,t,n,a,i,r,o,s=this.state,l=s.zoomState,c=l.zoom,u=this.currentPage||1,d=s.pages[u-1],f=this.twoPageMode?s.pages[u]:d,p=s.viewportDimensions.clientWidth,h=s.viewportDimensions.clientHeight;e=f.actualWidth,t=d.actualWidth+(this.twoPageMode?e:0),n=d.actualHeight,a=Math.floor((t+d.paddingLeft+f.paddingRight)*c),i=Math.floor(d.totalActualHeight*c),r=Math.max(a,p),o=Math.max(i,h),this.$doc.css({width:r,height:o}),this.updatePageMargins(),r>p||o>h?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var e,t,n,a,i,r,o,s,l,c=this.state,u=c.viewportDimensions.clientWidth,d=c.viewportDimensions.clientHeight;for(e=0,t=this.$pages.length;t>e;++e)a=this.$pages.eq(e),n=c.pages[e],l=this.twoPageMode?e%2===1?n.paddingRight:n.paddingLeft:n.paddingRight+n.paddingLeft,i=(n.actualWidth+l)*c.zoomState.zoom,r=(n.actualHeight+n.paddingTop+n.paddingBottom)*c.zoomState.zoom,this.twoPageMode?(o=Math.max(0,(u-2*i)/2),e%2===1&&(o+=i)):o=(u-i)/2,s=(d-r)/2,o=Math.max(o,0),s=Math.max(s,0),a.css({marginLeft:o,marginTop:s})},updatePageClasses:function(){var e=this.$pages,t=this.state.currentPage-1,n=t+1,a=t-1,i=20;e.removeClass(L),this.twoPageMode?(n=t+2,a=t-2,e.slice(Math.max(a,0),t).addClass(P),e.slice(n,n+2).addClass(M)):(a>=0&&e.eq(a).addClass(P),n<this.numPages&&e.eq(n).addClass(M)),e.slice(0,t).addClass(O),e.slice(Math.max(0,t-i),t).addClass(I),e.slice(n).addClass($),e.slice(n,Math.min(this.numPages,n+i)).addClass(H)}})}),ke.addComponent("layout-"+ee,["layout-base"],function(e,t){var n=e.getUtility("common");return t.extend({init:function(){t.init.call(this),this.zoomLevels=this.config.zoomLevels.slice(),this.minZoom=this.zoomLevels[0],this.maxZoom=this.zoomLevels[this.zoomLevels.length-1]},setZoom:function(t){var a,i=this.state.zoomState,r=i.zoom;"string"==typeof t?(a=this.calculateNextZoomLevel(t),a||(a="auto"===t||"fitwidth"===t||"fitheight"===t?1:r)):a=parseFloat(t)||r,a=n.clamp(a,this.minZoom,this.maxZoom),this.config.$doc.css("font-size",10*a+"pt"),i.prevZoom=r,i.zoom=a,i.canZoomIn=this.calculateNextZoomLevel(ke.ZOOM_IN)!==!1,i.canZoomOut=this.calculateNextZoomLevel(ke.ZOOM_OUT)!==!1,e.broadcast("zoom",n.extend({isDraggable:this.isDraggable()},i))}})}),ke.addComponent("layout-"+X,["layout-"+K],function(e,t){return t}),ke.addComponent("layout-"+K,["layout-paged"],function(e,t){var n=e.getUtility("common"),a=e.getUtility("browser");return t.extend({calculateZoomAutoValue:function(){var e=this.state,t=this.calculateZoomValue(q),n=this.calculateZoomValue(z);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(1,t,n):a.mobile?t:Math.min(1,t)},calculateCurrentPage:function(){var e,t,a,i,r,o=this.state,s=o.pages;return e=n.bisectRight(s,o.scrollTop,"y0")-1,0>e?1:(r=o.scrollTop+s[e].height/2,t=n.bisectRight(s,r,"y0")-1,a=s[t].rowIndex,i=o.rows[a],1+i[0])},calculateNextPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,a=e.rows[n+1];return a&&a[0]+1||e.currentPage},calculatePreviousPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,a=e.rows[n-1];return a&&a[0]+1||e.currentPage},handleResize:function(e){t.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){t.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e,t,n=this.state,a=n.zoomState.zoom;e=Math.floor(n.widestPage.totalActualWidth*a),t=e<=n.viewportDimensions.clientWidth?"auto":e,this.$doc.css({width:t})}})}),ke.addComponent("lazy-loader",function(e){function n(e){e=e||C;var t=E.page-1,n=t-e,a=t+e;return _.constrainRange(n,a,h-1)}function a(){var e;clearTimeout(v),w.length>0?(e=w.shift(),p[e]?b.loadPage(e,function(e){e===!1?a():v=setTimeout(a,pe)}):a()):r()}function i(){clearTimeout(v),x=!1,v=setTimeout(a,pe)}function r(){clearTimeout(v),x=!0}function o(e){w.push(e),x&&i()}function s(){w.length=0,r()}function l(e,t){var a=n(t);return e>=a.min&&e<=a.max?!0:!1}function c(e){var t=p[e];if(t){if(l(e))return!0;if(d(e))return!0}return!1}function u(e,t){return l(e,t)?!1:d(e)?!1:!0}function d(e){return _.inArray(e+1,E.visiblePages)>-1}function f(e,t){for(var n=_.sign(t-e);e!==t;)b.queuePageToLoad(e),e+=n;b.queuePageToLoad(e)}var p,h,m,g,v,_=e.getUtility("common"),y=e.getUtility("browser"),b={},w=[],C=1,x=!0,T=1,S=!1,E={page:1,visiblePages:[1]};return _.extend(b,{messages:["beforezoom","pageavailable","pagefocus","ready","scroll","scrollend","zoom"],onmessage:function(e,t){switch(e){case"beforezoom":this.handleBeforeZoom(t);break;case"pageavailable":this.handlePageAvailable(t);break;case"pagefocus":this.handlePageFocus(t);break;case"ready":this.handleReady();break;case"scroll":this.handleScroll();break;case"scrollend":this.handleScrollEnd();break;case"zoom":this.handleZoom(t)}},init:function(e){p=e,h=p.length,C=y.mobile||y.ielt10?me:he,C=Math.min(C,h)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(e){T=_.sign(e.page-E.page),E=e},loadNecessaryPages:_.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(E.page-1),this.loadVisiblePages(),this.loadPagesInRange(C)}),loadPagesInRange:function(e){var t=E.page-1;e>0&&(e=n(e),T>=0?(f(t+1,e.max),f(t-1,e.min)):(f(t-1,e.min),f(t+1,e.max)))},loadVisiblePages:function(){var e,t;for(e=0,t=E.visiblePages.length;t>e;++e)this.queuePageToLoad(E.visiblePages[e]-1)},queuePageToLoad:function(e){c(e)&&(p[e].preload(),o(e))},cancelAllLoading:function(){clearTimeout(g),clearTimeout(m),s()},loadPage:function(e,n){t.when(p[e]&&p[e].load()).always(n)},unloadPage:function(e){var t=p[e];t&&t.unload()},unloadUnnecessaryPages:function(e){var t,n;for(t=0,n=p.length;n>t;++t)u(t,e)&&this.unloadPage(t)},handleReady:function(){S=!0,this.loadVisiblePages(),g=setTimeout(function(){b.loadNecessaryPages()},ge)},handlePageAvailable:function(e){if(S){var t;if(e.all===!0&&(e.upto=h),e.page)this.queuePageToLoad(e.page-1);else if(e.upto)for(t=0;t<e.upto;++t)this.queuePageToLoad(t)}},handlePageFocus:function(e){this.updateLayoutState(e),S&&(this.cancelAllLoading(),m=setTimeout(function(){b.loadNecessaryPages()},200))},handleBeforeZoom:function(e){S&&(this.cancelAllLoading(),this.unloadUnnecessaryPages(2*e.visiblePages.length))},handleZoom:function(e){this.updateLayoutState(e),S&&this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){S&&(this.loadNecessaryPages(),this.unloadUnnecessaryPages(C))}})}),ke.addComponent("page-img",function(e){var n,a,i,r,o=e.getUtility("browser"),s=!1,l=o.mobile;return{init:function(e,n){a=t(e),r=n},destroy:function(){l=!0,this.unload(),a.empty()},prepare:function(){},preload:function(){i||(i=e.get("page-img",r))},load:function(){return this.preload(),i.done(function(e){s||(s=!0,n=t(e).appendTo(a))}),i.fail(function(t){s=!1,t&&e.broadcast("asseterror",t)}),i},unload:function(){i&&(i.abort(),i=null),l&&(n&&(n.remove(),n=null),s=!1)}}}),ke.addComponent("page-links",function(e){function n(e){var n=t("<a>").addClass(E),o=e.bbox[0],s=e.bbox[1],l={};if(r.ie&&t("<span>").appendTo(n).on("click",a),n.css({left:o+"pt",top:s+"pt",width:e.bbox[2]-o+"pt",height:e.bbox[3]-s+"pt"}),e.uri){if(!/^http|^mailto/.test(e.uri))return;l.href=encodeURI(e.uri),l.target="_blank",l.rel="noreferrer"}else e.destination&&(l.href="#page-"+e.destination.pagenum);n.attr(l),n.data("link",e),n.appendTo(i)}function a(n){var a=r.ie?n.target.parentNode:n.target,i=t(a),o=i.data("link");o&&e.broadcast("linkclick",o),n.preventDefault()}var i,r=e.getUtility("browser");return{init:function(e,n){i=t(e),this.createLinks(n),r.ie||i.on("click","."+E,a)},destroy:function(){i.empty().off("click"),i=r=null},createLinks:function(e){var t,a;for(t=0,a=e.length;a>t;++t)n(e[t])}}}),ke.addComponent("page-svg",function(n){function a(){switch(w){case be:case Ee:return t("<iframe>");case Se:case we:return t("<object>").attr({type:ve,data:"data:"+ve+";base64,"+e.btoa(ye)});case Ce:return t("<div>");case xe:return t("<object>");case Te:case Re:return t("<img>")}}function i(){u&&0!==u.length||(_=!1,u=a()),0===u.parent().length&&u.appendTo(d)}function r(){return _||w===xe||w===Te?t.Deferred().resolve().promise({abort:function(){}}):n.get("page-svg",p)}function o(e){var t=e.querySelectorAll("use");[].forEach.call(t,function(t){var n=t.getAttribute("xlink:href"),a=e.querySelector(n).cloneNode(),i=t.parentNode;a.removeAttribute("id"),a.setAttribute("transform",t.getAttribute("transform")),i.replaceChild(a,t)})}function s(t){var a,i,r,s,l,c=u[0].contentDocument,d=u[0].contentWindow||c&&c.defaultView;switch(w){case be:h.ielt10&&(t=t.replace(/<xhtml:link.*/,"")),s=_e+t,h.ielt10?c.body.innerHTML=s:(c.documentElement.innerHTML=s,(h.ios||h.safari)&&h.version<7&&o(c)),r=c.getElementsByTagName("svg")[0];break;case Ee:c.documentElement.innerHTML=_e;var f=c.getElementsByTagName("head")[0]||c.documentElement,g=c.createElement("script"),v="("+proxySVG+")()";g.type="text/javascript";try{g.appendChild(document.createTextNode(v))}catch(_){g.text=v}return f.insertBefore(g,f.firstChild),void("complete"===c.readyState?d.loadSVG(t):d.onload=function(){this.loadSVG(t)});case we:a=new m,i=a.parseFromString(t,ve),r=c.importNode(i.documentElement,!0),c.documentElement.appendChild(r);break;case Se:d.loadSVG(t),r=c.querySelector("svg");break;case Ce:a=new m,i=a.parseFromString(t,ve),r=document.importNode(i.documentElement,!0),u.append(r);break;case xe:u.attr({type:ve,data:n.getDataProvider("page-svg").getURL(p)}),r=u[0];break;case Te:r=u[0],r.src=n.getDataProvider("page-svg").getURL(p);break;case Re:r=u[0],l="data:"+ve,r.src=!h.ie&&e.btoa?l+";base64,"+e.btoa(t):l+","+encodeURIComponent(t)}r.setAttribute("width","100%"),r.setAttribute("height","100%")}function l(e){g||v||(!_&&e&&(s(e),_=!0,b||(f.abort(),f=null)),0===u.parent().length&&u.appendTo(d))}function c(e){n.broadcast("asseterror",e),_=!1,f&&f.abort()}var u,d,f,p,h=n.getUtility("browser"),m=e.DOMParser,g=!1,v=!1,_=!1,y=n.getConfig(),b=h.mobile||h.ielt10,w=h.ielt11||h.firefox?Re:be;return{init:function(e,t){d=e,p=t,w=y.embedStrategy||w},destroy:function(){g=!0,b=!0,this.unload(),d.empty()},prepare:function(){i()},preload:function(){this.prepare(),f||(f=r())},load:function(){return v=!1,this.preload(),f.done(l).fail(c),f},unload:function(){v=!0,f&&"resolved"!==f.state()&&(f.abort(),f=null),b&&(u&&(u.remove(),u=null),_=!1)}}}),ke.addComponent("page-text",function(e){function n(){return p.enableTextSelection&&!c.ielt9}function a(e){var t,n;!e||f||d||(f=!0,t=document.implementation.createHTMLDocument(""),t.getElementsByTagName("body")[0].innerHTML=e,e=null,n=document.importNode(t.querySelector("."+S),!0),o.attr("class",n.getAttribute("class")),o.html(n.innerHTML),u.fix(o))}function i(t){t&&e.broadcast("asseterror",t)}function r(){return s||(s=n()?e.get("page-text",l):t.Deferred().resolve().promise({abort:function(){}})),s}var o,s,l,c=e.getUtility("browser"),u=e.getUtility("subpx"),d=!1,f=!1,p=e.getConfig();return{init:function(e,t){o=e,l=t},destroy:function(){d=!0,this.unload(),o.empty()},preload:function(){r()},load:function(){return r().done(a).fail(i)},unload:function(){s&&"resolved"!==s.state()&&(s.abort(),s=null)},enable:function(){o.css("display",""),s&&!f&&(s=null)},disable:function(){o.css("display","none")}}}),ke.addComponent("page",function(e){var n,a,i,r,o,s,l,c,u=e.getUtility("support"),d=e.getUtility("common"),f=!1;return{messages:["pageavailable","pagefocus","textenabledchange","zoom"],onmessage:function(e,t){switch(e){case"pageavailable":(t.page===s+1||t.upto>s||t.all===!0)&&c===te&&(c=ne);break;case"textenabledchange":t.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":l=o===t.page||d.inArray(o,t.visiblePages)>-1}},init:function(t,l){var d,f,p;n=t,f=t.find("."+T),d=t.find("."+S),p=t.find("."+R),c=l.status||ne,s=l.index,o=s+1,this.config=l,l.url=l.url||"",a=e.createComponent("page-text"),void 0===l.useSVG&&(l.useSVG=!0),i=e.createComponent(u.svg&&l.useSVG?"page-svg":"page-img"),a.init(d,o),i.init(f,o),l.enableLinks&&l.links.length&&(r=e.createComponent("page-links"),r.init(p,l.links))},destroy:function(){this.unload()},preload:function(){i.prepare(),c===ne&&(i.preload(),a.preload())},load:function(){var r=this;return f=!0,c===re?!1:c===te?!1:(c!==ie&&(c=ae),t.when(i.load(),a.load()).done(function(){f?c!==ie&&(n.removeClass(A),c=ie,e.broadcast("pageload",{page:o})):r.unload()}).fail(function(t){c=re,n.addClass(N),e.broadcast("pagefail",{page:s+1,error:t})}))},unload:function(){f=!1,i.unload(),a.unload(),c===ie&&(c=ne,n.addClass(A),n.removeClass(N),e.broadcast("pageunload",{page:o}))},enableTextSelection:function(){a.enable(),l&&a.load()},disableTextSelection:function(){a.disable()}}}),ke.addComponent("resizer",function(n){function a(){n.broadcast("resize",{width:u,height:d,clientWidth:l,clientHeight:c,offsetWidth:u,offsetHeight:d})}function i(){var e=f.getComputedStyle(s);e&&"static"===e.position&&t(s).css({position:"relative"})}function r(){var e=t('<iframe frameborder="0">'),n=t("<div>");e.add(n).css({opacity:0,visiblility:"hidden",position:"absolute",width:"100%",height:"100%",top:0,left:0,border:0}),e.prependTo(n.prependTo(s)),i(),h=t(e[0].contentWindow),h.on("resize",o)}function o(){var t=s.offsetHeight,r=s.offsetWidth;return v&&0===g&&0!==e.innerWidth?(g=e.innerWidth,i(),void n.broadcast("layoutchange")):void(t&&(t!==d||r!==u)&&(d=t,u=r,c=s.clientHeight,l=s.clientWidth,a()))}var s,l,c,u,d,f=n.getUtility("common"),p=[""," webkit"," moz"," "].join("fullscreenchange")+"MSFullscreenChange",h=t(e),m=t(document),g=0,v=function(){try{return e.self!==e.top}catch(t){return!0}}();return{messages:["layoutchange"],onmessage:function(){d=null,o()},init:function(n){s=t(n).get(0),s===e?(s=document.documentElement,h.on("resize",o)):r(),m.on(p,o),o()},destroy:function(){m.off(p,o),h.off("resize",o)}}}),ke.addComponent("scroller",function(e){function n(){return{scrollTop:c.scrollTop(),scrollLeft:c.scrollLeft()}}function a(){v=!1,C=null,clearTimeout(u),e.broadcast("scrollend",n())}function i(){v||(v=!0,e.broadcast("scrollstart",n())),clearTimeout(u),u=setTimeout(a,g),x()}function r(){_=!0,y=!1,b=!1,i()}function o(){b=!0,i()}function s(){_=!1,y=!0,w=(new Date).getTime(),b&&l()}function l(){return clearTimeout(u),null===C&&(C=(new Date).getTime()),(new Date).getTime()-C>p?void a():(x(),void(u=setTimeout(l,h)))}var c,u,d=e.getUtility("common"),f=e.getUtility("browser"),p=3e3,h=30,m=200,g=f.mobile?500:250,v=!1,_=!1,y=!1,b=!1,w=0,C=null,x=d.throttle(m,function(){e.broadcast("scroll",n())});return{init:function(e){c=t(e),c.on("scroll",i),c.on("touchstart",r),c.on("touchmove",o),c.on("touchend",s)},destroy:function(){clearTimeout(u),c.off("scroll",i),c.off("touchstart",r),c.off("touchmove",o),c.off("touchend",s)}}}),ke.addComponent("viewer-base",function(n){function a(){C.attr(i,w.metadata.version||"0.0.0"),N.mobile&&C.addClass(h),N.ielt9&&C.addClass(m),D.svg&&w.useSVG&&C.addClass(g)}function l(){C.html(ke.viewerTemplate),w.useWindowAsViewport?(w.$viewport=t(e),C.addClass(v)):w.$viewport=C.find("."+s),w.$doc=C.find("."+o)}function d(){var e,t,a=w.plugins||{};for(e in a)t=n.createComponent("plugin-"+e),t&&A.isFn(t.init)&&t.init(w.plugins[e])}function f(){a(),S=n.createComponent("scroller"),S.init(w.$viewport),E=n.createComponent("resizer"),E.init(w.$viewport);var e;switch(w.metadata.type){case"text":e=n.createComponent("controller-text"),w.layout=ee;break;case"paged":default:e=n.createComponent("controller-paged")}e.init(),"text"===w.metadata.type?w.enableTextSelection||b.disableTextSelection():N.ielt9&&b.disableTextSelection(),(!w.enableLinks||N.ielt9)&&b.disableLinks(),b.setLayout(w.layout),n.broadcast("ready",{page:w.page||1,numPages:w.numPages}),n.ready()}function p(t){var n=b.fire("linkclick",t);n.isDefaultPrevented()||(t.uri?e.open(t.uri):t.destination&&b.scrollTo(t.destination.pagenum))}function _(e){e?R||(C.addClass(c),R=n.createComponent("dragger"),R.init(w.$viewport)):R&&(C.removeClass(c),n.destroyComponent(R),R=null)}function y(){var e;w.queryParams&&(e="string"==typeof w.queryParams?w.queryParams.replace(/^\?/,""):A.param(w.queryParams)),w.queryString=e?"?"+e:""}var b,w,C,x,T,S,E,R,k,A=n.getUtility("common"),N=n.getUtility("browser"),D=n.getUtility("support");return{messages:["asseterror","destroy","dragend","dragstart","fail","layoutchange","linkclick","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(e,t){switch(e){case"layoutchange":b.updateLayout();break;case"linkclick":p(t);break;case"zoom":t.zoom*=w.pageScale,t.prevZoom*=w.pageScale,w.enableDragging&&_(t.isDraggable),b.fire(e,t);break;case"dragstart":C.hasClass(u)||C.addClass(u),b.fire(e,t);break;case"dragend":C.hasClass(u)&&C.removeClass(u),b.fire(e,t);break;default:b.fire(e,t)}},init:function(){if(w=n.getConfig(),b=w.api,w.namespace=r+"-"+w.id,C=w.$el,C.addClass(r),C.addClass(w.namespace),!w.url)throw new Error("no URL given for viewer assets");/\/$/.test(w.url)||(w.url+="/"),w.url=n.getUtility("url").makeAbsolute(w.url),void 0===w.useSVG&&(w.useSVG=!0),y(),l(),d()},destroy:function(){C.empty().removeClass(function(e,t){var n=t.match(new RegExp("crocodoc\\S+","g"));return n&&n.join(" ")}),t(x).remove(),k&&k.abort()},setLayout:function(e){var t,a=w.page,i=w.zoom||1,r=w.layout;if(T){if(e===r)return T;a=T.state.currentPage,i=T.state.zoomState}if(t=n.createComponent("layout-"+e),!t)throw new Error("Invalid layout "+e);return T&&n.destroyComponent(T),w.layout=e,T=t,T.init(),T.setZoom(i.zoomMode||i.zoom||i),A.isFn(T.scrollTo)&&T.scrollTo(a),w.currentLayout=T,n.broadcast("layoutchange",{previousLayout:r,layout:e}),T},loadAssets:function(){var e,a,i,r;k||(a=n.get("metadata"),a.then(function(e){w.metadata=e}),N.ielt9?(x=A.insertCSS(""),w.stylesheet=x.styleSheet,e=t.when("").promise({abort:function(){}})):(e=n.get("stylesheet"),e.then(function(e){x=A.insertCSS(e),w.stylesheet=x.sheet})),!w.autoloadFirstPage||w.pageStart&&1!==w.pageStart||(D.svg&&w.useSVG?i=n.get("page-svg",1):w.conversionIsComplete&&(i=n.get("page-img",1)),w.enableTextSelection&&(r=n.get("page-text",1))),k=t.when(a,e).fail(function(e){k&&k.abort(),n.ready(),n.broadcast("asseterror",e),n.broadcast("fail",e)}).then(f).promise({abort:function(){k=null,a.abort(),e.abort(),i&&i.abort(),r&&r.abort()}}))}}}),ke})}("undefined"!=typeof window?window:this),Box.Timing.execution.push({name:"js/vendor/rangy/rangy-core-1.2.3.js",time:(new Date).getTime()}),window.rangy=function(){function e(e,t){var n=typeof e[t];return n==d||!(n!=u||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=u||!e[t])}function n(e,t){return typeof e[t]!=f}function a(e){return function(t,n){for(var a=n.length;a--;)if(!e(t,n[a]))return!1;return!0}}function i(e){return e&&v(e,g)&&y(e,m)}function r(e){window.alert("Rangy not supported in your browser. Reason: "+e),b.initialized=!0,b.supported=!1}function o(e){var t="Rangy warning: "+e;b.config.alertOnWarn?window.alert(t):typeof window.console!=f&&typeof window.console.log!=f&&window.console.log(t)}function s(){if(!b.initialized){var n,a=!1,o=!1;e(document,"createRange")&&(n=document.createRange(),v(n,h)&&y(n,p)&&(a=!0),n.detach());var s=t(document,"body")?document.body:document.getElementsByTagName("body")[0];s&&e(s,"createTextRange")&&(n=s.createTextRange(),i(n)&&(o=!0)),a||o||r("Neither Range nor TextRange are implemented"),b.initialized=!0,b.features={implementsDomRange:a,implementsTextRange:o};for(var l=C.concat(w),c=0,u=l.length;u>c;++c)try{l[c](b)}catch(d){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",d)}}}function l(e){e=e||window,s();for(var t=0,n=x.length;n>t;++t)x[t](e)}function c(e){this.name=e,this.initialized=!1,this.supported=!1}var u="object",d="function",f="undefined",p=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],h=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],m=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],v=a(e),_=a(t),y=a(n),b={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:v,areHostObjects:_,areHostProperties:y,isTextRange:i},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};b.fail=r,b.warn=o,{}.hasOwnProperty?b.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:r("hasOwnProperty not supported");var w=[],C=[];b.init=s,b.addInitListener=function(e){b.initialized?e(b):w.push(e)};var x=[];b.addCreateMissingNativeApiListener=function(e){x.push(e)},b.createMissingNativeApi=l,c.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},c.prototype.warn=function(e){b.warn("Module "+this.name+": "+e)},c.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},b.createModule=function(e,t){var n=new c(e);b.modules[e]=n,C.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},b.requireModules=function(e){for(var t,n,a=0,i=e.length;i>a;++a){if(n=e[a],t=b.modules[n],!(t&&t instanceof c))throw new Error("Module '"+n+"' not found");if(!t.supported)throw new Error("Module '"+n+"' not supported")}};var T=!1,S=function(e){T||(T=!0,b.initialized||s())};return typeof window==f?void r("No window found"):typeof document==f?void r("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",S,!1),e(window,"addEventListener")?window.addEventListener("load",S,!1):e(window,"attachEvent")?window.attachEvent("onload",S):r("Window does not have required addEventListener or attachEvent method"),b)}(),rangy.createModule("DomUtil",function(e,t){function n(e){var t;return typeof e.namespaceURI==S||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function a(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)t++;return t}function r(e){var t;return c(e)?e.length:(t=e.childNodes)?t.length:0}function o(e,t){var n,a=[];for(n=e;n;n=n.parentNode)a.push(n);for(n=t;n;n=n.parentNode)if(A(a,n))return n;return null}function s(e,t,n){for(var a=n?t:t.parentNode;a;){if(a===e)return!0;a=a.parentNode}return!1}function l(e,t,n){for(var a,i=n?e:e.parentNode;i;){if(a=i.parentNode,a===t)return i;i=a}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e,t){var n=t.nextSibling,a=t.parentNode;return n?a.insertBefore(e,n):a.appendChild(e),e}function d(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),u(n,e),n}function f(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=S)return e.ownerDocument;if(typeof e.document!=S)return e.document;if(e.parentNode)return f(e.parentNode);throw new Error("getDocument: no document found for node")}function p(e){var t=f(e);if(typeof t.defaultView!=S)return t.defaultView;if(typeof t.parentWindow!=S)return t.parentWindow;throw new Error("Cannot get a window object for node")}function h(e){if(typeof e.contentDocument!=S)return e.contentDocument;if(typeof e.contentWindow!=S)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function m(e){if(typeof e.contentWindow!=S)return e.contentWindow;if(typeof e.contentDocument!=S)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function g(e){return E.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function v(e){for(var t;t=e.parentNode;)e=t;return e}function _(e,t,n,a){var r,s,c,u,d;if(e==n)return t===a?0:a>t?-1:1;if(r=l(n,e,!0))return t<=i(r)?-1:1;if(r=l(e,n,!0))return i(r)<a?-1:1;if(s=o(e,n),c=e===s?s:l(e,s,!0),u=n===s?s:l(n,s,!0),c===u)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(d=s.firstChild;d;){if(d===c)return-1;if(d===u)return 1;d=d.nextSibling}throw new Error("Should not be here!")}function y(e){for(var t,n=f(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function b(e){if(!e)return"[No node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function w(e){this.root=e,this._next=e}function C(e){return new w(e)}function x(e,t){this.node=e,this.offset=t}function T(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var S="undefined",E=e.util;E.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),E.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var R=document.createElement("div");E.areHostMethods(R,["insertBefore","appendChild","cloneNode"]||!E.areHostObjects(R,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),E.isHostProperty(R,"innerHTML")||t.fail("Element is missing innerHTML property");var k=document.createTextNode("test");E.areHostMethods(k,["splitText","deleteData","insertData","appendData","cloneNode"]||!E.areHostObjects(R,["previousSibling","nextSibling","childNodes","parentNode"])||!E.areHostProperties(k,["data"]))||t.fail("Incomplete Text Node implementation");var A=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},x.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+b(this.node)+":"+this.offset+")]"}},T.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},T.prototype.toString=function(){return this.message},e.dom={arrayContains:A,isHtmlNamespace:n,parentElement:a,getNodeIndex:i,getNodeLength:r,getCommonAncestor:o,isAncestorOf:s,getClosestAncestorIn:l,isCharacterDataNode:c,insertAfter:u,splitDataNode:d,getDocument:f,getWindow:p,getIframeWindow:m,getIframeDocument:h,getBody:g,getRootContainer:v,comparePoints:_,inspectNode:b,fragmentFromNodeChildren:y,createIterator:C,DomPosition:x},e.DOMException=T}),rangy.createModule("DomRange",function(e,t){function n(e,t){return 3!=e.nodeType&&(L.isAncestorOf(e,t.startContainer,!0)||L.isAncestorOf(e,t.endContainer,!0))}function a(e){return L.getDocument(e.startContainer)}function i(e,t,n){var a=e._listeners[t];if(a)for(var i=0,r=a.length;r>i;++i)a[i].call(e,{target:e,args:n})}function r(e){return new B(e.parentNode,L.getNodeIndex(e))}function o(e){return new B(e.parentNode,L.getNodeIndex(e)+1)}function s(e,t,n){var a=11==e.nodeType?e.firstChild:e;return L.isCharacterDataNode(t)?n==t.length?L.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:L.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),a}function l(e){for(var t,n,i,r=a(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(l(i)),i.detach(!0)),10==n.nodeType)throw new j("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function c(e,t,n){var a,i;n=n||{stop:!1};for(var r,o;r=e.next();)if(e.isPartiallySelectedSubtree()){if(t(r)===!1)return void(n.stop=!0);if(o=e.getSubtreeIterator(),c(o,t,n),o.detach(!0),n.stop)return}else for(a=L.createIterator(r);i=a.next();)if(t(i)===!1)return void(n.stop=!0)}function u(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),u(t),t.detach(!0)):e.remove()}function d(e){for(var t,n,i=a(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(d(n)),n.detach(!0)):e.remove(),10==t.nodeType)throw new j("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function f(e,t,n){var a,i=!(!t||!t.length),r=!!n;i&&(a=new RegExp("^("+t.join("|")+")$"));var o=[];return c(new h(e,!1),function(e){i&&!a.test(e.nodeType)||r&&!n(e)||o.push(e)}),o}function p(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+L.inspectNode(e.startContainer)+":"+e.startOffset+", "+L.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function h(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&L.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||L.isCharacterDataNode(this.sc)?L.getClosestAncestorIn(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||L.isCharacterDataNode(this.ec)?L.getClosestAncestorIn(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function g(e,t,n){this.nodes=f(e,t,n),this._next=this.nodes[0],this._position=0}function v(e){return function(t,n){for(var a,i=n?t:t.parentNode;i;){if(a=i.nodeType,L.arrayContains(e,a))return i;i=i.parentNode}return null}}function _(e,t){if(K(e,t))throw new m("INVALID_NODE_TYPE_ERR")}function y(e){if(!e.startContainer)throw new j("INVALID_STATE_ERR")}function b(e,t){if(!L.arrayContains(t,e.nodeType))throw new m("INVALID_NODE_TYPE_ERR");

}function w(e,t){if(0>t||t>(L.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new j("INDEX_SIZE_ERR")}function C(e,t){if(Z(e,!0)!==Z(t,!0))throw new j("WRONG_DOCUMENT_ERR")}function x(e){if(G(e,!0))throw new j("NO_MODIFICATION_ALLOWED_ERR")}function T(e,t){if(!e)throw new j(t)}function S(e){return!L.arrayContains(q,e.nodeType)&&!Z(e,!0)}function E(e,t){return t<=(L.isCharacterDataNode(e)?e.length:e.childNodes.length)}function R(e){return!!e.startContainer&&!!e.endContainer&&!S(e.startContainer)&&!S(e.endContainer)&&E(e.startContainer,e.startOffset)&&E(e.endContainer,e.endOffset)}function k(e){if(y(e),!R(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function A(){}function N(e){e.START_TO_START=te,e.START_TO_END=ne,e.END_TO_END=ae,e.END_TO_START=ie,e.NODE_BEFORE=re,e.NODE_AFTER=oe,e.NODE_BEFORE_AND_AFTER=se,e.NODE_INSIDE=le}function D(e){N(e),N(e.prototype)}function P(e,t){return function(){k(this);var n,a,i=this.startContainer,r=this.startOffset,s=this.commonAncestorContainer,l=new h(this,!0);i!==s&&(n=L.getClosestAncestorIn(i,s,!0),a=o(n),i=a.node,r=a.offset),c(l,x),l.reset();var u=e(l);return l.detach(),t(this,i,r,i,r),u}}function M(t,a,i){function s(e,t){return function(n){y(this),b(n,V),b(W(n),q);var a=(e?r:o)(n);(t?l:c)(this,a.node,a.offset)}}function l(e,t,n){var i=e.endContainer,r=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((W(t)!=W(i)||1==L.comparePoints(t,n,i,r))&&(i=t,r=n),a(e,t,n,i,r))}function c(e,t,n){var i=e.startContainer,r=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((W(t)!=W(i)||-1==L.comparePoints(t,n,i,r))&&(i=t,r=n),a(e,i,r,t,n))}function f(e,t,n){(t!==e.startContainer||n!==e.startOffset||t!==e.endContainer||n!==e.endOffset)&&a(e,t,n,t,n)}t.prototype=new A,e.util.extend(t.prototype,{setStart:function(e,t){y(this),_(e,!0),w(e,t),l(this,e,t)},setEnd:function(e,t){y(this),_(e,!0),w(e,t),c(this,e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){k(this),e?a(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):a(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){y(this),_(e,!0),a(this,e,0,e,L.getNodeLength(e))},selectNode:function(e){y(this),_(e,!1),b(e,V);var t=r(e),n=o(e);a(this,t.node,t.offset,n.node,n.offset)},extractContents:P(d,a),deleteContents:P(u,a),canSurroundContents:function(){k(this),x(this.startContainer),x(this.endContainer);var e=new h(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},detach:function(){i(this)},splitBoundaries:function(){k(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,r=e===n;L.isCharacterDataNode(n)&&i>0&&i<n.length&&L.splitDataNode(n,i),L.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=L.splitDataNode(e,t),r?(i-=t,n=e):n==e.parentNode&&i>=L.getNodeIndex(e)&&i++,t=0),a(this,e,t,n,i)},normalizeBoundaries:function(){k(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,r=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},o=function(a){var r=a.previousSibling;if(r&&r.nodeType==a.nodeType){e=a;var o=a.length;if(t=r.length,a.insertData(0,r.data),r.parentNode.removeChild(r),e==n)i+=t,n=e;else if(n==a.parentNode){var s=L.getNodeIndex(a);i==s?(n=a,i=o):i>s&&i--}}},s=!0;if(L.isCharacterDataNode(n))n.length==i&&r(n);else{if(i>0){var l=n.childNodes[i-1];l&&L.isCharacterDataNode(l)&&r(l)}s=!this.collapsed}if(s){if(L.isCharacterDataNode(e))0==t&&o(e);else if(t<e.childNodes.length){var c=e.childNodes[t];c&&L.isCharacterDataNode(c)&&o(c)}}else e=n,t=i;a(this,e,t,n,i)},collapseToPoint:function(e,t){y(this),_(e,!0),w(e,t),f(this,e,t)}}),D(t)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:L.getCommonAncestor(e.startContainer,e.endContainer)}function $(e,t,n,a,r){var o=e.startContainer!==t||e.startOffset!==n,s=e.endContainer!==a||e.endOffset!==r;e.startContainer=t,e.startOffset=n,e.endContainer=a,e.endOffset=r,O(e),i(e,"boundarychange",{startMoved:o,endMoved:s})}function I(e){y(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,i(e,"detach",null),e._listeners=null}function H(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},O(this)}e.requireModules(["DomUtil"]);var L=e.dom,B=L.DomPosition,j=e.DOMException;h.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,L.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!L.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new H(a(this.range));var t=this._current,n=t,i=0,r=t,o=L.getNodeLength(t);L.isAncestorOf(t,this.sc,!0)&&(n=this.sc,i=this.so),L.isAncestorOf(t,this.ec,!0)&&(r=this.ec,o=this.eo),$(e,n,i,r,o)}return new h(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},m.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},m.prototype.toString=function(){return this.message},g.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var V=[1,3,4,5,7,8,10],q=[2,9,11],z=[5,6,10,12],U=[1,3,4,5,7,8,10,11],F=[1,3,4,5,7,8],W=L.getRootContainer,Z=v([9,11]),G=v(z),K=v([6,10,12]),X=document.createElement("style"),Q=!1;try{X.innerHTML="<b>x</b>",Q=3==X.firstChild.nodeType}catch(Y){}e.features.htmlParsingConforms=Q;var J=Q?function(e){var t=this.startContainer,n=L.getDocument(t);if(!t)throw new j("INVALID_STATE_ERR");var a=null;return 1==t.nodeType?a=t:L.isCharacterDataNode(t)&&(a=L.parentElement(t)),a=null===a||"HTML"==a.nodeName&&L.isHtmlNamespace(L.getDocument(a).documentElement)&&L.isHtmlNamespace(a)?n.createElement("body"):a.cloneNode(!1),a.innerHTML=e,L.fragmentFromNodeChildren(a)}:function(e){y(this);var t=a(this),n=t.createElement("body");return n.innerHTML=e,L.fragmentFromNodeChildren(n)},ee=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],te=0,ne=1,ae=2,ie=3,re=0,oe=1,se=2,le=3;A.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){k(this),C(this.startContainer,t.startContainer);var n,a,i,r,o=e==ie||e==te?"start":"end",s=e==ne||e==te?"start":"end";return n=this[o+"Container"],a=this[o+"Offset"],i=t[s+"Container"],r=t[s+"Offset"],L.comparePoints(n,a,i,r)},insertNode:function(e){if(k(this),b(e,U),x(this.startContainer),L.isAncestorOf(e,this.startContainer,!0))throw new j("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){k(this);var e,t;if(this.collapsed)return a(this).createDocumentFragment();if(this.startContainer===this.endContainer&&L.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=a(this).createDocumentFragment(),t.appendChild(e),t;var n=new h(this,!0);return e=l(n),n.detach(),e},canSurroundContents:function(){k(this),x(this.startContainer),x(this.endContainer);var e=new h(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(b(e,F),!this.canSurroundContents())throw new m("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){k(this);for(var e,t=new H(a(this)),n=ee.length;n--;)e=ee[n],t[e]=this[e];return t},toString:function(){k(this);var e=this.startContainer;if(e===this.endContainer&&L.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new h(this,!0);return c(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){k(this);var t=e.parentNode,n=L.getNodeIndex(e);if(!t)throw new j("NOT_FOUND_ERR");var a=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return 0>a?i>0?se:re:i>0?oe:le},comparePoint:function(e,t){return k(this),T(e,"HIERARCHY_REQUEST_ERR"),C(e,this.startContainer),L.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:L.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:J,toHtml:function(){k(this);var e=a(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(k(this),T(e,"NOT_FOUND_ERR"),L.getDocument(e)!==a(this))return!1;var n=e.parentNode,i=L.getNodeIndex(e);T(n,"NOT_FOUND_ERR");var r=L.comparePoints(n,i,this.endContainer,this.endOffset),o=L.comparePoints(n,i+1,this.startContainer,this.startOffset);return t?0>=r&&o>=0:0>r&&o>0},isPointInRange:function(e,t){return k(this),T(e,"HIERARCHY_REQUEST_ERR"),C(e,this.startContainer),L.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&L.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){if(k(this),a(e)!=a(this))throw new j("WRONG_DOCUMENT_ERR");var n=L.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),i=L.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=n&&i>=0:0>n&&i>0},intersection:function(e){if(this.intersectsRange(e)){var t=L.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=L.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),a=this.cloneRange();return-1==t&&a.setStart(e.startContainer,e.startOffset),1==n&&a.setEnd(e.endContainer,e.endOffset),a}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==L.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==L.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new m("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==le},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,L.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var a=n.pop();t.setEnd(a,a.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return k(this),new g(this,e,t)},getNodes:function(e,t){return k(this),f(this,e,t)},getDocument:function(){return a(this)},collapseBefore:function(e){y(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){y(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return H.rangesEqual(this,e)},isValid:function(){return R(this)},inspect:function(){return p(this)}},M(H,$,I),e.rangePrototype=A.prototype,H.rangeProperties=ee,H.RangeIterator=h,H.copyComparisonConstants=D,H.createPrototypeRange=M,H.inspect=p,H.getRangeDocument=a,H.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=H,e.RangeException=m}),rangy.createModule("WrappedRange",function(e,t){function n(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var a=n.parentElement();n=e.duplicate(),n.collapse(!1);var i=n.parentElement(),r=a==i?a:s.getCommonAncestor(a,i);return r==t?r:s.getCommonAncestor(t,r)}function a(e){return 0==e.compareEndPoints("StartToEnd",e)}function i(e,t,n,a){var i=e.duplicate();i.collapse(n);var r=i.parentElement();if(s.isAncestorOf(t,r,!0)||(r=t),!r.canHaveHTML)return new l(r.parentNode,s.getNodeIndex(r));var o,c,u,d,f,p=s.getDocument(r).createElement("span"),h=n?"StartToStart":"StartToEnd";do r.insertBefore(p,p.previousSibling),i.moveToElementText(p);while((o=i.compareEndPoints(h,e))>0&&p.previousSibling);if(f=p.nextSibling,-1==o&&f&&s.isCharacterDataNode(f)){i.setEndPoint(n?"EndToStart":"EndToEnd",e);var m;if(/[\r\n]/.test(f.data)){var g=i.duplicate(),v=g.text.replace(/\r\n/g,"\r").length;for(m=g.moveStart("character",v);-1==(o=g.compareEndPoints("StartToEnd",g));)m++,g.moveStart("character",1)}else m=i.text.length;d=new l(f,m)}else c=(a||!n)&&p.previousSibling,u=(a||n)&&p.nextSibling,d=u&&s.isCharacterDataNode(u)?new l(u,0):c&&s.isCharacterDataNode(c)?new l(c,c.length):new l(r,s.getNodeIndex(p));return p.parentNode.removeChild(p),d}function r(e,t){var n,a,i,r,o=e.offset,l=s.getDocument(e.node),c=l.body.createTextRange(),u=s.isCharacterDataNode(e.node);return u?(n=e.node,a=n.parentNode):(r=e.node.childNodes,n=o<r.length?r[o]:null,a=e.node),i=l.createElement("span"),i.innerHTML="&#feff;",n?a.insertBefore(i,n):a.appendChild(i),c.moveToElementText(i),c.collapse(!t),a.removeChild(i),u&&c[t?"moveStart":"moveEnd"]("character",o),c}e.requireModules(["DomUtil","DomRange"]);var o,s=e.dom,l=s.DomPosition,c=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){o=function(e){this.textRange=e,this.refresh()},o.prototype=new c(document),o.prototype.refresh=function(){var e,t,r=n(this.textRange);a(this.textRange)?t=e=i(this.textRange,r,!0,!0):(e=i(this.textRange,r,!0,!1),t=i(this.textRange,r,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},c.copyComparisonConstants(o);var u=function(){return this}();"undefined"==typeof u.Range&&(u.Range=o),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else!function(){function t(e){for(var t,n=u.length;n--;)t=u[n],e[t]=e.nativeRange[t]}function n(e,t,n,a,i){var r=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==a||e.endOffset!=i;(r||o)&&(e.setEnd(a,i),e.setStart(t,n))}function a(e){e.nativeRange.detach(),e.detached=!0;for(var t,n=u.length;n--;)t=u[n],e[t]=null}var i,r,l,u=c.rangeProperties;o=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,t(this)},c.createPrototypeRange(o,n,a),i=o.prototype,i.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},i.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},i.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},i.cloneContents=function(){return this.nativeRange.cloneContents()},i.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},i.collapse=function(e){this.nativeRange.collapse(e),t(this)},i.cloneRange=function(){return new o(this.nativeRange.cloneRange())},i.refresh=function(){t(this)},i.toString=function(){return this.nativeRange.toString()};var d=document.createTextNode("test");s.getBody(document).appendChild(d);var f=document.createRange();f.setStart(d,0),f.setEnd(d,0);try{f.setStart(d,1),r=!0,i.setStart=function(e,n){this.nativeRange.setStart(e,n),t(this)},i.setEnd=function(e,n){this.nativeRange.setEnd(e,n),t(this)},l=function(e){return function(n){this.nativeRange[e](n),t(this)}}}catch(p){r=!1,i.setStart=function(e,n){try{this.nativeRange.setStart(e,n)}catch(a){this.nativeRange.setEnd(e,n),this.nativeRange.setStart(e,n)}t(this)},i.setEnd=function(e,n){try{this.nativeRange.setEnd(e,n)}catch(a){this.nativeRange.setStart(e,n),this.nativeRange.setEnd(e,n)}t(this)},l=function(e,n){return function(a){try{this.nativeRange[e](a)}catch(i){this.nativeRange[n](a),this.nativeRange[e](a)}t(this)}}}i.setStartBefore=l("setStartBefore","setEndBefore"),i.setStartAfter=l("setStartAfter","setEndAfter"),i.setEndBefore=l("setEndBefore","setStartBefore"),i.setEndAfter=l("setEndAfter","setStartAfter"),f.selectNodeContents(d),i.selectNodeContents=f.startContainer==d&&f.endContainer==d&&0==f.startOffset&&f.endOffset==d.length?function(e){this.nativeRange.selectNodeContents(e),t(this)}:function(e){this.setStart(e,0),this.setEnd(e,c.getEndOffset(e))},f.selectNodeContents(d),f.setEnd(d,3);var h=document.createRange();h.selectNodeContents(d),h.setEnd(d,4),h.setStart(d,2),i.compareBoundaryPoints=-1==f.compareBoundaryPoints(f.START_TO_END,h)&1==f.compareBoundaryPoints(f.END_TO_START,h)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(f,"createContextualFragment")&&(i.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),s.getBody(document).removeChild(d),f.detach(),h.detach()}(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(o.rangeToTextRange=function(e){if(e.collapsed){var t=r(new l(e.startContainer,e.startOffset),!0);return t}var n=r(new l(e.startContainer,e.startOffset),!0),a=r(new l(e.endContainer,e.endOffset),!1),i=s.getDocument(e.startContainer).body.createTextRange();return i.setEndPoint("StartToStart",n),i.setEndPoint("EndToEnd",a),i}),o.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=o,e.createRange=function(t){return t=t||document,new o(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new c(e)},e.createIframeRange=function(t){return e.createRange(s.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(s.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return(e||window).getSelection()}function a(e){return(e||window).document.selection}function i(e,t,n){var a=n?"end":"start",i=n?"start":"end";e.anchorNode=t[a+"Container"],e.anchorOffset=t[a+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function r(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function o(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function s(t){var n;return t instanceof T?(n=t._selectionNativeRange,n||(n=e.createNativeRange(C.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof S?n=t.nativeRange:e.features.implementsDomRange&&t instanceof C.getWindow(t.startContainer).Range&&(n=t),n}function l(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!C.isAncestorOf(e[0],e[t]))return!1;return!0}function c(e){var t=e.getNodes();if(!l(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function u(e){return!!e&&"undefined"!=typeof e.text}function d(e,t){var n=new S(t);e._ranges=[n],i(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function f(t){if(t._ranges.length=0,"None"==t.docSelection.type)o(t);else{var n=t.docSelection.createRange();if(u(n))d(t,n);else{t.rangeCount=n.length;for(var a,r=C.getDocument(n.item(0)),s=0;s<t.rangeCount;++s)a=e.createRange(r),a.selectNode(n.item(s)),t._ranges.push(a);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,i(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,t){for(var n=e.docSelection.createRange(),a=c(t),i=C.getDocument(n.item(0)),r=C.getBody(i).createControlRange(),o=0,s=n.length;s>o;++o)r.add(n.item(o));try{r.add(a)}catch(l){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),f(e)}function h(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function m(e,t){for(var n,a=C.getDocument(t[0].startContainer),i=C.getBody(a).createControlRange(),r=0;r<rangeCount;++r){n=c(t[r]);try{i.add(n)}catch(o){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),f(e)}function g(e,t){if(e.anchorNode&&C.getDocument(e.anchorNode)!==C.getDocument(t))throw new E("WRONG_DOCUMENT_ERR")}function v(e){var t=[],n=new R(e.anchorNode,e.anchorOffset),a=new R(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var r=0,o=e.rangeCount;o>r;++r)t[r]=T.inspect(e.getRangeAt(r));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+a.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var _,y,b="boolean",w="_rangySelection",C=e.dom,x=e.util,T=e.DomRange,S=e.WrappedRange,E=e.DOMException,R=C.DomPosition,k="Control",A=e.util.isHostMethod(window,"getSelection"),N=e.util.isHostObject(document,"selection"),D=N&&(!A||e.config.preferTextRange);D?(_=a,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return"None"!=n.type||C.getDocument(n.createRange().parentElement())==t}):A?(_=n,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=_;var P=_(),M=e.createNativeRange(document),O=C.getBody(document),$=x.areHostObjects(P,["anchorNode","focusNode"]&&x.areHostProperties(P,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=$;var I=x.isHostMethod(P,"extend");e.features.selectionHasExtend=I;var H="number"==typeof P.rangeCount;e.features.selectionHasRangeCount=H;var L=!1,B=!0;x.areHostMethods(P,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof P.rangeCount&&e.features.implementsDomRange&&!function(){var e=document.createElement("iframe");e.frameBorder=0,e.style.position="absolute",e.style.left="-10000px",O.appendChild(e);var t=C.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=C.getIframeWindow(e).getSelection(),a=t.documentElement,i=a.lastChild,r=i.firstChild,o=t.createRange();o.setStart(r,1),o.collapse(!0),n.addRange(o),B=1==n.rangeCount,n.removeAllRanges();var s=o.cloneRange();o.setStart(r,0),s.setEnd(r,2),n.addRange(o),n.addRange(s),L=2==n.rangeCount,o.detach(),s.detach(),O.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=L,e.features.collapsedNonEditableSelectionsSupported=B;var j,V=!1;O&&x.isHostMethod(O,"createControlRange")&&(j=O.createControlRange(),x.areHostProperties(j,["item","add"])&&(V=!0)),e.features.implementsControlRange=V,y=$?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var q;x.isHostMethod(P,"getRangeAt")?q=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:$&&(q=function(t){var n=C.getDocument(t.anchorNode),a=e.createRange(n);return a.setStart(t.anchorNode,t.anchorOffset),a.setEnd(t.focusNode,t.focusOffset),a.collapsed!==this.isCollapsed&&(a.setStart(t.focusNode,t.focusOffset),a.setEnd(t.anchorNode,t.anchorOffset)),a}),e.getSelection=function(e){e=e||window;var t=e[w],n=_(e),i=N?a(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh(e)):(t=new h(n,i,e),e[w]=t),t},e.getIframeSelection=function(t){return e.getSelection(C.getIframeWindow(t))};var z=h.prototype;if(!D&&$&&x.areHostMethods(P,["removeAllRanges","addRange"])){z.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),o(this)};var U=function(t,n){var a=T.getRangeDocument(n),i=e.createRange(a);i.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(s(i)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};z.addRange=H?function(t,n){if(V&&N&&this.docSelection.type==k)p(this,t);else if(n&&I)U(this,t);else{var a;if(L?a=this.rangeCount:(this.removeAllRanges(),a=0),this.nativeSelection.addRange(s(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==a+1){if(e.config.checkSelectionRanges){var r=q(this.nativeSelection,this.rangeCount-1);r&&!T.rangesEqual(r,t)&&(t=new S(r))}this._ranges[this.rangeCount-1]=t,i(this,t,Z(this.nativeSelection)),this.isCollapsed=y(this)}else this.refresh()}}:function(e,t){t&&I?U(this,e):(this.nativeSelection.addRange(s(e)),this.refresh())},z.setRanges=function(e){if(V&&e.length>1)m(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(x.isHostMethod(P,"empty")&&x.isHostMethod(M,"select")&&V&&D))return t.fail("No means of selecting a Range or TextRange was found"),!1;z.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=C.getDocument(this.anchorNode);else if(this.docSelection.type==k){var t=this.docSelection.createRange();t.length&&(e=C.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(a){}o(this)},z.addRange=function(e){this.docSelection.type==k?p(this,e):(S.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,i(this,e,!1))},z.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?m(this,e):t&&this.addRange(e[0])}}z.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new E("INDEX_SIZE_ERR");return this._ranges[e]};var F;if(D)F=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=C.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==k?f(t):u(n)?d(t,n):o(t)};else if(x.isHostMethod(P,"getRangeAt")&&"number"==typeof P.rangeCount)F=function(t){if(V&&N&&t.docSelection.type==k)f(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,a=t.rangeCount;a>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));i(t,t._ranges[t.rangeCount-1],Z(t.nativeSelection)),t.isCollapsed=y(t)}else o(t)};else{if(!$||typeof P.isCollapsed!=b||typeof M.collapsed!=b||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;F=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=q(n,0),e._ranges=[t],e.rangeCount=1,r(e),e.isCollapsed=y(e)):o(e)}}z.refresh=function(e){var t=e?this._ranges.slice(0):null;if(F(this),e){var n=t.length;if(n!=this._ranges.length)return!1;for(;n--;)if(!T.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var W=function(e,t){var n=e.getAllRanges(),a=!1;e.removeAllRanges();for(var i=0,r=n.length;r>i;++i)a||t!==n[i]?e.addRange(n[i]):a=!0;e.rangeCount||o(e)};z.removeRange=V?function(e){if(this.docSelection.type==k){for(var t,n=this.docSelection.createRange(),a=c(e),i=C.getDocument(n.item(0)),r=C.getBody(i).createControlRange(),o=!1,s=0,l=n.length;l>s;++s)t=n.item(s),t!==a||o?r.add(n.item(s)):o=!0;r.select(),f(this)}else W(this,e)}:function(e){W(this,e)};var Z;!D&&$&&e.features.implementsDomRange?(Z=function(e){var t=!1;return e.anchorNode&&(t=1==C.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},z.isBackwards=function(){return Z(this)}):Z=z.isBackwards=function(){return!1},z.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},z.collapse=function(t,n){g(this,t);var a=e.createRange(C.getDocument(t));a.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(a),this.isCollapsed=!0},z.collapseToStart=function(){if(!this.rangeCount)throw new E("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},z.collapseToEnd=function(){if(!this.rangeCount)throw new E("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},z.selectAllChildren=function(t){g(this,t);var n=e.createRange(C.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},z.deleteFromDocument=function(){if(V&&N&&this.docSelection.type==k){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var a=0,i=n.length;i>a;++a)n[a].deleteContents();this.addRange(n[i-1])}},z.getAllRanges=function(){return this._ranges.slice(0)},z.setSingleRange=function(e){this.setRanges([e])},z.containsNode=function(e,t){for(var n=0,a=this._ranges.length;a>n;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},z.toHtml=function(){var e="";if(this.rangeCount){for(var t=T.getRangeDocument(this._ranges[0]).createElement("div"),n=0,a=this._ranges.length;a>n;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},z.getName=function(){return"WrappedSelection"},z.inspect=function(){return v(this)},z.detach=function(){this.win[w]=null,this.win=this.anchorNode=this.focusNode=null},h.inspect=v,e.Selection=h,e.selectionPrototype=z,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})}),Box.Timing.execution.push({name:"js/menus/filters/abstract_filter_menu.js",time:(new Date).getTime()});var Abstract_Filter_Menu=Abstract_Menu.extend({_action_required_to_close:!0,_default_menu_width:null,_defined_inline:!0,constructor:function(e){if(e=e||{},this._filter_type=e.filter_type||this._filter_type,this._default_text=e.default_text||this._default_text,!this._filter_type)throw new Error("missing filter type");if("filter"!=this._filter_type&&!this._default_text)throw new Error(this._filter_type+" missing default text");this.j_filter_menu_item=$j("#"+this._filter_type+"_filter"),this.j_button=$j("#"+this._filter_type+"_filter_button"),this.j_button_name=$j("#"+this._filter_type+"_button_name");var t="dd_menu_create_filter_"+this._filter_type;this.j_dd_menu=$j("#"+t),this._e_menu=this.j_dd_menu.get(0),Box_Menus.get().map_menu_id_to_menu_object[t]=this,this.base(e),Canvas.get().register_body_click_handler(this)},reset_filter:function(){this._zero_value(),this._hide_button(),this.hide_menu(),this.j_button.siblings(".close_icon").addClass("hidden")},show:function(e){e=e||{},this._j_target_element=$j(e.target).parent(),this.base(),e.match_target_width&&(this._default_menu_width||(this._default_menu_width=this.j_dd_menu.width()),this.j_dd_menu.width(Math.max(this._default_menu_width,this.j_button.outerWidth())))},update_filter:function(e){this._set_value(e),this._update_and_show_filter(e)},bind_menu:function(){var e=this;this.j_button.off().on("click",function(t){return e.j_dd_menu.is(":visible")?e.hide_menu():e.show({target:$j(this),match_target_width:!0}),!0}).on("mouseover",function(t){return e.j_button.siblings(".close_icon").removeClass("hidden"),!0}).on("mouseout",function(t){return $j(t.relatedTarget).hasClass("close_icon")||e.j_button.siblings(".close_icon").addClass("hidden"),!0}),this.j_button.siblings(".close_icon").off().on("mousedown",function(t){
var n=e.get_encoded_value();return e.reset_filter(),$j(this).addClass("hidden"),e.broadcast_filter_remove(n),!1}).on("mouseout",function(t){return $j(t.relatedTarget).is(e.j_button)||e.j_button.siblings(".close_icon").addClass("hidden"),!0})},validate_and_submit_filter:function(){},event_click:function(e){var t=this.get_encoded_value(),n=$j(e.target),a=n.closest("li");a.length&&(this._set_value(a.attr("data-value")),this._update_and_show_filter()),this.hide_menu(),this.broadcast_filter_change(t)},hide_menu:function(){this.j_dd_menu.hide(),this.j_button.blur()},broadcast_filter_change:function(e){var t=this.get_encoded_value();Box.Application.broadcast("x-legacysearchfilterchange",{filters:[{type:this._filter_type,value:t}]})},broadcast_filter_remove:function(e){var t=this.get_encoded_value();Box.Application.broadcast("x-legacysearchfilterremove",{filters:[{type:this._filter_type,value:t}],isFilterChanged:""!=e})},get_filter_value:function(){return this.filter_value},get_encoded_value:function(){var e=this.get_filter_value();return $.makeArray(e).join(":")},_update_and_show_filter:function(e){if(!e)throw new Error(this._filter_type+" called update_and_show_filter without a default text");this.j_button_name.text(e),this.j_button.parent().find(".hidden").not(".close_icon").removeClass("hidden"),this.j_button.show(),this.j_filter_menu_item.hide()},_set_value:function(e){this.filter_value=""!=e?e:null},_hide_button:function(){this.j_button.hide(),this.j_button_name.text(this._default_text),this.j_filter_menu_item.show();var e=$j("#add_filter_button");e.is(":visible")||e.show()},_zero_value:function(){this.filter_value=null},body_click_handler:function(e){!this.j_dd_menu.is(":visible")||$j.elementIsDescendent(e.target,this.j_dd_menu[0])||$j.elementIsDescendent(e.target,this.j_button[0])||this.hide_menu()},_get_offsets:function(){return{x:0,y:-10}},_get_object_keys:function(e){var t,n=[];if("object"==typeof e)for(t in e)e.hasOwnProperty(t)&&n.push(t);return n}},{});Box.Timing.execution.push({name:"js/menus/filters/abstract_range_filter_menu.js",time:(new Date).getTime()});var Abstract_Range_Filter_Menu=Abstract_Filter_Menu.extend({get_filter_value:function(){return this.min||this.max?[this.min,this.max]:null},event_click:function(e){var t=$j(e.target),n=t.closest("li");n.length&&("custom"==n.attr("data-value")?(this._show_popup(),this.hide_menu()):this.base(e))},_validate_values:function(e){return!0},_show_popup:function(e){var t=this,n=e.title||$t("Custom range","custom_range_popup_title"),a=e.input_type||"input",i=$.extend({},e.extra_input_options,{type:a,label:$t("From","reports_from"),name:"from",value:this._convert_value_to_display(this.min)}),r=$.extend({},e.extra_input_options,{type:a,label:$t("To","reports_to"),name:"to",value:this._convert_value_to_display(this.max)}),o=function(e,n){var a=[t._convert_display_to_value(e.from),t._convert_display_to_value(e.to)],i=t.get_encoded_value();if(t._validate_values(a))t._set_value(a),t._update_and_show_filter(),$j.popup.close(),t.broadcast_filter_change(i);else{var r=n.find(".error");r.length||(r=$j('<div class="error mtm"/>'),n.append(r)),e.from&&e.to?(n.find("input").css("color","#BE4300"),r.text($t("The current date range entered is invalid.","invalid_errors_range_menu"))):r.text($t("Please select the date range.","empty_date_error_range_menu")),$j.popup.get().find("#popup_button_okay").text($t("Okay","js_popup_button_okay"))}},s={type:"buttons",items:{okay:{value:$t("Okay","js_popup_button_okay"),click:function(e,t){o(e,t)}},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:function(){$j.popup.close()}}}};$j.popup.form(n,[i,r,s])},_convert_value_to_display:function(e){return e},_convert_display_to_value:function(e){return e},_zero_value:function(){this.min=null,this.max=null}},{});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_date_menu.js",time:(new Date).getTime()});var Create_Filter_Date_Menu=Abstract_Range_Filter_Menu.extend({_filter_type:"date",_default_text:$t("Date","date_button_label"),_relative_value:"",_previous_dates:{},constructor:function(e){this.base(e),this._set_discrete_date_values()},_show_popup:function(){var e={title:$t("Custom date range","custom_date_range_popup_title"),input_type:"datepicker",extra_input_options:{past:!0}};this.base(e)},_set_discrete_date_values:function(){var e=new Date;e.setHours(0,0,0,0);var t=new Date(e);t.setDate(t.getDate()-1);var n=new Date(e);n.setDate(n.getDate()-7);var a=new Date(e);a.setMonth(a.getMonth()-1);var i=new Date(e);i.setFullYear(i.getFullYear()-1),this._previous_dates={today:e,day:t,week:n,month:a,year:i}},_convert_value_to_display:function(e){var t="";return e&&(t=$.datepicker.formatDate($.datepicker._defaults.dateFormat,e)),t},_convert_display_to_value:function(e){var t="";return e&&(t=Box.Application.getService("datetime").parseShortDate(e)),t},_set_value:function(e){$j.isArray(e)&&1==e.length&&(e=e[0]),$j.isArray(e)?(this.min=e[0],this.max=e[1],this._relative_value=this._determine_relative_value(e)):(this.min=this._previous_dates[e],this.min&&(this.max=this._previous_dates.today,this._relative_value=e))},_validate_values:function(e){if($j.isArray(e)){var t=e[0],n=e[1];if(!t||!n)return!1;if(n.getTime()<t.getTime())return!1}return!0},get_encoded_value:function(){var e=this.get_filter_value();if(!e)return"";if("custom"===this._relative_value){var t="";e[0]&&(t=$.datepicker.formatDate($.datepicker._defaults.dateFormat,e[0]));var n="";return e[1]&&(n=$.datepicker.formatDate($.datepicker._defaults.dateFormat,e[1])),t+":"+n}return this._relative_value},_determine_relative_value:function(e){if(e[1].getTime()==this._previous_dates.today.getTime())for(var t=this._get_object_keys(this._previous_dates),n=0,a=t.length;a>n;n++)if(e[0].getTime()==this._previous_dates[t[n]].getTime())return t[n];return"custom"},update_filter:function(e){if($j.isArray(e)&&2===e.length){var t=Box.Application.getService("datetime");e[0]=t.parseShortDate(e[0]),e[1]=t.parseShortDate(e[1])}this.base(e)},_update_and_show_filter:function(){var e,t=this._determine_relative_value([this.min,this.max]),n=this.j_dd_menu.find('[data-value="'+this._relative_value+'"]');e="custom"!=t&&n.length?n.text():this.min?this.max?$t("%1 - %2","date_label_min_max",$.datepicker.formatDate($.datepicker._defaults.dateFormat,this.min),$.datepicker.formatDate($.datepicker._defaults.dateFormat,this.max)):$t("After %1","date_label_min",$.datepicker.formatDate($.datepicker._defaults.dateFormat,this.min)):$t("Before %1","date_label_max",$.datepicker.formatDate($.datepicker._defaults.dateFormat,this.max)),$(".search-module [data-search-filter=date]").attr("value",e),this.base(e)}},{});Box.Timing.execution.push({name:"js/box_view_handler/slave.js",time:(new Date).getTime()});var Box_View_Handler_Slave=Box_View_Handler_User.extend({event_click:function(e){var t=this.get_j_event_elements(e);return t.hasClass("more_item")?(this.show_user_action_menu({target:e.target}),!1):this.base(e)},event_right_click:function(e){var t=this.get_j_event_elements(e);return t.hasClass("handle_right_click")?(this.show_user_action_menu({event:e,type:"right_click"}),!1):this.base(e)},show_user_action_menu:function(e){e=e||{},e.user=this.object,Box_Menus.get().user_action_menu.show(e)},handle_edit:function(e){e.can_edit()&&(e.edit(),$j(window).scrollTop(0))}},{});Box.Timing.execution.push({name:"js/box_view_handler/external_user.js",time:(new Date).getTime()});var Box_View_Handler_External_User=Box_View_Handler_User.extend({event_click:function(e){var t=this.object,n=this.get_j_event_elements(e),a=$j(e.target),i=a.parents().andSelf();if(n.hasClass("select")||i.hasClass("select")){"undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_view_handler/external_user.js:3212","2013-05-15","auto tombstoned");var r=a.find("input[type=checkbox]");return r.is(":checked")?("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_view_handler/external_user.js:3213","2013-05-15","auto tombstoned"),t.unselect(!1)):t.select(!1),!1}return n.hasClass("more_item")?(this.show_external_user_menu({target:e.target}),!1):this.base(e)},event_right_click:function(e){var t=this.get_j_event_elements(e);return t.hasClass("handle_right_click")?(this.show_external_user_menu({event:e,type:"right_click"}),!1):this.base(e)},show_external_user_menu:function(e){e=e||{},e.user=this.object,Box_Menus.get().external_user_menu.show(e)},handle_edit:function(e){e.edit_external_collaborator()}},{});Box.Timing.execution.push({name:"js/services/v5popups-postload.js",time:(new Date).getTime()}),Box.Application.addService("v5popups-postload",function(e){"use strict";var t="1-877-729-4269";return{showUnlockRequestPopup:function(t,n){n=n||Item.find(t.file_id);var a="<b>"+$t("'%1' is locked by:","popup_request_access_locked_by",n.name)+"</b>",i=n.generate_lock_info_html(),r='<div class="request_popup_footer">'+$t("To upload a new version of this file please request access from this person below.","popup_request_access_footer")+"</div>",o=$t("Email me when this file is unlocked.","locked_file_popup_singular"),s=[{type:"html",data:a},{type:"html",data:i},{type:"html",data:r},{type:"textarea",linebreak:!0,name:"message",instructions:$t("Add a personal message here","js_popup_request_unlock_message"),rows:3},{type:"checkbox",name:"request_notification",label:o},{type:"buttons",items:{request_access:{value:$t("Request access to file(s)","popup_request_access"),click:function(a,i){if(a.request_notification){var r=$j.box.formatQuery({locks:[t]});$j.postJSON("/index.php?rm=box_services_add_locking_notification_request",r,function(e){"error"===e.result&&("undefined"!=typeof Tombstone&&Tombstone.marker("./js/upload/upload_process.js:10789","2013-05-15","auto tombstoned"),alert("Email request failed"))})}var o;o=e.getService("nav-state").isGcm()?"/index.php?rm=box_master_gcm_unlock_request":"/index.php?rm=box_unlock_request";var s={item_id:t.file_id,message:a.message,lock_id:t.id};n.shared_name&&(s.shared_name=n.shared_name),$j.postJSON(o,$j.box.formatQuery(s),function(t){"error"===t.result?("undefined"!=typeof Tombstone&&Tombstone.marker("./js/upload/upload_process.js:10792","2013-05-15","auto tombstoned"),alert(t.message),$j.popup.revert()):(box.after_load_callback=function(){e.getService("notifications").confirm(t.message)},e.navigate(""),$j.popup.close())})}},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:$j.popup.close}}}];$j.popup.form($t("Request Unlock","js_popup_request_unlock_title"),s,{favicon_url:e.getService("assets").getAssetURL(e.getGlobal("images_path"),"li_icon_lock.gif")})},showEnterpriseQuotePopup:function(n,a){var i,r,o,s=e.getService("v5"),l=s.get("Canvas"),c=s.get("Validator"),u=e.getService("logger"),d=e.getService("notifications"),f="upsell_popup",p=l.user;a=a||t,i=p.public_name?p.public_name.split(" "):[],r={first_name:i[0],last_name:i[1],email:p.email,phone:p.phone,company:p.company_name},n&&(f+="_"+n),u.sendLog("user_event","UPGRADE_UPSELL_POPUP_VIEW",{},null,{referrer_hash:f}),o=$.popup.form($t("Call %1 or let us call you","call_box_title_for_quote",a),[{type:"html",data:'<div class="strong pbm">'+$t("Please fill out this form and we'll contact you shortly:","popup_ent_quote_intro")+"</div>"},{type:"input",label:$t("First Name","popup_properties_folder_first_name")+":",linebreak:!0,name:"first_name",value:r.first_name},{type:"input",label:$t("Last Name","popup_properties_folder_last_name")+":",linebreak:!0,name:"last_name",value:r.last_name},{type:"input",label:$t("Email","popup_properties_folder_email")+":",linebreak:!0,name:"email",value:r.email},{type:"input",label:$t("Phone number","popup_properties_folder_phone_number")+":",linebreak:!0,name:"phone",value:r.phone},{type:"input",label:$t("Company","popup_properties_folder_company")+":",linebreak:!0,name:"company",value:r.company},{type:"textarea",label:$t("Tell us a little about your interests (time frame for purchase, # of users, when you'd like to meet, etc.) so we can route this quickly.","popup_properties_folder_your_interests"),linebreak:!0,name:"questions"},{type:"html",data:'<div class="legal pvs">'+$t("Box will only use this information to communicate with you about an enterprise demonstration or sales quote.","popup_ent_quote_legal_box_information")+"</div>"},{type:"buttons",items:{okay:{value:$t("Submit","popup_button_submit"),click:function(e,t){if(e.first_name&&e.last_name&&e.email&&e.phone&&e.company&&e.questions)if(c.validate_email(e.email))if(c.validate_phone(e.phone)){var n=$.box.formatQuery(e),a="/index.php?rm=box_user_settings_send_enterprise_upgrade_request";$.postJSON(a,n,function(e){$.popup.close();var t=$("#enterprise_upgrade_request_result");t.length?t.html($t("%1Thank you for contacting Box.%2 A sales representative with Box Enterprise will contact you shortly.","thanks_rep_will_contact","<strong>","</strong>")).css("margin-bottom",10).show():d.confirm($t("Thank you for contacting Box. A sales representative with Box Enterprise will contact you shortly.","thanks_rep_will_contact_no_strong")),$("body").on("click.upgrade_request",function(){$("#enterprise_upgrade_request_result").fadeOut(),$("body").off("click.upgrade_request")})})}else alert($t("Please enter a valid phone number.","alert_enter_valid_phone")),$.popup.revert();else alert($t("Please enter a valid email address.","alert_enter_valid_email")),$.popup.revert();else alert($t("Please fill all information.","alert_fill_in_all_info")),$.popup.revert()}},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:function(){$.popup.close()}}}}],{favicon_class:"phone"}),o.addClass("quote_form_popup"),o.find(".same_line input:eq(0)").blur(),o.find("button:eq(0)").focus()},displayDebuggingPopup:function(){var t=e.getService("v5"),n=t.get("Upload_Process"),a=n.most_recent_upload,i=e.getService("strings"),r=t.get("window"),o=t.get("navigator"),s=t.get("swfobject"),l=t.get("Canvas"),c="Upload Information:\n\nUploading method: "+n.get_type()+"\nUseragent: "+o.userAgent+"\n";if(s){var u=s.getFlashPlayerVersion();c+="Flash version: "+u.major+"."+u.minor+"\n"}a&&(c+="File name: "+a.name+"\nFile size: "+i.getHumanReadableSize(a.size)+"\nUpload session id: "+a.upload_session_id+"\n",a.parent_folder&&(c+="Target folder id: "+a.parent_folder.id+"\n"),a.file_id&&(c+="Uploading new version of file id: "+a.file_id+"\n")),c+="User id: "+l.user.id,r.alert(c)}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-controls.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-controls",function(e){"use strict";function t(){clearTimeout(p),p=setTimeout(function(){clearTimeout(p),f?t():(o.removeClass(c,h),o.getNearest(document.activeElement,m)&&document.activeElement.blur())},g)}function n(e){return o.hasClass(e,"preview-controls-btn")||o.hasClass(e,"preview-controls-document-page-selector")}function a(){return l||(l=s.throttle(function(){o.addClass(c,h),t()},g-500,!0)),l}function i(){f=!0}function r(){f=!1}var o,s,l,c,u,d,f,p,h="show-preview-controls",m=".preview-controls",g=1500;return{init:function(){o=e.getService("dom"),s=e.getService("function-utils"),c=e.getElement(),u=o.query(m,c),d=o.query("input",u),o.on(c,"mousemove",a()),u&&(o.on(u,"mouseenter",i),o.on(u,"mouseleave",r)),d&&o.on(d,"focus",i)},destroy:function(){o.off(c,"mousemove",a()),u&&(o.off(u,"mouseenter",i),o.off(u,"mouseleave",r)),d&&o.off(d,"focus",i),e.getService("tooltips-amsterdam").hideAll(),clearTimeout(p)},onfocusin:function(e,t){n(t)&&o.addClass(c,h)},onfocusout:function(e,t){n(t)&&!n(e.relatedTarget)&&o.removeClass(c,h)}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-metadata-add-template-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-metadata-add-template-menu",function(e){"use strict";function t(e){if(d)for(var t=d.childNodes,n=0,a=t.length;a>n;n++){var i=r.query('[data-metadata-template-type-key="'+e+'"]',t[n]);if(i)return i}return null}function n(e){var n=t(e);n&&(r.addClass(n,"disabled"),n.setAttribute("aria-label",$t("Template already added","metadata_template_already_added")),n.setAttribute("data-tooltip","tooltip"))}function a(e){var n=t(e);n&&(r.removeClass(n,"disabled"),n.removeAttribute("aria-label"),n.removeAttribute("data-tooltip"))}function i(e){for(var t=0,a=e.length;a>t;t++){var i=e[t];n(i.type)}}var r,o,s,l,c="box_metadata_create_for_item",u=[],d=null;return{messages:["metadataeditordeleted"],init:function(){r=e.getService("dom"),o=e.getService("ajax"),s=e.getService("popups"),l=e.getConfig().itemTypedId,u=e.getConfig().editors,d=r.query('[data-type="add-template-menu"]',e.getElement()),i(u)},handleMenuClick:function(t,i){if(t&&!r.hasClass(t,"disabled"))switch(i){case"metadata-template":var u=t.getAttribute("data-metadata-template-type-key");n(u),o.post(c,{item_typed_id:l,metadata_type:u},{success:function(t){var n={type:u,html:t.data.html};e.broadcast("metadataeditoradded",n)},error:function(){a(u),s.alert($t("There was an error adding the template to this file. Please try again","metadata_add_template_error"))}})}},onclick:function(e,t,n){if(t&&!r.hasClass(t,"disabled")){switch(n){case"metadata-template":this.handleMenuClick(t,t.getAttribute("data-type"));break;default:return}e.preventDefault(),e.stopPropagation()}},onmessage:function(e,t){switch(e){case"metadataeditordeleted":t&&t.metadataType&&a(t.metadataType)}}}}),Box.Timing.execution.push({name:"js/services/key-value-editor.js",time:(new Date).getTime()}),Box.Application.addService("key-value-editor",function(e){"use strict";function t(t,n){this._$element=$(t),this._$addKeyInput=$('[data-type="add-key-input"]',this._$element),this._$addKeyBtn=$('[data-type="add-key-btn"]',this._$element),this._$addKeyBox=$('[data-type="add-key-box"]',this._$element),this._$addKeySave=$('[data-type="add-key-save-btn"]',this._$element),this._$keyValueList=$('[data-type="key-value-list"] ul',this._$element),this._store=n,this._newKeyIdx=this._store.size(),this._templates=e.getService("templates")}var n="kv-new-key-value",a=$t("Attribute could not be added","kv_attribute_not_added_error"),i=$t("Value was not saved","kv_value_not_set_error"),r=$t("Attribute was not removed","kv_attribute_not_removed_error"),o=$t("Attribute name must be specified","kv_attribute_name_blank_error"),s=$t("Attribute name is too long","kv_attribute_name_too_long_error"),l=$t("This attribute already exists","kv_attribute_already_exists_error"),c=$t("Attribute name cannot start with '$'","kv_attribute_name_is_system_key_error"),u=$t("Value out of date. Please refresh page.","kv_value_conflict"),d=$t("Attribute has already been added. Please refresh page.","kv_key_conflict");return t.prototype={init:function(){var e=this;this._initializeAutosize(),this._$element.on("focus","[placeholder]",function(e){var t=$(this);t.attr("data-placeholder",t.attr("placeholder")),t.attr("placeholder","")}),this._$element.on("blur","[placeholder]",function(e){var t=$(this);t.attr("data-placeholder")&&t.attr("placeholder",t.attr("data-placeholder"))}),this._$element.on("click",'[data-type="add-key-btn"]',function(){e._focusAddKey()}),this._$element.on("click",'[data-type="add-key-cancel-btn"]',function(){e._blurAddKey()}),this._$element.on("click",'[data-type="add-key-save-btn"]',function(t){e._addKey(this,t)}),this._$element.on("click",'[data-type="delete-key-btn"]',function(t){e._removeKey(this,t)}),this._$element.on("keyup",'[data-type="add-key-input"]',function(t){27===t.which?e._blurAddKey():$(this).is(":focus")&&13===t.which&&e._addKey(this,t)}),this._$element.on("keyup",'textarea[data-type="metadata-value"]',function(t){27===t.which?(e._resetValue(this,t),$(this).blur()):13===t.which&&$(this).blur()}),this._$element.on("keyup",'[data-type="add-key-input"].kv-has-error, textarea[data-type="metadata-value"].kv-has-error',function(t){13!=t.which&&e._removeErrorMessage(this)}),this._$element.on("change",'textarea[data-type="metadata-value"]',function(t){var n=this;e._updateKeyValue(this,t),setTimeout(function(){$(n).blur()},0)}),this._$element.on("focus",'textarea[data-type="metadata-value"]',function(){var e=this,t=e.parentNode.querySelector('[data-type="save-value-btn"]');$(t).addClass("is-visible")}),this._$element.on("blur",'textarea[data-type="metadata-value"]',function(){var e=this,t=e.parentNode.querySelector('[data-type="save-value-btn"]');$(t).removeClass("is-visible")}),this._$element.on("click",'[data-type="edit-value-btn"]',function(){var e=this,t=e.parentNode.querySelector('[data-type="metadata-value"]');t.focus()}),this._$element.on("keydown","input, textarea",function(e){e.stopPropagation()}),this._$element.on("keydown keyup","input, textarea",function(e){13===e.which&&e.preventDefault()})},destroy:function(){this._$element.off()},_addErrorMessage:function(e,t){$(e).attr("data-hover","tooltip"),$(e).attr("aria-label",t),$(e).addClass("kv-has-error")},_removeErrorMessage:function(e){$(e).removeAttr("data-hover"),$(e).removeAttr("aria-label"),$(e).removeClass("kv-has-error")},_getErrorResponseForValue:function(e,t){return 409===e.status?u:t},_getErrorResponseForKey:function(e,t){return 409===e.status?d:t},_updateKeyValue:function(e,t){var n,a=this,r=$(e).siblings('[data-type="metadata-key"]').text(),o=$(e).val();0===r.length&&(n=e.parentNode.parentNode.querySelector('[data-type="metadata-key"]'),r=n.textContent||n.innerText),this._removeErrorMessage(e),this._store.set(r,o,function(){},function(t){var n=a._getErrorResponseForValue(t,i);a._addErrorMessage(e,n)})},_resetValue:function(e,t){var n,a,i=$(e).siblings('[data-type="metadata-key"]').text();0===i.length&&(a=e.parentNode.parentNode.querySelector('[data-type="metadata-key"]'),i=a.textContent||a.innerText),n=this._store.get(i),$(e).val(n).trigger("autosize.resize")},_removeKey:function(e,t){var n=this,a=$(e).siblings('[data-type="metadata-key"]'),i=a.text();this._removeErrorMessage(a),a.parent().hide(),this._store.remove(i,function(){a.parent().remove()},function(e){a.parent().show();var t=n._getErrorResponseForValue(e,r);n._addErrorMessage(a,t)})},_validateKey:function(e){return e.length<=0?o:"$"===e.charAt(0)?c:e.length>256?s:this._store.has(e)?l:null},_addKey:function(e,t){var i=this,r=$.trim(this._$addKeyInput.val()),o="",s=this._$element.attr("data-metadata-editor-id"),l=s+"-kv-li-"+this._newKeyIdx,c=s+"-kv-"+this._newKeyIdx,u=this._validateKey(r);if(null!==u)return void this._addErrorMessage(this._$addKeyInput,u);this._removeErrorMessage(this._$addKeyInput),i._blurAddKey();var d=i._templates.getTemplateFragment(n,{rootId:s,idx:""+i._newKeyIdx,key:r,value:o});this._$keyValueList.append(d),$("#"+c,i._$element).autosize({append:!1}),i._newKeyIdx++,i._$addKeyBtn.focus(),this._store.set(r,o,function(){},function(e){$("#"+l,i._$element).remove(),i._focusAddKey(),i._$addKeyInput.val(r);var t=i._getErrorResponseForKey(e,a);i._addErrorMessage(i._$addKeyInput,t)})},_focusAddKey:function(){this._$addKeyBtn.hide(),this._$addKeyBox.show(),this._$addKeySave.focus(),this._$addKeyInput.focus()},_blurAddKey:function(){this._$addKeyInput.blur(),this._hideAddKey()},_hideAddKey:function(e,t){this._removeErrorMessage(this._$addKeyInput),this._$addKeyInput.val(""),this._$addKeyBtn.show(),this._$addKeyBox.hide()},_initializeAutosize:function(){$('textarea[data-type="metadata-value"]',this._$element).autosize({append:!1})}},{create:function(e,n){return new t(e,n)}}}),Box.Timing.execution.push({name:"js/services/metadata-store.js",time:(new Date).getTime()}),Box.Application.addService("metadata-store",function(e){"use strict";function t(t,n,i){null===a&&(a=e.getService("ajax")),this.itemTypedId=t,this._metadataType=n,this._metadata=i,this._size=this._computeSize()}var n="box_metadata_edit_for_item",a=null;return t.prototype={size:function(){return this._size},has:function(e){return Object.prototype.hasOwnProperty.call(this._metadata,e)},get:function(e){var t,n=this;return n.has(e)&&(t=n._metadata[e]),t},getAsString:function(e){var t=this.get(e);return"undefined"==typeof t||null===t?"":t.toString()},set:function(e,t,i,r){var o,s,l=this,c=this._keyToPath(e),u=this.get(e),d=void 0!==u;o=d?[{op:"test",path:c,value:u},{op:"replace",path:c,value:t}]:[{op:"add",path:c,value:t}],s={item_typed_id:l.itemTypedId,metadata_type:l._metadataType,patch:JSON.stringify(o)},d||l._size++,l._metadata[e]=t,a.post(n,s,{success:i,error:function(t){d?l._metadata[e]=u:(l._size--,delete l._metadata[e]),r(t)}})},remove:function(e,t,i){var r=this,o=this._keyToPath(e),s=this.get(e),l=void 0!==s,c=[{op:"test",path:o,value:s},{op:"remove",path:o}],u={item_typed_id:r.itemTypedId,metadata_type:r._metadataType,patch:JSON.stringify(c)};l&&(delete r._metadata[e],r._size--,a.post(n,u,{success:t,error:function(t){r._metadata[e]=s,r._size++,i(t)}}))},_keyToPath:function(e){return"/"+e.replace(/~/g,"~0").replace(/\//g,"~1")},_computeSize:function(){var e,t=this,n=0;for(e in t._metadata)t.has(e)&&n++;return n}},{create:function(e,n){for(var a={},i=0,r=n.fields.length;r>i;i++){var o=n.fields[i];null!==o.value&&(a[o.key]=o.value)}return new t(e,n.type,a)},createFromRawInstance:function(e,n,a){return new t(e,n,a)}}}),Box.Timing.execution.push({name:"js/services/metadata-editor.js",time:(new Date).getTime()}),Box.Application.addService("metadata-editor",function(e){"use strict";function t(){H||(P=e.getService("datetime"),M=e.getService("popups"),O=e.getService("metadata-client"),I=e.getService("metadata-validator"),H=!0)}function n(e){this.containerElement=e}function a(e){var t=$(e);return t.is(U)?t.parent().get(0):e}function i(e,t){var n=$(a(e));n.attr("data-hover","tooltip"),n.attr("aria-label",t),n.addClass("kv-has-error")}function r(e){var t=$(a(e));t.removeAttr("data-hover"),t.removeAttr("aria-label"),t.removeClass("kv-has-error")}function o(e,t){return 409===e.status?B:t}function s(e){return $(e).attr("data-metadata-json-type")}function l(e){return $(e).attr("data-metadata-json-format")}function c(e){return $(e).attr("data-metadata-key")}function u(e){return $(e).attr("data-metadata-value")}function d(e,t){return $(e).attr("data-metadata-value",t)}function f(e){return $(e).closest(W).attr("data-metadata-type")}function p(e){return $(e).closest(W).attr("data-metadata-display-name")}function h(e){return $(e).closest(Z).attr("data-item-typed-id")}function m(e,t){if(""===e)return null;switch(t){case"string":return e;case"integer":return parseInt(e,10);case"float":return parseFloat(e);default:throw new Error("Unsupported type for convertValueType()")}}function g(e,t){if("string"!=typeof e)return e;switch(t){case"date-time":var n=P.parseShortDate(e);return null===n?null:$.datepicker.formatDate("yy-mm-ddT00:00:00.000Z",n);default:return e}}function v(e){var t=I.validate(e);if(!t.valid)return void i(e,t.message);var n=h(e),a=f(e),p=s(e),v=l(e),_=c(e),y=m($(e).val(),p),b=g(y,v),w=u(e),C=m(w,p),x={itemTypedId:n,type:a,key:_,value:b,oldValue:C};null===b?i(e,L):(d(e,b),r(e),O.set(x,function(){},function(t){d(e,w);var n=o(t,L);i(e,n)}))}function _(e){var t=h(e),n=f(e),a=s(e),l=c(e),p=u(e),g=m(p,a),v={itemTypedId:t,type:n,key:l,oldValue:g};d(e,""),r(e),O.remove(v,function(){},function(t){d(e,p);var n=o(t,L);i(e,n)})}function y(e){var t=$(e);t.val()!==u(e)&&(""===t.val()?_(e):v(e))}function b(t,n){t.hide(),O.deleteTemplate(n,function(){t.remove(),e.broadcast("metadataeditordeleted",{metadataType:n.type})},function(){t.show(),M.alert($t("There was an error deleting the template from this file. Please try again","metadata_delete_template_error"))})}function w(e){var t=$(e),n=f(e),a=h(e),i=p(e),r={itemTypedId:a,type:n},o=$t('Are you sure you want to remove the "%1" metadata?',"popup_action_remove_metadata",i);M.confirm(o,{onconfirm:function(){b(t,r)},confirmText:$t("Delete","popup_delete")})}function C(e){var t=u(e);$(e).val(t).trigger("autosize.resize")}function x(e){$(j,e).autosize({append:!1})}function T(e){var t=$(e);t.on("focus","[placeholder]",function(e){var t=$(this);t.attr("data-placeholder",t.attr("placeholder")),t.attr("placeholder","")}),t.on("blur","[placeholder]",function(e){var t=$(this);t.attr("data-placeholder")&&t.attr("placeholder",t.attr("data-placeholder"))}),t.on("focus",'[data-type="metadata-value"]',function(){var e=this,t=e.parentNode.querySelector('[data-type="save-value-btn"]');$(t).addClass("is-visible")}),t.on("blur",'[data-type="metadata-value"]',function(){var e=this,t=e.parentNode.querySelector('[data-type="save-value-btn"]');$(t).removeClass("is-visible")}),t.on("click",'[data-type="edit-value-btn"]',function(){var e=this,t=e.parentNode.querySelector('[data-type="metadata-value"]');t.focus()})}function S(e){var t=$(e);t.on("keyup input",j,function(e){27===e.which?(C(this),y(this)):13===e.which&&y(this)}),t.on("keyup input",V,function(e){13!==e.which&&r(this)}),t.on("blur",j,function(){y(this)}),t.on("keydown keyup",j,function(e){13===e.which&&e.preventDefault()})}function E(e){var t=$(e);t.on("keyup input",q,function(e){var t=$(this);(27===e.which||13===e.which)&&(t.datepicker("hide"),y(t))}),t.on("focus",q,function(){var e=$(this);e.datepicker({onClose:function(){y(e)}})}),t.on("keyup input",z,function(e){13!==e.which&&27!==e.which&&r(this)}),t.on("keydown keyup",q,function(e){13===e.which&&e.preventDefault()})}function R(e){var t=$(e);t.on("change",U,function(){var e=$(this);e.find(":selected").attr("data-null-option")?(_(this),e.addClass("enum-unselected")):(v(this),e.removeClass("enum-unselected"))}),t.on("focus",U,function(){var e=$(this),t=e.parent();t.addClass("focused")}),t.on("blur",U,function(){var e=$(this),t=e.parent();t.removeClass("focused")})}function k(e){var t=$(e);t.on("click",F,function(){var e=$(this),t=e.closest(W);w(t)})}function A(e){k(e),x(e),T(e),S(e),E(e),R(e)}function N(e){var t=$(e);t.off()}function D(e,t,n){var a=$(e),i=a.children(W),r=!1;i.each(function(){return t<f(this)?($(this).before(n),r=!0,!1):!0}),r||a.append(n)}var P,M,O,I,H=!1,L=$t("Value was not saved","kv_value_not_set"),B=$t("Value out of date. Please refresh page.","kv_value_conflict"),j='[data-metadata-editor="text"]',V='[data-metadata-editor="text"].kv-has-error',q='[data-metadata-editor="calendar"]',z='[data-metadata-editor="calendar"].kv-has-error',U='[data-metadata-editor="dropdown"]',F='[data-type="template-delete"]',W='[data-type="metadata-editor"]',Z='[data-type="metadata-editor-container"]';return n.prototype={init:function(){A(this.containerElement)},destroy:function(){N(this.containerElement)},insertMetadataEditor:function(e,t){N(this.containerElement),D(this.containerElement,e,t),A(this.containerElement)}},{create:function(e){return t(),new n(e)}}}),Box.Timing.execution.push({name:"js/services/metadata-client.js",time:(new Date).getTime()}),Box.Application.addService("metadata-client",function(e){"use strict";var t="box_metadata_edit_for_item",n="box_metadata_delete_for_item";return{set:function(n,a,i){var r,o,s=this._keyToPath(n.key),l=e.getService("ajax");r=null!==n.oldValue?[{op:"test",path:s,value:n.oldValue},{op:"replace",path:s,value:n.value}]:[{op:"add",path:s,value:n.value}],o={item_typed_id:n.itemTypedId,metadata_type:n.type,patch:JSON.stringify(r)},l.post(t,o,{success:a,error:i})},remove:function(n,a,i){var r=this._keyToPath(n.key),o=e.getService("ajax"),s=[{op:"test",path:r,value:n.oldValue},{op:"remove",path:r}],l={item_typed_id:n.itemTypedId,metadata_type:n.type,patch:JSON.stringify(s)};o.post(t,l,{success:a,error:i})},deleteTemplate:function(t,a,i){var r=e.getService("ajax"),o={item_typed_id:t.itemTypedId,metadata_type:t.type};r.post(n,o,{success:a,error:i})},_keyToPath:function(e){return"/"+e.replace(/~/g,"~0").replace(/\//g,"~1")}}}),Box.Timing.execution.push({name:"js/services/metadata-validator.js",time:(new Date).getTime()}),Box.Application.addService("metadata-validator",function(e){"use strict";function t(e){return"string"==typeof e}function n(e){var t=new RegExp("^(\\-|\\+)?([0-9]+)$");return t.test(e)}function a(e){var t=new RegExp("^(\\-|\\+)?([0-9]+(\\.[0-9]+)?)$");return t.test(e)}function i(e,i){return"string"===i?t(e):"integer"===i?n(e):"float"===i?a(e):!0;

}function r(t){var n=e.getService("datetime");return null!==n.parseShortDate(t)}function o(e,t){return"date-time"===t?r(e):!0}function s(e,t){return e.length<=parseFloat(t)}function l(e,t){return e.length>=parseFloat(t)}function c(e,t){return parseFloat(e)<=parseFloat(t)}function u(e,t){return parseFloat(e)>=parseFloat(t)}function d(e,t){var n=new RegExp(t);return n.test(e)}function f(e,t){return t?g.type[e]?g.type[e]:e:g.format[e]?g.format[e]:e}function p(e){return Object.prototype.hasOwnProperty.call(v,e)}function h(e,t,n){return v[t].call(this,e,n)}function m(e,t){return _[e].call(this,t)}var g={type:{"float":$t("Number","number_human_readable_type"),string:$t("Text","text_human_readable_type"),"enum":$t("Dropdown","dropdown_human_readable_type"),integer:$t("Integer","integer_human_readable_type")},format:{"date-time":$t("Date","date_human_readable_type")}},v={"data-metadata-json-type":i,"data-metadata-json-format":o,"data-metadata-maxlength":s,"data-metadata-minlength":l,"data-metadata-max":c,"data-metadata-min":u,"data-metadata-pattern":d},_={"data-metadata-json-type":function(e){return $t("Value must be of type: %1","type_validation_error",f(e,!0))},"data-metadata-json-format":function(e){return $t("Value must be of format: %1","format_validation_error",f(e,!1))},"data-metadata-maxlength":function(e){return $t("Value must be no more than %1 characters","maxLength_validation_error",e)},"data-metadata-minlength":function(e){return $t("Value must be no less than %1 characters","minLength_validation_error",e)},"data-metadata-max":function(e){return $t("Value must be less than or equal to %1","max_validation_error",e)},"data-metadata-min":function(e){return $t("Value must be greater than or equal to %1","min_validation_error",e)},"data-metadata-pattern":function(){return $t("Value must match pattern","pattern_validation_error")}};return{validate:function(t){for(var n=e.getService("dom"),a=n.query(t),i=a.value,r=a.attributes,o=0;o<r.length;o++){var s=r[o],l=s.name,c=s.value;if(p(l)&&!h(i,l,c))return{valid:!1,message:m(l,c)}}return{valid:!0,message:null}}}}),Box.Timing.execution.push({name:"js/services/preview/widgets/scrubber.js",time:(new Date).getTime()}),Box.Application.addService("scrubber",function(e){"use strict";function t(e,t){return t>=e.left&&t<=e.right}function n(e,t){e.value=Math.max(Math.min(t,e.convertedValue),c);var n=d.getBoundingClientRect(e.handleEl).width||16,a=d.getBoundingClientRect(e.scrubberEl).width,i=e.value*(a-n)*100/a;e.handleEl.style.left=i+"%",e.playedEl.style.width=100*e.value+"%"}function a(e,t){e.bufferedValue=Math.max(Math.min(Math.max(t,e.bufferedValue),e.convertedValue),c),e.bufferedEl.style.width=100*e.bufferedValue+"%"}function i(e,t){e.convertedValue=Math.max(Math.min(Math.max(t,e.convertedValue),u),c),e.convertedEl.style.width=100*e.convertedValue+"%"}function r(e){return function(a){var i=d.getBoundingClientRect(e.scrubberEl),r=a.pageX;e.mouseDownOnScrubber&&t(i,r)&&(n(e,(r-i.left)/i.width),e.fire("slide"))}}function o(e){return function(t){!("number"!=typeof t.button||t.button<2)||t.ctrlKey||t.metaKey||(e.mouseDownOnScrubber=!0,e.updateScrubberHandleRef(t),d.on(p,"mouseup",e.mouseUpHandlerRef),d.on(p,"mouseleave",e.mouseUpHandlerRef),d.on(p,"mousemove",e.updateScrubberHandleRef),t.preventDefault())}}function s(e){return function(){e.mouseDownOnScrubber=!1,d.off(p,"mouseup",e.mouseUpHandlerRef),d.off(p,"mouseleave",e.mouseUpHandlerRef),d.off(p,"mousemove",e.updateScrubberHandleRef)}}function l(e,t,l,p,h){var m=f.getTemplateFragment("preview-scrubber",{accessibilityText:h});d.setHTML(e,m),this.value=t||c,this.convertedValue="number"==typeof p?p:u,this.bufferedValue="number"==typeof l?l:p,this.scrubberEl=e,this.mouseDownOnScrubber=!1,this.bufferedEl=d.query(".preview-scrubber-buffered",this.scrubberEl),this.convertedEl=d.query(".preview-scrubber-converted",this.scrubberEl),this.playedEl=d.query(".preview-scrubber-played",this.scrubberEl),this.handleEl=d.query(".preview-scrubber-handle",this.scrubberEl),this.updateScrubberHandleRef=r(this),this.mouseDownHandlerRef=o(this),this.mouseUpHandlerRef=s(this),i(this,this.convertedValue),a(this,this.bufferedValue),n(this,this.value),d.on(this.convertedEl,"mousedown",this.mouseDownHandlerRef),d.on(this.handleEl,"mousedown",this.mouseDownHandlerRef),$.extend(this,new Box.EventTarget)}var c=0,u=1,d=e.getService("dom"),f=e.getService("templates"),p=e.getGlobal("document");return l.prototype={destroy:function(){d.off(p,"mousemove",this.updateScrubberHandleRef),d.off(p,"mouseup",this.mouseUpHandlerRef),d.off(p,"mouseleave",this.mouseUpHandlerRef),d.off(this.convertedEl,"mousedown",this.mouseDownHandlerRef),d.off(this.handleEl,"mousedown",this.mouseDownHandlerRef),d.setHTML(this.scrubberEl,""),this.convertedEl=void 0,this.bufferedEl=void 0,this.playedEl=void 0,this.handleEl=void 0,this.scrubberEl=void 0},getValue:function(){return this.value},setValue:function(e){n(this,e),this.fire("set")},setBufferedValue:function(e){a(this,e)},setConvertedValue:function(e){i(this,e)},getScrubberHandleEl:function(){return this.handleEl},getConvertedBarEl:function(){return this.convertedEl}},{create:function(e,t,n,a,i){return new l(e,t,n,a,i)},destroy:function(e){e&&(e.destroy(),e=void 0)}}}),Box.Timing.execution.push({name:"js/services/preview/widgets/preview-crocodoc-wrapper.js",time:(new Date).getTime()}),Box.Application.addService("preview-crocodoc-wrapper",function(e){"use strict";var t=e.getGlobal("Crocodoc"),n={};return t.addPlugin("viewer-scope",function(e){n=e}),{create:function(e,a){var i;return a.plugins={"viewer-scope":{}},i=t.createViewer(e,a),i.broadcast=n.broadcast,i}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-iframe.js",time:(new Date).getTime()}),Box.Application.addModule("preview-iframe",function(e){"use strict";var t,n,a;return{init:function(){t=e.getConfig(),n=$(e.getElement()),a=n.find(".preview-iframe"),t.add_class&&a.addClass(t.add_class),a[0].setAttribute("src",t.note_url),e.broadcast("previewloaded",{contentType:"iframe"})}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-swf.js",time:(new Date).getTime()}),Box.Application.addModule("preview-swf",function(e){"use strict";return{init:function(){var t=e.getService("browser"),n=e.getGlobal("swfobject"),a=e.getElement(),i=a.getAttribute("data-url"),r={allowfullscreen:"true",allowFullScreen:"true",allownetworking:"none",allowNetworking:"none",allowscriptaccess:"never",allowScriptAccess:"never",wmode:"transparent"},o={"class":" preview-flash-content"};n.embedSWF(i,"flash-player","100%","100%",t.getMinimumFlashVersion(),null,null,r,o,function(){e.broadcast("previewloaded",{contentType:"swf"})})}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-image.js",time:(new Date).getTime()}),Box.Application.addModule("preview-image",function(e){"use strict";function t(){M?(x.addClass(h,k),P=!1,x.removeClass(h,R)):(x.removeClass(h,k),P=!0,x.addClass(h,R))}function n(){var n=x.getBoundingClientRect(h),a=x.getBoundingClientRect(v);M=n.width>a.width||n.height>a.height,I=!1,n.height>a.height?e.broadcast("previewcontentresized",{isScrollbarVisible:!0}):e.broadcast("previewcontentresized",{isScrollbarVisible:!1}),t()}function a(e){if(H){var t,i,r,o,s,l=1,c=Math.abs(D)%180===90,u="IMG"!==g,d=x.getBoundingClientRect(h),f=x.getBoundingClientRect(v),p=d.width,m=d.height,_=p/m;switch(s=_>=1||u,o={width:f.width-(u?0:15),height:f.height-(u?0:15)},e){case"in":s?i=p+100:r=m+100;break;case"out":s?i=p-100:r=m-100;break;case"reset":return h.style.width="",h.style.height="",void a();default:if(p>o.width||m>o.height)l=Math.min(o.width/p,o.height/m),s?i=p*l:r=m*l;else{var y=c?h.naturalHeight:h.naturalWidth,b=c?h.naturalWidth:h.naturalHeight;s?i=Math.min(o.width,y):r=Math.min(o.height,b)}}c&&(t=i,i=r,r=t),h.style.width=i?i+"px":"",h.style.height=r?r+"px":"",v.scrollLeft=(v.scrollWidth-o.width)/2,u||(v.scrollTop=(v.scrollHeight-o.height)/2),setTimeout(n,50)}}function i(e){if(O){var t=e.clientX-_,n=e.clientY-y;v.scrollLeft=b-t,v.scrollTop=w-n,I=!0}}function r(){O=!1,x.off(document.body,"mousemove",i),x.off(document.body,"mouseup",r),x.removeClass(h,A)}function o(e,t){M&&(_=e,y=t,b=v.scrollLeft,w=v.scrollTop,O=!0,x.on(document.body,"mousemove",i),x.on(document.body,"mouseup",r),x.addClass(h,A))}function s(){return"IMG"===g?h:h.firstElementChild||h.children[0]}function l(){return!1}function c(){var e,t=x.query(".preview-controls-btn-rotate-left");T.isTransformSupported()?"IMG"!==g&&(e=$t("This file type does not support rotation","preview_file_rotate_not_supported")):e=$t("Your browser does not support rotation","preview_rotate_not_supported"),e&&t&&(x.addClass(t,"disabled"),t.setAttribute("aria-label",e),t.setAttribute("data-hover","tooltip"),t.setAttribute("disabled","disabled"))}function u(){var e=[{key:"down",handler:function(){v.scrollTop+=80}},{key:"up",handler:function(){v.scrollTop-=80}},{key:"[",handler:function(){v.scrollTop-=window.innerHeight/2}},{key:"]",handler:function(){v.scrollTop+=window.innerHeight/2}},{key:"f",handler:function(){T.isIE()&&T.isMinBrowser("explorer","11")||(C.isFullScreen()?C.exit():C.enter())}}];L&&(e=e.concat([{key:"shift+=",handler:function(){a("in")}},{key:"shift+-",handler:function(){a("out")}}])),S.setConfig(e,N)}function d(){if("IMG"===g){var e=D-90;D=-3600===e?0:e,$(h).css("transform","rotate("+D+"deg)")}}function f(){H=!0,e.broadcast("previewloaded",{contentType:"image"}),m=x.queryAll("img",v),x.on(m,"dragstart",l),a(),x.removeClass(p,"invisible"),u()}var p,h,m,g,v,_,y,b,w,C,x,T,S,E,R="zoomable",k="pannable",A="panning",N="preview",D=0,P=!0,M=!1,O=!1,I=!1,H=!1,L=!0;return{messages:["previewresized"],behaviors:["preview-controls"],onmessage:function(e){"previewresized"===e&&a()},init:function(){var t;x=e.getService("dom"),T=e.getService("browser"),S=e.getService("hotkeys"),E=e.getService("tooltips-amsterdam"),C=e.getService("fullscreen"),p=e.getElement(),h=p.querySelector(".preview-image-wrapper")||p.querySelector(".preview-image-content"),v=h.parentNode,g=h.tagName,t=s(),L="false"!==p.getAttribute("data-pan-and-zoom-allowed"),t.complete?f():t.onload=f,c()},destroy:function(){S.unsetHotkeyForConfig("down",N),S.unsetHotkeyForConfig("up",N),S.unsetHotkeyForConfig("[",N),S.unsetHotkeyForConfig("]",N),x.off(m,"dragstart",l)},onmousedown:function(e,t,n){if("preview-image"===n){if(!L)return;I=!1,!("number"!=typeof e.button||e.button<2)||e.ctrlKey||e.metaKey||(o(e.clientX,e.clientY),e.preventDefault())}},onmouseup:function(e,t,n){if("preview-image"===n){if(!L)return;!("number"!=typeof e.button||e.button<2)||e.ctrlKey||e.metaKey||(!M&&P?a("in"):I||a("reset"),e.preventDefault())}},oncontextmenu:function(e,t,n){"preview-image"===n&&x.hasClass(p,"is-read-only")&&e.preventDefault()},onclick:function(e,t,n){if(t&&n&&!t.disabled)switch(E.hideAll(),n){case"zoomout":a("out");break;case"zoomin":a("in");break;case"enterfullscreen":C.enter();break;case"exitfullscreen":C.exit();break;case"rotateleft":d()}}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-3dcg.js",time:(new Date).getTime()}),Box.Application.addModule("preview-3dcg",function(e){"use strict";function t(){return Z?Z.assetRegistry.getAssetById("SCENE_ID"):null}function n(){var e=t();return e?e.getChildById("CAMERA_ID"):null}function a(){var e=de.clientWidth,t=de.clientHeight;return e/t}function i(e){var t=Object.keys(Ne).filter(function(t){return Ne[t].renderMode===e});return t[0]}function r(e,t){t?J.removeClass(e,Te):J.addClass(e,Te)}function o(e){r(e,J.hasClass(e,Te))}function s(){fe.confirm($t("Successfully saved scene defaults!","box3d_scene_defaults_save_success"))}function l(){fe.error($t("Box3D Settings not available. Please reupload model to be able to save scene defaults","box3d_scene_defaults_save_fail"))}function c(t,n,a){return ce?(le||(le=e.getService("metadata-client")),void le.set({itemTypedId:"f_"+ee,key:t,oldValue:a,value:n,type:ce},s,l)):fe.error($t("Not able to save scene defaults. Please reupload to allow saving of scene defaults","box3d_no_template_type"))}function u(){var e=!0;he!==pe&&(c("defaultRenderMode",pe,he),he=pe,e=!1),X!==K&&(c("cameraProjection",K,X),X=K,e=!1),Z.trigger("get_axes",function(t){t.forward!==F&&(c("forwardAxis",t.forward,F),F=t.forward,e=!1),t.up!==U&&(c("upAxis",t.up,U),U=t.up,e=!1),r(be,e)})}function d(e){Z&&xe.globalEvents.trigger("setRenderMode",e.renderMode),ve&&(ve.className=e.icon),J.addClass(me,Te),e.el=e.el||J.query(e.elQuery),J.removeClass(ge,Se),J.addClass(e.el,Se),ge=e.el}function f(e){pe=e.renderMode,d(e),J.setHTML(ye,e.name),J.addClass(_e,Te)}function p(){var e=n();xe&&d(Ne[i(he||"Lit")]),e&&e.trigger("resetOrbitCameraController")}function h(){ue&&ue.alignToPosition(ke,ke)}function m(e,t,n){Z&&(Z.trigger("set_axes",e||"+Y",t||"+Z",n),h())}function g(e){Pe=e}function v(e){if(ue&&Z&&!Me){var t={};t[Pe]=e*De,Z.trigger("rotate_on_axis",t,!0),Z.on("postUpdate",h),ue.once("axis_transition_complete",function(){Z.off("postUpdate",h),h(),Me=!1}),Me=!0}}function _(){var e,t,i=n();i&&"perspective"===i.getProperty("cameraType")&&(e=a(),i.setProperties({top:50,bottom:-50,left:-50*e,right:50*e,cameraType:"orthographic"}),t=i.componentRegistry.getById("previewCameraController"),i.trigger("resetOrbitCameraController"),K=Ae.orthorgraphic),Q&&J.setHTML(Q,$t("Orthographic Camera","projection_orthographic_camera")),Y&&J.addClass(Y,Te)}function y(){var e,t=n();t&&"orthographic"===t.getProperty("cameraType")&&(t.setProperties({aspect:a(),cameraType:"perspective"}),e=t.componentRegistry.getById("previewCameraController"),t.trigger("resetOrbitCameraController"),K=Ae.perspective),Q&&J.setHTML(Q,$t("Perspective Camera","projection_perspective_camera")),Y&&J.addClass(Y,Te)}function b(){m(U,F,!0),f(Ne[i(he||"Lit")]),X===Ae.orthorgraphic?_():y()}function w(){var e=t().runtimeData;ie=new Ce.GridHelper(50,10,11184810,11184810),e.add(ie),ie.visible=!1,re=new Ce.AxisHelper(50),e.add(re),re.visible=!1}function C(e){var t=!1;t=void 0!==e?!!e:!ie.visible,re.visible=t,ie.visible=t}function x(e,t,n){var a=t.createInstance(e);a&&(oe.push(a),a.scaleToSize(100),a.alignToPosition(ke,ke),n&&n(a),a.componentRegistry.add("preview_axis_rotation",{},"axis_rotation_"+a.id),t.addChild(a),ue=a)}function T(){Z.trigger("update"),Z.trigger("render"),Z.container&&(Z.container.removeChild(Z.canvas),Z.container=null),Z.pause()}function S(){Z&&(Z.container||(Z.container=G,Z.container.appendChild(Z.canvas)),Z.unpause())}function E(){var e=Object.keys(se);if(e.length){var t=e.reduce(function(e,t){return e+", "+t});fe.warn(e.length>1?$t("This model is missing some assets: %1","missing_assets_notice",t):$t("This model is missing an asset: %1","missing_asset_notice",t))}}function R(){var n=t();n&&n.once("load",function(){Z&&(p(),E(),m(U,F,!1),e.broadcast("previewloaded",{contentType:"3DCG"}))})}function k(){var e,t,n=Z.assetRegistry.Materials.assets;for(t in n)n.hasOwnProperty(t)&&(e=n[t],e.setProperty("useSceneLights",!1),e.setProperty("useEnvironmentMap",!0),e.setProperty("environmentMapCube_0","HDR_ENV_MAP_CUBE_0"),e.setProperty("environmentMapCube_1","HDR_ENV_MAP_CUBE_1"),e.setProperty("environmentMapCube_2","HDR_ENV_MAP_CUBE_2"),e.setProperty("environmentMapProjection","cubeMap"))}function A(e){var n,a;if(Z){e.forEach(function(e){"prefab"===e.type?n=e:"meshGeometry"===e.type&&(a=e)}),k();var i=Z.getApplication().componentRegistry.getFirstByScriptId("render_modes");if(i.setAttribute("shapeTexture","MAT_CAP_TEX"),n&&a){var r=Z.assetRegistry.getAssetById(n.id),o=Z.assetRegistry.getAssetById(a.id);o.once("load",function(){x(r,t(),R)},this),o.load()}else R();w(),e.forEach(function(e){var t=Z.getEntityById(e.id);t.isAsset()&&z.push(t)})}}function N(){fe.error($t("This preview needs to be re-generated. To preview, reupload this file.","preview_out_of_date"))}function D(e){var t=new xe.JSONLoader(Z);t.loadFromUrl(e).then(function(e){A(e)},N)}function P(e){if(!(Object.keys(se).length>=Re)){var t=e.fileName||e.assetName;se[t]=se[t]||e}}function M(e){e.on("missingAsset",P)}function O(e){e.removeAllListeners(),se={}}function $(e,t){Z=new xe.Engine,Z.initialize({engineName:"Default",entities:Ee,resourceLoader:e,container:G},function(){var e=Z.assetRegistry.getAssetById("APP_ASSET_ID");e.load(t)})}function I(t,n,a,i){var r=e.getService("assets"),o=e.getService("preview-cache");r.loadJSByHash(t,function(){var t,r={};return xe=e.getGlobal("Box3D"),Ce=e.getGlobal("THREE"),xe&&(W=e.getGlobal("Box3DResourceLoader"))?(a&&(r.sharedName=a),r.apiBase="",t=new W(ee,n,r),M(t),(Z=o.recall("box3d"))?(Z.resourceLoader=t,void i()):void $(t,function(){o.memorize("box3d",Z),i()})):void i()})}function H(){var e=t().runtimeData;e.remove(ie),ie.material.dispose(),ie.geometry.dispose(),e.remove(re),re.material.dispose(),re.geometry.dispose(),oe.forEach(function(e){e.destroy()}),z.forEach(function(e){e.destroy()}),oe.length=0,z.length=0}function L(){if(Z){var e=[];e.push(Z.getEntityById("HDR_ENV_MAP_CUBE_0")),e.push(Z.getEntityById("HDR_ENV_MAP_CUBE_1")),e.push(Z.getEntityById("HDR_ENV_MAP_CUBE_2")),e.push(Z.getEntityById("HDR_ENV_MAP_0")),e.push(Z.getEntityById("HDR_ENV_MAP_1")),e.push(Z.getEntityById("HDR_ENV_MAP_2")),e.push(Z.getEntityById("HDR_ENV_IMG_0")),e.push(Z.getEntityById("HDR_ENV_IMG_1")),e.push(Z.getEntityById("HDR_ENV_IMG_2")),e.forEach(function(e){e&&e.unload()})}}function B(){var e,t;Z&&(e=de.clientWidth,t=de.clientHeight,G.style.width=e+"px",G.style.height=t+"px",Z.trigger("resize"),Z.needsRender=!0)}function j(){te.off("exit",j),r(ne,!0),r(ae,!1)}function V(){var e=te.isFullScreen();e?te.exit():(te.enter(),te.on("exit",j)),r(ne,e),r(ae,!e)}function q(){we||(we=J.query(".preview-settings-wrapper",de)),r(we,!1)}var z,U,F,W,Z,G,K,X,Q,Y,J,ee,te,ne,ae,ie,re,oe,se,le,ce,ue,de,fe,pe,he,me,ge,ve,_e,ye,be,we,Ce,xe,Te="hidden",Se="current-render-mode",Ee=[{id:"CAMERA_ID",type:"camera",parentId:"SCENE_ID",parentAssetId:"SCENE_ID",properties:{position:{x:49,y:35.3,z:70.3},quaternion:{x:-.185,y:.294,z:.058,w:.936},near:1,far:600},components:{renderView:{enabled:!0,scriptId:"render_view_component"},previewCameraController:{componentData:{orbitDistanceMin:2,orbitDistanceMax:300,useKeyboard:!1,enablePan:!0},enabled:!0,scriptId:"preview_camera_controller"},previewCameraFocus:{componentData:{},enabled:!0,scriptId:"preview_camera_focus"}}},{id:"SCENE_ID",type:"scene",parentAssetId:"SCENE_ID",children:["CAMERA_ID","AMBIENT_LIGHT_ID"]},{id:"AMBIENT_LIGHT_ID",type:"light",parentAssetId:"SCENE_ID",properties:{lightType:"ambient"}},{id:"APP_ASSET_ID",type:"application",parentAssetId:"APP_ASSET_ID",properties:{startupScene:"SCENE_ID"},components:{veroldRenderer:{componentData:{antialias:!0},scriptId:"box3d_renderer",isBuiltIn:!0,enabled:!0},inputController:{scriptId:"input_controller_component",isBuiltIn:!0,enabled:!0},renderModesComponent:{componentData:{},scriptId:"render_modes"}}},{id:"HDR_ENV_IMG_0",type:"image",properties:{name:"HDR Env Image 0",isHdr:!0,width:1024,height:512,stream:!1},representations:[{src:"/img/3dcgimages/HDR_Env0.png?"+Date.now(),isExternal:!0,contentType:"image/png",contentEncoding:"identity",width:1024,height:512,compression:"zip",channels:["red","green","blue","exponent"]}]},{id:"HDR_ENV_IMG_1",type:"image",properties:{name:"HDR Env Image 1",isHdr:!0,width:256,height:128,stream:!1},representations:[{src:"/img/3dcgimages/HDR_Env1.png?"+Date.now(),isExternal:!0,contentType:"image/png",contentEncoding:"identity",width:256,height:128,compression:"zip",channels:["red","green","blue","exponent"]}]},{id:"HDR_ENV_IMG_2",type:"image",properties:{name:"HDR Env Image 2",isHdr:!0,width:64,height:32,stream:!1},representations:[{src:"/img/3dcgimages/HDR_Env2.png?"+Date.now(),isExternal:!0,contentType:"image/png",contentEncoding:"identity",width:64,height:32,compression:"zip",channels:["red","green","blue","exponent"]}]},{id:"HDR_ENV_MAP_0",type:"texture2D",properties:{name:"HDR Env Map 0",imageId:"HDR_ENV_IMG_0",isHdr:!0,generateMipmaps:!1,minFilter:"linear",magFilter:"linear",vMapping:"clamp"}},{id:"HDR_ENV_MAP_CUBE_0",type:"renderTextureCube",properties:{name:"HDR Env Map Cube 0",isHdr:!0,type:"float",width:512,height:512,generateMipmaps:!0,vMapping:"clamp",uMapping:"clamp"},components:{equirectToCubemap:{scriptId:"panorama_to_cubemap_script",enabled:!0,componentData:{inputTexture:"HDR_ENV_MAP_0"}}}},{id:"HDR_ENV_MAP_1",type:"texture2D",properties:{name:"HDR Env Map 1",imageId:"HDR_ENV_IMG_1",isHdr:!0,generateMipmaps:!1,minFilter:"linear",magFilter:"linear",vMapping:"clamp"}},{id:"HDR_ENV_MAP_CUBE_1",type:"renderTextureCube",properties:{name:"HDR Env Map Cube 1",isHdr:!0,type:"float",width:128,height:128,generateMipmaps:!0,vMapping:"clamp",uMapping:"clamp"},components:{equirectToCubemap:{scriptId:"panorama_to_cubemap_script",enabled:!0,componentData:{inputTexture:"HDR_ENV_MAP_1"}}}},{id:"HDR_ENV_MAP_2",type:"texture2D",properties:{name:"HDR Env Map 2",imageId:"HDR_ENV_IMG_2",isHdr:!0,minFilter:"linear",magFilter:"linear",vMapping:"clamp"}},{id:"HDR_ENV_MAP_CUBE_2",type:"renderTextureCube",properties:{name:"HDR Env Map Cube 2",isHdr:!0,type:"float",width:32,height:32,generateMipmaps:!0,vMapping:"clamp",uMapping:"clamp"},components:{equirectToCubemap:{scriptId:"panorama_to_cubemap_script",enabled:!0,componentData:{inputTexture:"HDR_ENV_MAP_2"}}}},{id:"MAT_CAP_IMG",type:"image",properties:{name:"Mat Cap Image",width:256,height:256,stream:!1},representations:[{src:"/img/3dcgimages/matcap.png?"+Date.now(),isExternal:!0,contentType:"image/png",contentEncoding:"identity",width:256,height:256,compression:"zip"}]},{id:"MAT_CAP_TEX",type:"texture2D",properties:{name:"Mat Cap Texture",imageId:"MAT_CAP_IMG",uMapping:"clamp",vMapping:"clamp"}}],Re=4,ke={x:0,y:0,z:0},Ae={orthorgraphic:"Orthographic",perspective:"Perspective"},Ne={lit:{name:$t("Lit","default_render_mode_lit"),key:"lit",icon:"sprite_preview_17x17_rm_lit",renderMode:"Lit",elQuery:".rm-lit",el:null},unlit:{name:$t("Unlit","default_render_mode_unlit"),key:"unlit",icon:"sprite_preview_17x17_rm_unlit",renderMode:"Unlit",elQuery:".rm-unlit",el:null},normals:{name:$t("Normals","default_render_mode_normals"),key:"normals",icon:"sprite_preview_17x17_rm_normals",renderMode:"Normals",elQuery:".rm-normals",el:null},shape:{name:$t("Shape","default_render_mode_shape"),key:"shape",icon:"sprite_preview_17x17_rm_normals",renderMode:"Shape",elQuery:".rm-shape",el:null},wireframe:{name:$t("Wireframe","default_render_mode_wireframe"),key:"wireframe",icon:"sprite_preview_17x17_rm_wireframe",renderMode:"Wireframe",elQuery:".rm-wireframe",el:null},flatwire:{name:$t("Untextured Wireframe","default_render_mode_untextured_wireframe"),key:"flatwire",icon:"sprite_preview_17x17_rm_untexturedwireframe",renderMode:"Untextured Wireframe",elQuery:".rm-untexturedwireframe",el:null},uv:{name:$t("UV Overlay","default_render_mode_uv"),key:"uv",icon:"sprite_preview_17x17_rm_uvoverlay",renderMode:"UV Overlay",elQuery:".rm-uvoverlay",el:null}},De=90,Pe="y",Me=!1;return{messages:["previewresized","embedwidgetevent","togglefullscreen"],onmessage:function(e,t){"previewresized"===e?B():"togglefullscreen"===e?V():"embedwidgetevent"===e&&"reset"===t.type&&p()},init:function(){var t=e.getConfig("box3dJs"),n=e.getConfig("fileUrl"),a=e.getConfig("fileVersionId"),o=e.getConfig("sharedName"),s=e.getConfig("metadata"),l=e.getConfig("permissions")||{};if(J=e.getService("dom"),te=e.getService("fullscreen"),fe=e.getService("notifications"),ee=e.getConfig("fileId"),de=e.getElement(),G=J.query(".box3d-container",de),ne=J.query(".controls-fullscreen",de),ae=J.query(".controls-minimize",de),be=J.query(".settings-panel",de),me=J.query(".render-mode-selector",de),ve=J.query(".sprite_preview_17x17_rendermodes",de),ge=J.query(Se,de),_e=J.query(".render-mode-list",de),ye=J.query(".render-mode-selected",de),Y=J.query(".camera-projection-list",de),Q=J.query(".camera-projection-selected",de),!l["delete"]||!l.upload){var c=J.query(".settings-panel",de),u=J.query(".save-btn",c);r(u,!1)}if(Z=null,oe=[],z=[],se={},s){U=s.axisUp,F=s.axisForward,he=s.defaultRenderMode,X=s.cameraProjection,ce=s.templateType,pe=he||"Lit",K=X||"Perspective";var f=i(pe);d(Ne[f]),ye&&J.setHTML(ye,pe)}else q();I(t,a,o,function(){return Z?(S(),X===Ae.orthorgraphic?_():y(),void D(n)):void fe.error($t("Sorry, we were unable to preview this file.","unable_to_preview_file"))})},destroy:function(){Z&&(T(),H(),L(),Z.resourceLoader&&(O(Z.resourceLoader),Z.resourceLoader.destroy(),Z.resourceLoader=null),Z=null,ue=null,Me=!1)},onclick:function(e,t,n){if(t&&n&&!t.disabled)switch(n){case"3dcgcanvascontainer":r(me,!1),r(be,!1),C(!1);break;case"enterfullscreen":case"exitfullscreen":V();break;case"rendermodelit":d(Ne.lit);break;case"rendermodeunlit":d(Ne.unlit);break;case"rendermodenormals":d(Ne.normals);break;case"rendermodeshape":d(Ne.shape);break;case"rendermodewireframe":d(Ne.wireframe);break;case"rendermodeuntexturedwireframe":d(Ne.flatwire);break;case"rendermodeuvoverlay":d(Ne.uv);break;case"rendermodes":o(me),r(be,!1),C(!1);break;case"settingspanel":r(me,!1),r(_e,!1),r(Y,!1),o(be),C();break;case"rotatenegativex":g("x"),v(-1);break;case"rotatepositivex":g("x"),v(1);break;case"rotatenegativey":g("y"),v(-1);break;case"rotatepositivey":g("y"),v(1);break;case"rotatenegativez":g("z"),v(1);break;case"rotatepositivez":g("z"),v(-1);break;case"reset":p();break;case"defaultrendermodeselector":o(_e);break;case"defaultrendermodelit":f(Ne.lit);break;case"defaultrendermodeunlit":f(Ne.unlit);break;case"defaultrendermodenormals":f(Ne.normals);break;case"defaultrendermodeshape":f(Ne.shape);break;case"defaultrendermodewireframe":f(Ne.wireframe);break;case"defaultrendermodewireframeflat":f(Ne.flatwire);break;case"defaultrendermodeuv":f(Ne.uv);break;case"cameraprojectionselector":o(Y);break;case"perspectivecamera":y();break;case"orthographiccamera":_();break;case"setting-save":u();break;case"setting-reset":b()}}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-media.js",time:(new Date).getTime()}),Box.Application.addModule("preview-media",function(e){"use strict";function t(){return G.recall("autoplay")}function n(){t()?se.addClass(z,Se):se.removeClass(z,Se)}function a(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),a=Math.floor(e%3600%60);return(t>0?t.toString()+":":"")+(10>n?"0"+n.toString():n.toString())+":"+(10>a?"0"+a.toString():a.toString())}function i(){V?Ae?V.pause():V.play():j.fire(Ae?"pause":"play",null)}function r(t,n){ke=Math.max(.04,n),le?(e.broadcast("previewmediatimeupdate",{scrubber:ne,loaded:n}),ne.setValue(t)):(ne.find(".loaded").css("left",Math.floor(100*n)+"%"),ne.val(t))}function o(e){se.setText(J,a(e))}function s(e){se.setText(ee,a(e))}function l(){return le?ae.getValue():ae.val()}function c(){var t=e.getService("assets"),n=e.getService("browser"),a=e.getGlobal("swfobject");if(a&&"function"==typeof a.embedSWF){var i={backgroundColor:"#ffffff",conversion_on_realtime:!0,lightbox_preview:!0},r={allowfullscreen:"true",allowscriptaccess:"always",wmode:"transparent"},o=t.getFlashAssetURL(),s=t.getAssetURL(o,"preview.swf");a.embedSWF(s,"flash-player","2","2",n.getMinimumFlashVersion(),null,i,r,{"class":" preview-flash-content"})}else e.reportError(new Error("swf object undefined"))}function u(){Ae=!1;var t=q.getAttribute("data-typed-id");j=se.query("object"),Y=e.getService("templates");var n=Y.getTemplateHTML("flash_xml"),a=[];a[0]={identifier:t,xml:n},j.updateFiles(a,t)}function d(e){e.width&&$(j).css({width:e.width}),$(j).removeAttr("width").removeAttr("height")}function f(){clearTimeout(oe),oe=setTimeout(function(){se.addClass(ie,me)},ue)}function p(){return W||(W=F.throttle(function(){Ae&&(se.removeClass(ie,me),f())},ue-500,!0)),W}function h(){Ae=!0,se.addClass(z,fe),se.removeClass(ie,pe),ie&&(se.removeClass(ie,de),se.addClass(ie,fe),"audio"===re&&(se.on(q,"mousemove",p()),f())),e.broadcast(_e)}function m(){Ae=!1,se.removeClass(z,fe),ie&&(se.removeClass(ie,fe),se.addClass(ie,de),"audio"===re&&(se.off(q,"mousemove",p()),clearTimeout(oe),se.removeClass(ie,me))),e.broadcast(ve)}function g(){t()?e.broadcast("previewshownext"):(m(),s(0),r(0,1))}function v(e){var t=Me,n=Oe;V&&(ce>=1?("in"===e?(t=Math.min(100,Me+10),Me=t):"out"===e?(t=Math.max(10,Me-10),Me=t):"max"===e&&(t=100),V.style.width=t+"%"):("in"===e?(n=Math.min(100,Oe+10),Oe=n):"out"===e?(n=Math.max(10,Oe-10),Oe=n):"max"===e&&(n=100),V.style.height=n+"%"))}function _(){v("max")}function y(){v()}function b(){var n;Pe||(V.volume=l()||.7,e.broadcast("previewloaded",{contentType:V.tagName.toLowerCase()}),t()&&V.play(),ce=V.videoWidth/V.videoHeight,n=q.getBoundingClientRect(),V.videoWidth<n.width&&V.videoHeight<n.height&&(ce>=1?(Me=100*V.videoWidth/n.width,V.style.width=Me+"%"):(Oe=100*V.videoHeight/n.height,V.style.height=Oe+"%")),se.removeClass(V,he),Pe=!0)}function w(){var e=V.currentTime,t=V.duration,n=t?e/t:0;s(e),r(n,1)}function C(e){te&&(De=(De+e)%Ne.length,V.playbackRate=Ne[De],te.textContent=Ne[De]+"x")}function x(e){var t=V.currentTime;"next"===e?e=t+.03333333333:"prev"===e&&(e=t-.03333333333);var n=V.paused||V.ended;V.currentTime=e,n&&V.pause()}function T(t){e.broadcast(ge,{errorType:t}),e.broadcast("previewcontentreload",{isFlashFallback:!0})}function S(e,t,n){var a,i,r=t?[t]:Ee;for(n=n||N,e=e||V,a=0,i=r.length;i>a;a++)e.addEventListener(r[a],n,!1);U.on("enter",_),U.on("exit",y)}function E(e,t,n){var a,i,r=t?[t]:Ee;for(n=n||N,e=e||V,a=0,i=r.length;i>a;a++)e.removeEventListener(r[a],n,!1);U.off("enter",_),U.off("exit",y)}function R(e){e=e||V;try{e.removeAttribute("src"),e.load(),e.parentElement&&e.parentElement.removeChild(e)}catch(t){}}function k(t){if(!Re){Re=!0,e.broadcast(ge,{errorType:ye+t});var n,a=V.parentNode,i=V.cloneNode(!1),r=V.currentTime,o=V.playbackRate,s=V.paused||V.ended,l=V.volume,c=function(){i.currentTime=r,i.playbackRate=o},u=function(){n=a.replaceChild(i,V),i.volume=l,Q.destroy(),E(n),R(n),E(i,"seeked",u),E(i,"canplay",c),V=se.query(re,q),S(),s||V.play(),Re=!1,e.broadcast(ge,{errorType:ye+t+"_recovered"})};i.volume=0,S(i,"seeked",u),i.readyState>HTMLMediaElement.HAVE_METADATA?c():S(i,"canplay",c),Q=X.create(se.query(".progress-widget",q))}}function A(){try{switch(V.error.code){case MediaError.MEDIA_ERR_ABORTED:e.broadcast(ge,{errorType:ye+"aborted"});break;case MediaError.MEDIA_ERR_NETWORK:k("network");break;default:T(ye+"unsupported")}}catch(t){T(ye+"fatal")}}function N(e){var t=e.type;switch(t){case"click":i();break;case"playing":h();break;case"pause":m();break;case"durationchange":isFinite(V.duration)?o(V.duration):T(ye+"metadata");break;case"canplay":b();break;case"timeupdate":w();break;case"ended":g();break;case"error":A();break;case"loadedmetadata":se.removeClass(V,he),se.addClass(ie,pe)}}function D(e){if(V)switch(e.type){case"play":V.play(),C(0);break;case"pause":V.pause();break;case"volume":V.volume=e.data;break;case"playbackrate":C(1);break;case"zoomin":v("in");break;case"zoomout":v("out");break;case"seek":x(e.data*V.duration)}else if(j)return j.fire(e.type,e.data)}function P(){K.setConfig([{key:"space",handler:function(){i()}},{key:"shift+=",handler:function(){v("in")}},{key:"shift+-",handler:function(){v("out")}},{key:"f",handler:function(){"video"===re&&(Z.isIE()&&Z.isMinBrowser("explorer","11")||(U.isFullScreen()?U.exit():U.enter()))}}],"preview")}function M(){ne=ne||$(".noUiSlider-video"),le||ne.noUiSlider({start:0,connect:"upper",range:{min:0,max:1},step:1e-4});var e=function(){var e=le?this:$(this),t=le?this.getValue():e.val()-0;t>ke&&(t=ke,le?e.setValue(t):e.val(t)),(!V||isFinite(V.duration))&&D({type:"seek",data:t})};ne.on("slide",e),le||ne.find(".noUi-connect").append('<div class="loaded"></div>')}function O(e,t){var n=G.recall("lastUnmutedVolume");t!==n&&(e===be?t=0:e===we&&(t=n),0===t?le||se.addClass(z,Te):(le||se.removeClass(z,Te),G.memorize("lastUnmutedVolume",t)),le?t!==ae.getValue()&&ae.setValue(t):ae.val(t),D({type:Ce,data:t}))}function I(){ae=ae||$(".noUiSlider-volume");var e=function(){var e=le?this.getValue():+$(this).val();O(null,e)},t=G.recall("lastUnmutedVolume");le?ae.setValue(t):ae.noUiSlider({
range:{min:0,max:1},start:t,step:.1,orientation:"vertical",connect:"upper",direction:"rtl"}),le?(ae.on("slide",e),ae.on("set",e)):ae.on({slide:e,set:e})}function H(){Z=e.getService("browser"),U=e.getService("fullscreen"),K=e.getService("hotkeys"),se=e.getService("dom"),G=e.getService("preview-cache"),X=e.getService("preview-progress"),F=e.getService("function-utils"),q=e.getElement(),re=q.getAttribute("data-media-type"),le="embed"===q.getAttribute("data-preview-format"),ie=se.query(".preview-media-icon-controls",q),z=le?document.querySelector(".preview-embed-controls"):se.query(".preview-controls",q),ee=le?document.querySelector(".preview-embed-display-timecode"):se.query(".preview-media-controls-timecode",z),J=le?document.querySelector(".preview-embed-display-duration"):se.query(".preview-media-controls-duration",z),te=le?null:se.query(".preview-controls-btn-speed",z),V=se.query(re,q)||null,G.memorize("lastUnmutedVolume",G.recall("lastUnmutedVolume")||.7),G.memorize("autoplay",!!G.recall("autoplay"))}function L(){S(),te&&n()}function B(e){ne=e.time,M(),ae=e.volume,I(),V?L():c()}var j,V,q,z,U,F,W,Z,G,K,X,Q,Y,J,ee,te,ne,ae,ie,re,oe,se,le,ce,ue=2e3,de="is-paused",fe="is-playing",pe="show-play",he="invisible",me="is-timed-out",ge="previewerror",ve="previewmediapaused",_e="previewmediaplaying",ye="media_err_",be="mute",we="unmute",Ce="volume",xe="autoplay",Te="is-muted",Se="is-auto-playing",Ee=["durationchange","timeupdate","playing","pause","ended","canplay","error","loadedmetadata"],Re=!1,ke=0,Ae=!1,Ne=[.5,1,1.5,2],De=1,Pe=!1,Me=100,Oe=100;return{messages:["flashevent","embedwidgetevent","togglefullscreen"],behaviors:["preview-controls"],onmessage:function(t,n){if("flashevent"===t)switch(n.type){case"previewer_loaded":u();break;case"previewer_pagecount_determined":case"previewer_first_page_shown":n.duration&&o(n.duration),d(n),e.broadcast("previewloaded",{contentType:"flash"});break;case"previewer_scrubber_update":s(n.timecode),r(n.handle,n.loaded);break;case"previewer_media_state_changed":"playing"===n.state?h():m()}else if("embedwidgetevent"===t){switch(n.type){case"scrubbersinitialized":return void B(n);case"togglevolume":return void O(ae.getValue()?be:we)}D(n)}else"togglefullscreen"===t&&(U.isFullScreen()?U.exit():U.enter())},init:function(){H(),P(),le||(M(),I()),V?L():c(),e.broadcast("previewready")},destroy:function(){K.unsetHotkeyForConfig("space","preview"),"audio"===re&&(clearTimeout(oe),se.off(q,"mousemove",p())),V&&(E(),R())},oncontextmenu:function(e,t,n){"mediacontent"===n&&e.preventDefault()},onclick:function(e,t,a){if(t&&a&&!t.disabled)switch(e=e||{},a){case"mediacontent":i();break;case be:case we:O(a);break;case xe:G.memorize("autoplay",!G.recall("autoplay")),n();break;case"enterfullscreen":U.enter();break;case"exitfullscreen":U.exit();break;default:D({type:a,data:e.data})}}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-dash.js",time:(new Date).getTime()}),Box.Application.addModule("preview-dash",function(e){"use strict";function t(){ye&&L.classList.remove(de)}function n(){ye&&(L.classList.add(de),clearTimeout(Y),Y=setTimeout(function(){t()},pe))}function a(){se||(se=ee.throttle(function(){n()},fe),H.addEventListener("mousemove",se))}function i(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),a=Math.floor(e%3600%60);return(t>0?t.toString()+":":"")+(10>n?"0"+n.toString():n.toString())+":"+(10>a?"0"+a.toString():a.toString())}function r(e){j.textContent=i(e||0)}function o(e){V.textContent=i(e||0)}function s(){var e=H.currentTime||0,t=H.duration,n=t?e/t:0;o(e),Z.setValue(n)}function l(){var e=I.getVideoTracks();if(e.length){var t=X.recall("potentiallyCachedHDVideos")||{},n=X.recall("currentFile"),a=e.reduce(function(e,t){return e.width>t.width?e:t});re=a.width,ie=a.height,ge=re/ie,oe=a.bandwidth,ce=a.id,t[n.versionId]&&(I.configure({enableAdaptation:!1}),I.selectVideoTrack(ce))}}function c(){if(_e){var e,t,n,a,i=re||0,r=ie||0,o=L.getBoundingClientRect();420>i&&(i=420,r=i/ge),H.style.width="",H.style.height="",te.isFullScreen()?ge>=1?H.style.width=L.clientWidth+"px":H.style.height=L.clientHeight+"px":i<=o.width&&r<=o.height?ge>=1?H.style.width=i+"px":H.style.height=r+"px":(e=(o.height-r)/r,n=i+i*e,t=(o.width-i)/i,a=r+r*t,a<=o.height?H.style.width=o.width+"px":n<=o.width&&(H.style.height=o.height+"px")),B.style.width=H.getBoundingClientRect().width+"px"}}function u(e){return ue[Math.ceil(3*e)]}function d(){var e=G.getValue();X.memorize("lastUnmutedVolume",e||.7),H.volume=e,J.removeClass(W,ue.join(" ")),J.addClass(W,u(e))}function f(){H.removeEventListener("timeupdate",s),H.currentTime=(Z.getValue()||0)*H.duration,H.addEventListener("timeupdate",s)}function p(e){var t,n,a=H.getBoundingClientRect(),r=e.pageX,o=(r-a.left)*H.duration/a.width,s=Math.floor(o),l=F.naturalWidth/100,c=-1*(s%100)*l,u=-90*Math.floor(s/100);L.dataset.filmstripState||(c=0,u=0,l=160),t=Math.max(0,r-a.left-l/2),n=Math.min(t,a.width-l),F.style.left=c+"px",F.style.top=u+"px",F.parentNode.style.display="block",F.parentNode.style.left=n+"px",q.textContent=i(o)}function h(){ve||(F.parentNode.style.display="none")}function m(e){ve=!1,document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",p),z.contains(e.target)||(F.parentNode.style.display="none")}function g(){ve=!0,document.addEventListener("mouseup",m),document.addEventListener("mousemove",p)}function v(e,t){if("manual"===e){I.configure({enableAdaptation:!1});var n=X.recall("potentiallyCachedHDVideos")||{},a=X.recall("currentFile");L.classList.contains("is-hd")?(I.selectVideoTrack(ce+1),delete n[a.versionId]):(I.selectVideoTrack(ce),n[a.versionId]=!0),X.memorize("potentiallyCachedHDVideos",n)}else"auto"===e&&"video"===t.contentType&&(t.bandwidth===oe?L.classList.add("is-hd"):L.classList.remove("is-hd"))}function _(){L.classList.add("is-playing")}function y(){L.classList.remove("is-playing")}function b(){L.classList.contains("is-playing")?H.pause():H.play()}function w(){y(),o(0),Z.setValue(0)}function C(){if(L.classList.contains("is-muted")){var e=X.recall("lastUnmutedVolume");L.classList.remove("is-muted"),G.setValue(e),H.volume=e,J.removeClass(W,ue.join(" ")),J.addClass(W,u(e))}else L.classList.add("is-muted"),G.setValue(0),H.volume=0,J.removeClass(W,ue.join(" ")),J.addClass(W,"preview-dash-volume-icon-mute")}function x(){te.isFullScreen()?te.exit():te.enter()}function T(){var e="/representation/file_version_"+L.dataset.fileVersion+"/filmstrip.jpg";L.dataset.sharedName&&(e=e+"?shared_name="+L.dataset.sharedName),F.src=e}function S(){var e,t=90*ge;e=F.parentNode,Z.getScrubberHandleEl().addEventListener("mousedown",g),Z.getConvertedBarEl().addEventListener("mousemove",p),Z.getConvertedBarEl().addEventListener("mouseleave",h),F.onload=function(){e.style.width=t+2+"px"},L.dataset.filmstripState?T():e.style.width="162px"}function E(){var e=be||-1;return"done"===L.dataset.state?1:"stream"===L.dataset.state&&0>e?0:e*he/H.duration}function R(){Z=K.create(z,0,0,E(),$t("Duration Slider","preview_dash_time_slider")),Z.on("slide",f),G=K.create(U,X.recall("lastUnmutedVolume"),1,1,$t("Volume Slider","preview_dash_volume_slider")),G.on("slide",d),r(H.duration),B.style.width=H.getBoundingClientRect().width+"px",a()}function k(){Q.setConfig([{key:"space",handler:b},{key:"f",handler:x}],"preview")}function A(){ye||(l(),R(),k(),c(),S(),L.classList.remove("invisible"),e.broadcast("previewloaded",{contentType:"video"}),ye=!0)}function N(){var e,t=H.buffered,n=t.length;ae=ae||0,e=n?t.end(n-1):0,ae=Math.max(ae,e),Z.setBufferedValue(ae/H.duration)}function D(e){be=e||-1,Z&&Z.setConvertedValue(E()),we=Math.min(me,Math.max(we,be*he)),I.configure({streamBufferSize:we})}function P(){var e;return L.dataset.sharedName&&(e="shared_name="+L.dataset.sharedName),function(t){return!e||t.indexOf(e)>-1?t:t+"?"+e}}function M(){clearTimeout(le);var e,t,n=P();_e||(I=new $.player.Player(H),I.addEventListener("adaptation",function(e){v("auto",e)}),H.addEventListener("loadedmetadata",A),H.addEventListener("progress",N),H.addEventListener("timeupdate",s),H.addEventListener("ended",w),H.addEventListener("playing",_),H.addEventListener("pause",y),ne="/representation/file_version_"+L.dataset.fileVersion+"/dash/manifest.mpd",e=new $.util.EWMABandwidthEstimator,e.supportsCaching=function(){return!0},t=new $.player.DashVideoSource(ne,null,e),t.setNetworkCallback(n),I.configure({streamBufferSize:we,enableAdaptation:!0}),I.load(t),X.memorize("lastUnmutedVolume",X.recall("lastUnmutedVolume")||.7),_e=!0)}function O(){le=setTimeout(function(){e.broadcast("previewcontentreload")},2e4),$=e.getGlobal("shaka"),K=e.getService("scrubber"),X=e.getService("preview-cache"),J=e.getService("dom"),te=e.getService("fullscreen"),Q=e.getService("hotkeys"),ee=e.getService("function-utils"),L=e.getElement(),B=J.query(".preview-dash-controls-wrapper",L),j=J.query(".preview-dash-display-duration",B),V=J.query(".preview-dash-display-timecode",B),z=J.query(".preview-dash-time-scrubber",B),U=J.query(".preview-dash-volume-scrubber",B),W=J.query(".preview-dash-volume-level",B),F=J.query(".preview-dash-filmstrip-image",L),q=J.query(".preview-dash-filmstrip-timecode",L),H=J.query("video",L),$.polyfill.installAll();var t=L.dataset.state;"done"===t?(we=me,M()):"stream"===t&&M()}var $,I,H,L,B,j,V,q,z,U,F,W,Z,G,K,X,Q,Y,J,ee,te,ne,ae,ie,re,oe,se,le,ce,ue=["preview-dash-volume-icon-mute","preview-dash-volume-icon-low","preview-dash-volume-icon-medium","preview-dash-volume-icon-high"],de="box-preview-media-controls-is-visible",fe=1e3,pe=3e3,he=5,me=12*he,ge=16/9,ve=!1,_e=!1,ye=!1,be=-1,we=he;return{messages:["previewresized","previewprogress"],init:function(){var t=e.getConfig("dashPlayerJS"),n=e.getService("assets");n.loadJSByHash(t,O)},destroy:function(){ye=!1,_e=!1,H.removeAttribute("src"),H.removeEventListener("timeupdate",s),H.removeEventListener("loadedmetadata",A),H.removeEventListener("progress",N),H.removeEventListener("ended",w),H.removeEventListener("playing",_),H.removeEventListener("pause",y),H.removeEventListener("mousemove",se),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",p),Z&&(Z.getScrubberHandleEl().removeEventListener("mousedown",g),Z.getConvertedBarEl().removeEventListener("mousemove",p),Z.getConvertedBarEl().removeEventListener("mouseleave",h),Z.off("slide",f),K.destroy(Z)),G&&(G.off("slide",d),K.destroy(G)),I&&I.destroy(),H.parentElement&&H.parentElement.removeChild(H),e.broadcast("previewcontentunload")},onmessage:function(e,t){"previewresized"===e?c():"previewprogress"===e&&("dash"===t.kind?("success"===t.status||"pending"===t.status&&0!==t.dash_mpd&&t.last_page>=1)&&(M(),D(t.last_page)):"filmstrip"===t.kind&&"success"===t.status&&(L.dataset.filmstripState="1",T()))},onclick:function(e,t,n){if(t&&n&&!t.disabled)switch(n){case"play":H.play();break;case"pause":H.pause();break;case"toggle-mute":C();break;case"toggle-fullscreen":x();break;case"toggle-hd":v("manual");break;case"toggle-playback":H.paused?H.play():H.pause()}}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-metadata.js",time:(new Date).getTime()}),Box.Application.addModule("preview-metadata",function(e){"use strict";function t(){var t=a.createFromRawInstance(l,u,c);r=e.getService("key-value-editor").create(p,t),r.init()}var n,a,i,r,o,s,l,c,u="properties",d="metadata-editor-container",f="."+d,p='.metadata-editor[data-metadata-editor-id="metadata-kv"]',h="metadataeditoradded";return{PROPERTIES_CONTAINER_PATH:p,messages:[h],behaviors:["preview-metadata-add-template-menu","menu-toggle"],init:function(){s=e.getConfig(),l=s.itemTypedId,c=s.propertiesMetadata,n=e.getService("metadata-editor"),a=e.getService("metadata-store"),i=e.getService("templates"),o=n.create(f),o.init(),t()},destroy:function(){r.destroy(),o.destroy()},onmessage:function(e,t){switch(e){case h:o.insertMetadataEditor(t.type,t.html)}}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-svg.js",time:(new Date).getTime()}),Box.Application.addModule("preview-svg",function(e){"use strict";function t(){if(be&&!(10>be)){var e=Math.round(100*ye/be);ee&&te||(ee=M.query(".page-progress-indicator",z),te=M.query(".page-progress-indicator-bar",ee)),te.style.width=e+"%",100===e?M.addClass(ee,oe):M.removeClass(ee,oe)}}function n(){F&&F.scrollTo("next")}function a(){F&&F.scrollTo("previous")}function i(){F&&F.zoom("out")}function r(){F&&F.zoom("in")}function o(e){F&&F.scrollTo(e)}function s(){var e,t=Te.length;for(e=0;t>e;e++)I.unsetHotkeyForConfig(Te[e].key,"preview")}function l(e){if(W.preview_type===ce){var t=e.originalEvent.wheelDelta||e.originalEvent.detail,i=t%120===0;i&&(0>t?n():a())}}function c(){ye=be,F.broadcast("pageavailable",{all:!0}),t()}function u(){ye>0&&F.broadcast("pageavailable",{upto:ye}),t()}function d(){clearTimeout(Z)}function f(){d(),Z=setTimeout(p,Ce)}function p(){V=j.getCrocodocStatus().then(w,f)}function h(t){!_e&&t.data&&"number"==typeof t.data.page&&(_e=!0,e.broadcast("previewloaded",{contentType:"document"}),I.setConfig(Te,"preview"))}function m(e){if(e&&e.data&&e.data.uri){var t=e.data.uri.replace(/"/g,"&quot;");e.data.uri="data:text/html;base64,"+btoa('<html><meta http-equiv="refresh" content="0; url='+t+'"></html>')}}function g(e){1===e?(Y&&M.addClass(Y,oe),M.addClass(ne,le),ne.setAttribute(le,"true")):(M.removeClass(ne,le),Y&&M.removeClass(Y,oe),ne.removeAttribute(le)),e===be?(J&&M.addClass(J,oe),M.addClass(ae,le),ae.setAttribute(le,"true")):(J&&M.removeClass(J,oe),M.removeClass(ae,le),ae.removeAttribute(le))}function v(e){e=R(e),g(e)}function _(e){v(e.data.page)}function y(t){var n;e.broadcast("previewloaded",{contentType:"document"}),ge=!0,d(),F&&F.destroy(),"object"==typeof t?n=t.data.error:"string"==typeof t&&(n=t),n=n||$t("We're sorry, the server encountered an error while processing your document.","preview-svg-server-error-message"),M.setText(z.querySelector(".preview-error-message"),n),M.addClass(U,oe),M.removeClass(z.querySelector(".svg-converting-error-overlay"),oe)}function b(t){return F?void("function"==typeof t&&t()):(we.url=W.base_url+"crocodoc/",we.queryParams=W.query_params,we.enableTextSelection=W.is_downloadable===!0,we.autoloadFirstPage=!1,we.useSVG=W.use_svg===!0,W.preview_type===ce?(we.layout=ce,M.addClass(z,"preview-svg-presentation"),M.on(z,"mousewheel",l)):we.layout="vertical-single-column",we.conversionIsComplete=ge,F=B.create(U,we),F.on("ready",function(n){M.removeClass(q,"hidden"),ve=!0,be=n.data.numPages,E(),v(n.data.page),e.broadcast("previewready"),"function"==typeof t&&t()}),F.on("pagefocus",_),F.on("pageload",h),F.on("fail",y),F.on("scrollstart",function(t){F.on("scrollend",function(t){e.broadcast("viewerscrollended",t.data),F.off("scrollend")}),e.broadcast("viewerscrollstarted",t.data)}),P.isIE()||P.isEdge()||F.on("linkclick",m),F.on("zoom",function(t){e.broadcast("previewcontentresized",{isScrollbarVisible:t.data.isDraggable})}),void F.load())}function w(e){var t=e.data;if("pdf"!==t.kind&&(d(),!ge)){switch(t.status){case fe:case pe:ge=!0,y(t.message);break;case me:ge=!0,b(c),t.fromRealTime&&!V&&p();break;case he:default:t.crocodoc_css&&t.crocodoc_json&&(ye=Math.max(ye,t.last_page||0),b(u)),f()}t.fromRealTime||(V=null)}}function C(e){var t=e.target,n=parseInt(t.value,10);isNaN(n)||(o(n),R(n)),T()}function x(e){switch(e.which){case 13:C(e);break;case 27:T(),e.preventDefault(),e.stopPropagation()}}function T(){M.removeClass(q,se),M.off(X,"blur",C),M.off(X,"keydown",x)}function S(){M.addClass(q,se),X.value=K.textContent||K.innerText,X.focus(),X.select(),M.on(X,"blur",C),M.on(X,"keydown",x)}function E(){M.setText(G,be),1===be&&(T(),Q&&(M.addClass(Q,le),Q.setAttribute(le,le),Q.removeAttribute("data-hover")))}function R(e){return e>be?e=be:1>e&&(e=1),M.setText(K,e),e}function k(){$.enter(),F&&W.preview_type===ce&&F.disableTextSelection()}function A(){$.exit(),F&&W.preview_type===ce&&F.enableTextSelection()}function N(e){switch(e.type){case"previouspage":a();break;case"nextpage":n();break;case"initialized":D()}}function D(){ie?(q=O.querySelector(".preview-embed-document-controls"),q&&(ne=q.querySelector(".preview-embed-control-back"),ae=q.querySelector(".preview-embed-control-forward"),G=q.querySelector(".preview-embed-display-total-pages"),K=q.querySelector(".preview-embed-display-current-page"),xe=!0)):(q=z.querySelector(".preview-controls"),q&&(ne=q.querySelector(".preview-controls-document-prev"),ae=q.querySelector(".preview-controls-document-next"),G=q.querySelector(".preview-controls-document-total-pages"),K=q.querySelector(".preview-controls-document-current-page"),Q=q.querySelector(".preview-controls-document-page-selector"),X=q.querySelector(".preview-controls-document-page-number-input")),W.preview_type===ce&&(Y=z.querySelector(".preview-presentation-previous-arrow "),J=z.querySelector(".preview-presentation-next-arrow "))),(!ie||xe)&&(ge?b(c):p(),P.isSafari()&&Q&&Q.setAttribute("aria-label",$t("Click to enter page number. Does not work under full screen mode.","preview_enter_page_number_safari")))}var P,M,O,$,I,H,L,B,j,V,q,z,U,F,W,Z,G,K,X,Q,Y,J,ee,te,ne,ae,ie,re,oe="hidden",se="show-page-number-input",le="disabled",ce="presentation",ue="keypress",de="preview",fe="error",pe="fatal",he="pending",me="success",ge=!1,ve=!1,_e=!1,ye=0,be=null,we={},Ce=5e3,xe=!1,Te=[{key:"right",handler:function(){n()}},{key:"left",handler:function(){a()}},{key:"down",handler:function(e){W.preview_type===ce?n():(F.scrollBy(0,80),e.preventDefault())}},{key:"up",handler:function(e){W.preview_type===ce?a():(F.scrollBy(0,-80),e.preventDefault())}},{key:"[",handler:function(){a()}},{key:"]",handler:function(){n()}},{key:"shift+space",handler:function(){a()}},{key:"space",handler:function(){n()}},{key:"p",handler:function(){W.is_downloadable&&(e.broadcast("previewprint"),L.recordAction({application:"files",page:de,component:"content",feature:"list",target:"print",action:ue}))}},{key:"shift+=",handler:function(){r()}},{key:"shift+-",handler:function(){i()}},{key:"f",handler:function(){P.isIE()&&P.isMinBrowser("explorer","11")||($.isFullScreen()?A():k())}}];return{messages:["previewprogress","embedwidgetevent","togglefullscreen"],behaviors:["preview-controls","preview-print"],onmessage:function(e,t){switch(e){case"previewprogress":re&&(t.fromRealTime=!0,w({data:t}));break;case"embedwidgetevent":N(t);break;case"togglefullscreen":$.isFullScreen()?A():k()}},onclick:function(t,o,s){if(ve)if(o&&s&&!o.disabled)switch(s){case"print":e.broadcast("previewprint");break;case"previouspage":a();break;case"nextpage":n();break;case"zoomout":i();break;case"zoomin":r();break;case"enterfullscreen":k();break;case"exitfullscreen":A();break;case"showpagenuminput":S()}else o&&s||W.preview_type!==ce||!$.isFullScreen()||1!==t.which||M.getNearest(t.target,"a")||n()},init:function(){$=e.getService("fullscreen"),H=e.getService("nav-state"),P=e.getService("browser"),B=e.getService("preview-crocodoc-wrapper"),j=e.getService("preview-api"),I=e.getService("hotkeys"),M=e.getService("dom"),L=e.getService("resin"),O=e.getGlobal("document"),W=e.getConfig(),ge=W.done,z=e.getElement(),U=M.query(".preview-svg",z),ie="embed"===z.getAttribute("data-preview-format"),re=P.hasSVGSupport(),D()},destroy:function(){F&&F.destroy(),_e&&s(),M.off(z,"mousewheel",l),d(),e.broadcast("previewcontentunload")}}}),Box.Timing.execution.push({name:"js/services/autosize.js",time:(new Date).getTime()}),Box.Application.addService("autosize",function(){"use strict";return{init:function(e){$(e).autosize({append:!1})},destroy:function(e){$(e).trigger("autosize.destroy")},resize:function(e){$(e).trigger("autosize.resize")}}}),Box.Timing.execution.push({name:"js/services/amsterdam/mention-selector.js",time:(new Date).getTime()}),Box.Application.addService("mention-selector",function(e){"use strict";function t(){var e,t;return e=D.getSelection(),e.getRangeAt&&e.rangeCount&&(t=e.getRangeAt(0).startContainer),t&&t.parentNode&&"A"===t.parentNode.tagName}function n(e,t){return!(e.inputBuffer.length||t.length)}function a(e,t){return(!e.inputBuffer.length||e.inputBuffer.length&&!e.shouldContinueMentionLookup)&&t.length}function i(e,t,n,a){var i=N.createElement("a"),r=N.createTextNode(e+a);return i.appendChild(r),i.setAttribute("data-id",t),i.href=n,i}function r(e){var t,n,a,i="";t=D.getSelection(),t.getRangeAt&&t.rangeCount&&(n=t.getRangeAt(0),i=n.startContainer.nodeValue.substring(0,n.endOffset),a=i.lastIndexOf(e),n.setStart(n.startContainer,a),n.deleteContents(),t.removeAllRanges(),t.addRange(n))}function o(e,t){var n,a,i=N.createTextNode("");n=D.getSelection(),n.getRangeAt&&n.rangeCount&&(a=n.getRangeAt(0),a.insertNode(e),t?(a.setStartAfter(e),a.insertNode(i),a.setStartAfter(i)):a.selectNodeContents(e),a.collapse(!1),n.removeAllRanges(),n.addRange(a))}function s(e,t,n,a){var s=i(e.mentionTrigger,t,n,a);r(e.inputBuffer),o(s,!0),e.inputBuffer=""}function l(e,t){return S.filter(e,function(e){return-1!==t.lastIndexOf(e)})}function c(e){e.shouldContinueMentionLookup&&e.dataProvider&&e.inputBuffer.length>1&&e.inputBuffer.length<50&&!t("a")?e.dataProvider(e.inputBuffer.substring(1)).then(function(t){0===t.length&&(e.shouldContinueMentionLookup=!1),e.selectorDropdown.setItems(t)}).caught(function(e){if(!e instanceof k.CancellationError)throw e}):e.selectorDropdown.setItems(1===e.inputBuffer.length?[{text:$t("Mention someone to notify them","mention_selector_enter_name"),isNotSelectable:!0}]:[])}function u(e){e.inputBuffer="",e.shouldContinueMentionLookup=!1,e.mentionTrigger="",e.mentionTriggerIndex=-1,e.selectorDropdown.setItems([]),e.range=null,e.typedValue=[]}function d(e){return function(){var t=E.getBoundingClientRect(e.contentEditableEl);e.contentEditableElClientHeight!==t.height&&(e.fire("resize"),e.contentEditableElClientHeight=t.height)}}function f(e){return function(t){var i,r,o,s,c,u,f=t.which||t.keyCode;f!==x.BACKSPACE&&(f===x.RETURN&&R.isIE()&&"9"===R.getVersion()?(o=N.selection.createRange(),o.pasteHTML("<br> "),o.moveStart("character",0),o.moveEnd("character",-1),o.select(),t.preventDefault(),t.stopPropagation()):f===x.RETURN&&R.isIE()&&(r=A.getSelection(),o=r.getRangeAt(0),s=N.createElement("br"),u=N.createTextNode(T),o.deleteContents(),o.insertNode(s),o.collapse(!1),o.insertNode(u),o.collapse(!0),r.removeAllRanges(),r.addRange(o),t.preventDefault(),t.stopPropagation()),d(e)(),c="compositionend"===t.type?t.originalEvent.data:String.fromCharCode(f),i=l(e.mentionTriggers,c),n(e,i)||(a(e,i)&&(e.inputBuffer="",e.mentionTrigger=i[0],e.range=null,e.shouldContinueMentionLookup=!0,e.typedValue=[]),e.typedValue||(e.typedValue=[]),e.typedValue.push(c)))}}function p(e){return function(t){var n=t.which||t.keyCode;return n===x.LEFT||n===x.RIGHT||n===x.HOME||n===x.END?void(e.inputBuffer=""):void(n===x.BACKSPACE&&(e.inputBuffer=e.inputBuffer.slice(0,e.inputBuffer.length-1),e.shouldContinueMentionLookup=!0,c(e)))}}function h(e){return function(){if(e.typedValue&&e.typedValue.length&&e.mentionTrigger&&e.shouldContinueMentionLookup){var t=D.getSelection().getRangeAt(0);if(e.range){if(t.startOffset<=e.mentionTriggerIndex||t.compareBoundaryPoints(Range.START_TO_END,e.range)<0)return void u(e)}else e.range=t,e.mentionTriggerIndex=e.range.startOffset;for(;e.typedValue.length;)e.inputBuffer+=e.typedValue.shift();c(e)}d(e)}}function m(e){return function(t){s(e,t.data.id,t.data.href,t.data.text)}}function g(e){var t=N.createElement("p"),n=e.getAttribute("data-placeholder"),a=N.createTextNode(n);n&&(t.className="placeholder",t.appendChild(a),e.insertBefore(t,e.firstChild))}function v(e){return function(){var t=e.contentEditableEl,n=t.querySelector(".placeholder"),a=t.textContent||t.innerText;n||a&&0!==a.length||g(t),e.selectorDropdown.setItems([])}}function _(e){return function(){var t=e.contentEditableEl.querySelector(".placeholder"),n=E.getBoundingClientRect(e.contentEditableEl);E.removeClass(e.contentEditableEl,"has-error"),e.contentEditableEl.removeAttribute("data-hover"),e.contentEditableEl.removeAttribute("aria-label"),e.contentEditableElClientHeight=n.height,t&&(e.contentEditableEl.removeChild(t),o(N.createElement("div")))}}function y(e,t){var n,a=N.createTextNode(t),i=D.getSelection();i.deleteFromDocument(),n=i.getRangeAt(0),n.insertNode(a),n.collapseAfter(a),D.getSelection().setSingleRange(n)}function b(e){return function(t){var n,a=t.originalEvent;(a.clipboardData||A.clipboardData)&&(n=a.clipboardData?a.clipboardData.getData("text/plain"):A.clipboardData.getData("Text")),n&&n.length>0&&setTimeout(function(){y(e.contentEditableEl,n),d(e)()},1),t.stopPropagation(),t.preventDefault()}}function w(e){var t,n="",a=D.getSelection();return a.removeAllRanges(),t=N.createRange(),t.selectNodeContents(e),a.addRange(t),n=A.getSelection().toString(),a.removeAllRanges(),n}function C(t,n,a){var i=e.getService("contact-selector-dropdown");g(n),this.selectorDropdown=i.create(n),this.menuItemSelectHandlerRef=m(this),this.keypressHandlerRef=f(this),this.keydownHandlerRef=p(this),this.keyupHandlerRef=h(this),this.focusHandlerRef=_(this),this.pasteHandlerRef=b(this),this.blurHandlerRef=v(this),this.contentEditableEl=n,this.mentionTriggers=t,this.mentionTrigger="",this.dataProvider=a,this.inputBuffer="",this.typedValue=[],this.shouldContinueMentionLookup=!1,this.selectorDropdown.on("dropdownitemselect",this.menuItemSelectHandlerRef),E.on(this.contentEditableEl,"keypress",this.keypressHandlerRef),E.on(this.contentEditableEl,"keydown",this.keydownHandlerRef),E.on(this.contentEditableEl,"focus",this.focusHandlerRef),E.on(this.contentEditableEl,"blur",this.blurHandlerRef),E.on(this.contentEditableEl,"keyup",this.keyupHandlerRef),E.on(this.contentEditableEl,"paste",this.pasteHandlerRef),E.on(this.contentEditableEl,"compositionend",this.keypressHandlerRef),$.extend(this,new Box.EventTarget)}var x={BACKSPACE:8,RETURN:13,LEFT:37,RIGHT:39,HOME:36,END:35},T="",S=e.getService("array-utils"),E=e.getService("dom"),R=e.getService("browser"),k=e.getService("promises"),A=e.getGlobal("window"),N=e.getGlobal("document"),D=e.getGlobal("rangy");return D.init(),C.prototype={focus:function(){this.contentEditableEl.focus()},reset:function(){E.setHTML(this.contentEditableEl,""),this.selectorDropdown.setItems([]),this.inputBuffer="",g(this.contentEditableEl)},getMessage:function(){var e,t,n,a={message:"",messageMentioned:""},i=new RegExp(T,"g"),r=this.contentEditableEl.innerText||w(this.contentEditableEl);if(r=r.replace(i,""),E.query(".placeholder",this.contentEditableEl)||0===r.length)return a;for(e=this.contentEditableEl.querySelectorAll("a[data-id]"),n=e.length,a.message=r,a.messageMentioned=r,t=0;n>t;t++){var o=e[t],s=o.textContent||o.innerText,l=s.length>1?s.slice(1):" ",c=this.mentionTriggers[0]+"["+o.getAttribute("data-id")+":"+l+"]";a.messageMentioned=a.messageMentioned.replace(s,c)}return a},setMessage:function(e){E.setHTML(this.contentEditableEl,e)},initMentionAtCursor:function(){this.contentEditableEl.focus();var e=this;setTimeout(function(){e.mentionTrigger=e.mentionTriggers[0];var t=N.createTextNode(e.mentionTrigger);o(t,!1),e.range=D.getSelection().getRangeAt(0),e.mentionTriggerIndex=e.range.startOffset-1,e.inputBuffer=e.mentionTrigger,e.shouldContinueMentionLookup=!0,e.typedValue=[],c(e)},0)},insertMentionAtCursor:function(e,t,n){var a=i(this.mentionTriggers[0],e,t,n);A.setTimeout(function(){o(a,!0)},0)},displayError:function(e){E.addClass(this.contentEditableEl,"has-error"),this.contentEditableEl.setAttribute("data-tooltip",""),this.contentEditableEl.setAttribute("data-tooltip-theme","error"),this.contentEditableEl.setAttribute("aria-label",e)},destroy:function(){E.setHTML(this.contentEditableEl,""),this.selectorDropdown.off("dropdownitemselect",this.menuItemSelectHandlerRef),E.off(this.contentEditableEl,"keypress",this.keypressHandlerRef),E.off(this.contentEditableEl,"keydown",this.keydownHandlerRef),E.off(this.contentEditableEl,"focus",this.focusHandlerRef),E.off(this.contentEditableEl,"keyup",this.keyupHandlerRef),E.off(this.contentEditableEl,"paste",this.pasteHandlerRef),E.off(this.contentEditableEl,"blur",this.blurHandlerRef),E.off(this.contentEditableEl,"compositionend",this.keypressHandlerRef)}},{create:function(e,t,n){return new C(e,t,n)}}}),Box.Timing.execution.push({name:"js/services/amsterdam/provider-contacts.js",time:(new Date).getTime()}),Box.Application.addService("provider-contacts",function(e){"use strict";function t(e,t){var n,a,i,r=[],o=null;if(e.hasOwnProperty("contacts"))for(n=e.contacts,a=0,i=n.length;i>a;a++)o=n[a],r.push({data:{email:o.email,id:o.id,type:"user"},id:o.email,text:o.contact_name,email:o.email});if(e.hasOwnProperty("collabs_without_account")&&!t.excludeWithoutAccount)for(n=e.collabs_without_account,a=0,i=n.length;i>a;a++)o=n[a],r.push({data:{email:o.email,id:o.email,type:"collab_without_account"},id:o.email,text:o.email,email:""});if(e.hasOwnProperty("friends_without_account")&&!t.excludeWithoutAccount)for(n=e.friends_without_account,a=0,i=n.length;i>a;a++)o=n[a],r.push({data:{email:o.email,id:o.email,type:"friend_without_account"},id:o.email,text:o.contact_name,email:o.email});if(e.hasOwnProperty("groups"))for(n=e.groups,a=0,i=n.length;i>a;a++)o=n[a],r.push({data:{email:"",id:o.id,type:"group"},id:o.id,text:o.contact_name,email:$t("Group","group_text")});return r}function n(e,n){return function(r){a&&(a.cancel(),a=null);var l=s.getGcmCompatibleRm(i);return a=o.get(l,{searchString:r,itemTypedId:e,includeSelf:!!n.includeSelf,includeGroups:!!n.includeGroups}),a.then(function(e){return a=null,t(e.data,n)},function(){a=null})}}var a,i="contacts_get",r={title:$t("UPLOADER","contact_selector_uploader"),tooltip:$t("This user does not have permission to add comments or respond to tasks.","contact_selector_uploader_description")},o=e.getService("ajax"),s=e.getService("url");return{searchAllContacts:function(e){return n("",e||{})},searchAllContactsExcludingItemCollaborators:function(e,t){return e?n(e,t||{}):this.searchAllContacts(t)},searchWithItem:function(e){return function(t){return a&&(a.cancel(),a=null),a=o.get("contacts_get_for_item",{search_string:t,item_typed_id:e||"",include_pending_collabs:!1,include_self:!1}),a.then(function(e){a=null;for(var t=[],n=e.data.contacts.length,i=0;n>i;i++)t.push({text:e.data.contacts[i].contact_name,id:""+e.data.contacts[i].id,data:e.data.contacts[i],href:"/profile/"+e.data.contacts[i].id,email:e.data.contacts[i].email,isNotSelectable:e.data.is_uploader[e.data.contacts[i].id],badge:e.data.is_uploader[e.data.contacts[i].id]?r:null});return t},function(){a=null})}}}}),Box.Timing.execution.push({name:"js/services/amsterdam/url-amsterdam.js",time:(new Date).getTime()}),Box.Application.addService("url-amsterdam",function(){"use strict";function e(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}function t(e){return window.encodeURIComponent(e).replace(/%20/g,"+")}function n(e){return window.decodeURIComponent(e.replace(/\+/g," "))}function a(n){if("string"==typeof n||"number"==typeof n)return t(n);for(var a=[],i=e(n).sort(),r=0;r<i.length;r++){var o=i[r],s=n[o];a.push(void 0===s?t(o):t(o)+"="+t(s))}return a.join("&")}function i(e,t){if(!e||"?"===e)return{};e&&"?"===e[0]&&(e=e.substr(1));for(var a=e.split("&"),i={},r=0,o=a.length;o>r;r++){var s=a[r].split("=");!s[0]||t&&void 0===s[1]||(i[n(s[0])]=n(s[1]))}return i}return{encode:a,decode:i}}),Box.Timing.execution.push({name:"js/services/amsterdam/urls-runmode.js",time:(new Date).getTime()}),Box.Application.addService("urls-runmode",function(){"use strict";return{formatQuery:function(e){function t(e,n,a){if(n=n||"",a=a||[],"string"==typeof e||"number"==typeof e)a.push(n+"="+encodeURIComponent(e));else if("boolean"==typeof e)a.push(n+"="+(e?1:0));else for(var i in e)e.hasOwnProperty(i)&&(a=t(e[i],n+"["+i+"]",a));return a}return t(e,"q").join("&")},get:function(e,t){var n="/index.php?rm="+e;return t&&(n+="&"+this.formatQuery(t)),n}}}),Box.Timing.execution.push({name:"js/services/amsterdam/xhr.js",time:(new Date).getTime()}),Box.Application.addService("xhr",function(e){"use strict";function t(e,t,n,i){i=i||{};var r;if(window.XMLHttpRequest)r=new XMLHttpRequest;
else{if(!window.ActiveXObject)return null;r=new ActiveXObject("MSXML2.XMLHTTP.3.0")}return r.open(e,t,!0),i.corsRequest||(r.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.requestToken&&r.setRequestHeader("X-Request-Token",a.requestToken)),"string"==typeof n&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.send(n||null),r}var n=e.getService("promises"),a=e.getGlobalConfig();return{send:function(e,a,i,r){var o=t(e,a,i,r),s=!1,l=n.create(function(e,t){o.onreadystatechange=function(){return s?null:void(4===o.readyState&&(2===(o.status/100|0)?e(o):t(o)))},o.onerror=function(){return s?null:void t(o)}});return l.abort=function(){s=!0,o.abort()},l},parseJSONResponse:function(e){return n.create(function(t,n){var a;try{a=JSON.parse(e.responseText)}catch(i){return void n(i)}t(a)})},handleLegacyAJAXResponse:function(e){return n.create(function(t,n){var a;try{a=JSON.parse(e.responseText)}catch(i){return void n(i)}return"data"in a?void t(a.data):void n(a)})}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-header.js",time:(new Date).getTime()}),Box.Application.addModule("preview-header",function(e){"use strict";function t(e){var t=e.parentNode,n=o.query(".box-edit-installed",t),a=o.query(".box-edit-not-installed",t);d.isBoxEditDisabledByAdmin()?(o.addClass(a,"hidden"),o.addClass(n,"hidden")):d.isBoxEditInstalled()?(o.removeClass(n,"hidden"),o.addClass(a,"hidden")):(o.removeClass(a,"hidden"),o.addClass(n,"hidden"))}function n(){var e=o.query(".preview-header-file-name",s),t=o.query(".preview-header-right",s);if(e&&t){var n=t.offsetLeft-e.offsetLeft;e.style.maxWidth=n+"px"}}function a(){var e=o.query(".btn-preview-header-download-watermarked-rep",s);if(e&&e.disabled){o.removeClass(e,"is-disabled"),e.removeAttribute("disabled"),e.removeAttribute("title");var t=$t("Download watermarked file","preview_header_download_watermarked_button_enabled_tip");e.setAttribute("aria-label",t)}}function i(t,n){t||(t=o.query(".preview-header-close",s).getAttribute("href")),e.broadcast("previewcloseandnavigatetourl",{url:t,reloadUnderlyingPage:!!n})}function r(){var t=_.isSharedFilePageOrSharedFileEmbed(),n=[{key:"esc",handler:function(){v.isFullScreen()?v.exit():t||(i(),c.recordAction({application:"files",page:"preview",component:"",feature:"hotkeys",target:"close",action:"keypress"}))}}];t||(n=n.concat([{key:"d",handler:function(){e.broadcast("previewdownload"),c.recordAction({application:"files",page:"preview",component:"",feature:"hotkeys",target:"download",action:"keypress"})}},{key:"e",handler:function(){e.broadcast("previewedit"),c.recordAction({application:"files",page:"preview",component:"",feature:"hotkeys",target:"edit",action:"keypress"})}},{key:"s",handler:function(){e.broadcast("previewshare"),c.recordAction({application:"files",page:"preview",component:"",feature:"hotkeys",target:"share",action:"keypress"})}}])),p.setConfig(n,"preview")}var o,s,l,c,u,d,f,p,h,m,g,v,_;return{behaviors:["menu-toggle","tooltips-amsterdam","preview-edit","preview-lock","preview-share","preview-download","preview-download-watermarked-rep","preview-favorite","preview-edit-office-online"],messages:["previewloaded","previewresized"],init:function(){o=e.getService("dom"),s=e.getElement(),c=e.getService("resin"),u=e.getService("fileop-upload-legacy"),d=e.hasService("box-edit")?e.getService("box-edit"):null,f=e.getService("preview-cache"),p=e.getService("hotkeys"),h=e.getService("fileop-movecopy-legacy"),m=e.getService("tooltips-amsterdam"),g=e.getService("fileop-versions"),v=e.getService("fullscreen"),_=e.getService("preview-nav"),l=f.recall("currentFile"),n()},onclick:function(n,a,r){if(a&&r&&!a.disabled)switch(m.hideAll(),r){case"preview-versions":g.showVersionsPopup(l.id);break;case"preview-move-copy":h.showMoveCopyPopup(l.id);break;case"preview-upload":u.uploadFileNewVersion(l.id);break;case"preview-show-sidebar":e.broadcast("previewtogglesidebar",{showSidebar:!0});break;case"preview-hide-sidebar":e.broadcast("previewtogglesidebar",{showSidebar:!1});break;case"preview-close-preview":i(a.getAttribute("href"),!1),c.recordAction({application:"files",page:"preview",component:"header",feature:"interactions",target:"close",action:"click"}),n.preventDefault();break;case"preview-open-parent":i(a.getAttribute("href"),!0),c.recordAction({application:"files",page:"preview",component:"header",feature:"interactions",target:"closetoparent",action:"click"}),n.preventDefault();break;case"menu-toggle-button":o.hasClass(a,"has-office-online")&&t(a)}},onmessage:function(e){switch(e){case"previewloaded":r(),a();break;case"previewresized":n()}}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-sidebar.js",time:(new Date).getTime()}),Box.Application.addModule("preview-sidebar",function(e){"use strict";function t(t){o.memorize("infoTabSelected","info"===t.data.tab),e.broadcast("previewactivityfeedadjustments")}function n(){i=r.create(a.querySelector(".tab-view")),i.init(),o.recall("infoTabSelected")&&i.nextTab(),i.on("tabchange",t)}var a,i,r,o;return{behaviors:["contextual-messages-registration"],init:function(){a=e.getElement(),r=e.getService("tabview"),o=e.getService("preview-cache"),n()},destroy:function(){i&&(i.off("tabchange",t),i.destroy())}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-sidebar-activity-feed.js",time:(new Date).getTime()}),Box.Application.addModule("preview-sidebar-activity-feed",function(e){"use strict";function t(e){H.hideAll(),E.setHTML(V,e.data.html)}function n(){}function a(){N.getSidebarActivityFeed(Q).then(t,n).caught(n)}function i(e,t){A.error(e,{action:{text:$t("Try again?","activity_feed_try_again"),onclick:t}})}function r(e,t){A.warn(e,{action:{text:$t("Yes","activity_feed_yes"),onclick:function(){t(),A.hide()}}})}function o(){var e;S.isIE()&&!S.isHtml5EnabledIE()&&q&&1===q.nodeType&&(e=E.getBoundingClientRect(q),j.style.top=e.height+"px")}function s(){E.removeClass(B,"comment-input-visible"),G.reset(),E.removeClass(B,"task-input-visible"),K.reset(),Z.datepicker("setDate",null),X.reset(),U.removeAttribute("data-task-edit-id"),o(),E.removeClass(E.query(te,F),ee),E.removeClass(E.query(te,F),ee)}function l(){var e=U.querySelector("input.sidebar-activity-feed-task-assignee-input"),t=U.querySelector(".sidebar-activity-feed-task-textarea"),n=Q?D.searchWithItem("f_"+Q):null;Z=$(U).find(".sidebar-activity-feed-task-due-date-input"),X=M.create(e,n),K=O.create(J,t,n),X.init(),Z.datepicker($.extend({},$.DATEPICKER_DEFAULTS,{minDate:new Date,showOn:"focus"})),K.on("resize",o),X.on("resize",o)}function c(){var e=z.querySelector(".sidebar-activity-feed-comment-textarea"),t=Q?D.searchWithItem("f_"+Q):null;G=O.create(J,e,t),G.on("resize",o)}function u(e){return e&&0!==R.trim(e.message).length?!0:(G.displayError($t("Please enter a comment.","comment_no_message_error")),!1)}function d(e){e?z.setAttribute("data-parent-id",e):z.removeAttribute("data-parent-id"),E.removeClass(B,"task-input-visible"),E.addClass(B,"comment-input-visible"),G.focus(),o()}function f(e){return function(){i($t("There was an error saving the comment.","activity_feed_submit_comment_error"),function(){p(e)})}}function p(e){if(u(e)){E.addClass(E.query(te,F),ee),F.disabled=!0;var n=z.getAttribute("data-parent-id"),a=f(e);N.comment.create("f_"+Q,e,n).then(function(e){e.data.result?(t(e),s()):a()},a).caught(a).lastly(function(){E.removeClass(E.query(te,F),ee),F.disabled=!1})}}function h(e,t,n,a){e&&U.setAttribute("data-task-edit-id",e),t&&Z.datepicker("setDate",t),n&&X.insertArrayOfPills(n),a&&K.setMessage(a),E.removeClass(B,"comment-input-visible"),E.addClass(B,"task-input-visible"),X.inputElement.focus(),o()}function m(){var e,t,n=X.getPills(),a="";if(!n)return"";for(t=n.length,e=0;t>e;e++)a=a+n[e].email+",";return a}function g(e){var t,n,a=e.querySelectorAll(".activity-feed-assignee"),i=[],r=a.length;for(t=0;r>t;t++)n={id:a[t].getAttribute("data-user-id"),email:a[t].getAttribute("data-user-email"),text:a[t].textContent||a[t].innerText},i.push(n);return i}function v(e){var t=E.getNearest(e,".activity-feed-task-content"),n=t.getAttribute("data-task-id"),a=t.getAttribute("data-due-date"),i="0"===a?null:k.getDateFromTimestampInSeconds(a),r=t.querySelector(".activity-feed-message"),o=$(r).html(),s=g(t);h(n,i,s,o)}function _(e,t){return e&&0!==R.trim(e).length?t&&0!==R.trim(t.message).length?!0:(K.displayError($t("Please enter a task description.","tasks_js_message_error_no_description")),!1):(X.displayError($t("Please enter a valid task recipient","create_item_feed_object_no_valid_recipient_error")),!1)}function y(e,t,n,a){return function(r){var o,s,l=r.data.error.collabs_needing_upgrade,c=[];if(l){for(s=l.length,o=0;s>o;o++)c.push(l[o].email);A.error($t("Invalid task recipient(s): %1. Tasks may only be assigned to collaborators in this folder","create_item_feed_object_valid_recipients_error",c.join(", ")))}else i($t("There was an error saving the task.","activity_feed_save_task_error"),function(){b(e,t,n,a)})}}function b(e,n,a,i){if(_(a,n)){var r,o=y(e,n,a,i);E.addClass(E.query(te,W),ee),W.disabled=!0,r=i?N.task.edit(i,"f_"+Q,n,a,e):N.task.create("f_"+Q,n,a,e),r.then(function(e){e.data.result?(t(e),s()):o(e)},o).caught(o).lastly(function(){E.removeClass(E.query(te,W),ee),W.disabled=!1})}}function w(e,t){E.addClass(E.query(ne,t),ee),N.comment.remove("f_"+Q,e).then(a,function(){i($t("There was an error deleting this comment.","activity_feed_delete_comment_error"),function(){w(e)})}).lastly(function(){E.removeClass(E.query(ne,t),ee)})}function C(e,t){E.addClass(E.query(ne,t),ee),N.task.reject("f_"+Q,e).then(a,function(){i($t("There was an error declining this task.","activity_feed_decline_task_error"),function(){C(e)})}).lastly(function(){E.removeClass(E.query(ne,t),ee)})}function x(e,t){E.addClass(E.query(ne,t),ee),N.task.complete(e).then(a,function(){i($t("There was an error completing this task.","activity_feed_completing_task_error"),function(){x(e)})}).lastly(function(){E.removeClass(E.query(ne,t),ee)})}function T(e,t){E.addClass(E.query(ne,t),ee),N.task.remove(e).then(a,function(){i($t("There was an error deleting this task.","activity_feed_deleting_task_error"),function(){T(e)})}).lastly(function(){E.removeClass(E.query(ne,t),ee)})}var S,E,R,k,A,N,D,P,M,O,I,H,L,B,j,V,q,z,U,F,W,Z,G,K,X,Q,Y,J=["@","",""],ee="is-loading",te=".activity-feed-post-spinner",ne=".activity-feed-item-spinner";return{behaviors:["menu-toggle","tooltips-amsterdam"],messages:["previewactivityfeedadjustments"],init:function(){N=e.getService("preview-api"),S=e.getService("browser"),E=e.getService("dom"),R=e.getService("strings"),k=e.getService("datetime"),A=e.getService("notifications"),D=e.getService("provider-contacts"),M=e.getService("pill-selector"),O=e.getService("mention-selector"),I=e.getService("fileop-versions"),H=e.getService("tooltips-amsterdam"),P=e.getService("popups-amsterdam"),L=e.getGlobal("window"),B=e.getElement(),j=B.querySelector(".sidebar-activity-feed-container"),V=B.querySelector(".sidebar-activity-feed-items-container"),q=B.querySelector(".sidebar-activity-feed-input-container"),F=B.querySelector('button[data-type="submit-comment"]'),W=B.querySelector('button[data-type="submit-task"]'),Q=B.getAttribute("data-file-id"),Y=B.getAttribute("data-folder-id"),q&&(z=q.querySelector(".sidebar-activity-feed-comment-container"),U=q.querySelector(".sidebar-activity-feed-task-container"),c(),l(),o()),a()},onclick:function(t,n,a){if(n&&a&&!n.disabled){var i,o,l,c,u,f,g,_,y,S;if(n){switch(a){case"preview-versions":e.getGlobalConfig("isAmsterdam")?P.open("version_history",{data:{fileId:Q}}):I.showVersionsPopup(Q);break;case"menu-toggle-comment":case"activity-feed-placeholder-textarea":t.preventDefault(),s(),d();break;case"menu-toggle-task":s(),h();break;case"cancel-comment":case"cancel-task":s();break;case"submit-comment":f=G.getMessage(),p(f);break;case"submit-task":var R=E.query(".sidebar-activity-feed-task-due-date-input",U).value;g=k.parseShortDateToTimestampInSeconds(R,{setToEndOfDay:!0}),_=m(),f=K.getMessage(),y=U.getAttribute("data-task-edit-id"),b(g,f,_,y);break;case"delete-comment":S=E.getNearest(n,".activity-feed-item"),i=n.getAttribute("data-comment-id"),r($t("Are you sure you want to delete this comment?","activity_feed_comment_delete_confirmation"),function(){w(i,S)});break;case"reply-comment":o=n.getAttribute("data-comment-author-user-id"),l=n.getAttribute("data-comment-author-name"),u=n.getAttribute("data-comment-id"),s(),d(u),G.insertMentionAtCursor(o,"/preview/"+o,l);break;case"decline-task":S=E.getNearest(n,".activity-feed-item"),c=n.getAttribute("data-task-assignment-id"),C(c,S);break;case"complete-task":S=E.getNearest(n,".activity-feed-item"),c=n.getAttribute("data-task-assignment-id"),x(c,S);break;case"delete-task":var A=n.getAttribute("data-task-id");S=E.getNearest(n,".activity-feed-item"),r($t("Are you sure you want to delete this task?","activity_feed_task_delete_confirmation"),function(){T(A,S)});break;case"edit-task":s(),v(n);break;case"add-comment-mention":G.initMentionAtCursor();break;case"add-task-mention":K.initMentionAtCursor();break;default:return!0}t.preventDefault()}}},onmessage:function(e){"previewactivityfeedadjustments"===e&&o()}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-sidebar-properties.js",time:(new Date).getTime()}),Box.Application.addModule("preview-sidebar-properties",function(e){"use strict";function t(){var e,t=h.queryAll("textarea",_),n=t.length;for(e=0;n>e;e++)v.init(t[e])}function n(){var e,t=h.queryAll("textarea",_),n=t.length;for(e=0;n>e;e++)v.destroy(t[e])}function a(e){h.removeClass(e,x);var t=h.query(".btn-save-value",e.parentNode);h.removeClass(t,T),b&&h.hasClass(e,E)&&(e.value+="."+b)}function i(e){h.addClass(e,x);var t=h.query(".btn-save-value",e.parentNode);if(h.addClass(t,T),b&&h.hasClass(e,E)){var n=e.value;e.value=n.substring(0,n.toLowerCase().lastIndexOf(b)-1)}w=e.value,e.focus(),h.off(e,"blur",f),h.on(e,"blur",f)}function r(e,t){h.addClass(e,C),e.setAttribute("data-hover","tooltip"),e.setAttribute("aria-label",t)}function o(e){h.removeClass(e,C),e.removeAttribute("data-hover"),e.removeAttribute("aria-label")}function s(e){var t=e.parentNode,n=h.query(".btn-save-value",t);h.addClass(n,"hidden"),h.addClass(t,S),e.disabled=!0}function l(e){var t=e.parentNode,n=h.query(".btn-save-value",t);h.removeClass(n,"hidden"),h.removeClass(t,S),e.disabled=!1}function c(t,n){return function(i){var o=i.data.error;if(o)return l(t),void r(t,o);var s=i.data.value;"name"===n&&e.broadcast("previewfilenamechanged",{fileName:s}),e.broadcast("itemupdated",{itemTypedId:"f_"+m}),l(t),a(t),h.off(t,"blur",f),t.value!==s&&(t.value=s),v.resize(t)}}function u(e){return function(t){var n=t.data.error||R;l(e),r(e,n)}}function d(e){var t,n="description",a=u(e);o(e),h.hasClass(e,E)&&""===g.trim(e.value)&&(e.value=w,v.resize(e)),t=e.value,h.hasClass(e,E)&&(n="name",b&&(t+="."+b)),s(e),y.properties.update(m,n,t).then(c(e,n),a).caught(a)}function f(e){var t=e.target;t&&d(t)}function p(e){o(e),e.value=w,e.blur()}var h,m,g,v,_,y,b,w="",C="has-error",x="is-being-edited",T="is-visible",S="is-loading",E="file-name",R=$t("There was an error, please try again","preview_sidebar_update_file_info_default_error");return{init:function(){h=e.getService("dom"),g=e.getService("strings"),v=e.getService("autosize"),_=e.getElement(),y=e.getService("preview-api"),m=_.getAttribute("data-file-id"),b=_.getAttribute("data-file-extension"),t()},destroy:function(){n()},onclick:function(e,t,n){var a,r;switch(n){case"edit-value-btn":r=t.parentNode,a=h.query("textarea",r),h.hasClass(t,x)||i(a);break;case"save-value-btn":r=t.parentNode,a=h.query("textarea",r),a.blur();break;default:return}e.preventDefault(),e.stopPropagation()},onfocusin:function(e,t,n){if("edit-value"===n){var a=t.parentNode,r=h.query("textarea",a);h.hasClass(t,x)||i(r)}},onkeydown:function(e,t,n){"edit-value"!==n||t.disabled||(13!==e.which||e.shiftKey?27===e.which&&(p(t),e.preventDefault(),e.stopPropagation()):(t.blur(),e.preventDefault(),e.stopPropagation()))}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-sidebar-metadata.js",time:(new Date).getTime()}),Box.Application.addModule("preview-sidebar-metadata",function(e){"use strict";function t(e){i.setHTML(l,e.data.html)}function n(){}function a(){s.getSidebarMetadata(r).then(t,n).caught(n)}var i,r,o,s,l;return{init:function(){i=e.getService("dom"),s=e.getService("preview-api"),o=e.getElement(),l=o.querySelector(".preview-sidebar-metadata-container"),r=o.getAttribute("data-file-id"),a()}}}),Box.Timing.execution.push({name:"js/services/postload-done.js",time:(new Date).getTime()}),Box.Application.addService("postload-done",function(){"use strict";return!0}),Box.Timing.execution.push({name:"done",time:(new Date).getTime()});
//# sourceMappingURL=/js/section_application_postload.js.map